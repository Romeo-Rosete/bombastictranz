(self.webpackChunk_msnews_msnews_experiences=self.webpackChunk_msnews_msnews_experiences||[]).push([["rewards-data-connector"],{91734:function(e,t,r){"use strict";r.d(t,{WH:function(){return s},qi:function(){return c}});var i=r(42122),n=r(15598),o=r(22624);async function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;try{if(await a()&&t){const e=await o.L.getPreferenceSetting(t);if(e&&void 0!==e.value)return JSON.parse(e.value.toString())}if(e){const t=(0,n.$o)().getObject(e,void 0);if(void 0!==t)return JSON.parse(t)}return r}catch(e){return i.k.logError("Failed to parse the key."),!1}}async function a(){return await o.L.isApiAvailableToUse()}function c(e,t){const r={setting:e,source:"ntp",timestamp:(new Date).getTime(),value:t};o.L.savePreferenceSetting(e,r)}},44887:function(e,t,r){"use strict";var i,n,o,s,a,c;function d(e){switch(e){case o.Mini:return 228;case o.Small:return 256;case o.Medium:return 288;case o.Large:return 312;default:return 288}}r.d(t,{Jt:function(){return a},RC:function(){return i},dm:function(){return o},gz:function(){return s},no:function(){return d}}),function(e){e.Above="Above",e.Below="Below",e.Left="Left",e.Right="Right"}(i||(i={})),function(e){e.TopStart="TopStart",e.TopEnd="TopEnd",e.BottomStart="BottomStart",e.BottomEnd="BottomEnd"}(n||(n={})),function(e){e.Mini="Mini",e.Small="Small",e.Medium="Medium",e.Large="Large"}(o||(o={})),function(e){e.AccountLinkPromoENTP="accountLinkPromoENTP",e.BinaryReactionPromotion="binaryReactionPromotion",e.BinaryReactionControl="binaryReactionControl",e.BingIntlUpsellPromotion="bingIntlUpsellPromotion",e.ChinaLanguageMismatch="chinaLanguageMismatch",e.bingChatDallePromotion="bingChatDallePromotion",e.FollowingFeedPromotion="followingFeedPromotion",e.PersonalizeManageText="personalizeManageText",e.PersonalizeManageImage="personalizeManageImage",e.GamingFeedPromotion="gamingFeedPromotion",e.LayoutPromotion="layoutPromotion",e.LocationAccuracyRevIP="locationAccuracyRevIP",e.MarketLanguage="marketLanguage",e.multiLocationsCarousel="multiLocationsCarousel",e.multiLocationsCarouselV2="multiLocationsCarouselV2",e.NotificationBellPromotion="notificationBellPromotion",e.NotificationBellPromotionWinHP="notificationBellPromotionWinHP",e.PersonalizeFeedControl="personalizeFeedControl",e.PersonalizeFeedPromotion="personalizeFeedPromotion",e.recommendedSitesPromotionNewLine="recommendedSitesPromotionNewLine",e.recommendedSitesPromotionOff="recommendedSitesPromotionOff",e.RecommendedSitesSelection="recommendedSitesSelection",e.TopQuestionsPromotion="topQuestionsPromotion",e.TopSitesPromotion="topSitesPromotion",e.informationalSwitchOffer="informationalSwitchOffer",e.informationalSwitchCompletion="informationalSwitchCompletion",e.informationalKeepCompletion="informationalKeepCompletion",e.OfficeCoachmarkO365Tab="o365tab2_psl",e.OfficeCoachmarkO365Layout="OfficeCoachmarkO365Layout",e.WeatherPromotion="weatherPromotion",e.SplitScreen="splitScreen",e.OfficeCoachmarkWorkFeedTab="OfficeCoachmarkWorkFeedTab",e.EdgeFeedBelowTheFoldCoachmark="EdgeFeedBelowTheFoldCoachmark",e.stickyPeekOnLoadAutoScroll="OnLoadAutoScrollPrompt",e.stickyPeekOnLoad="OptInStickPromptLoad",e.SignInUpsellPromotionSignIn="signInUpsellPromotionSignIn",e.SignInUpsellPromotionToJoin="signInUpsellPromotionToJoin",e.SignInUpsellPromotionJoined="SignInUpsellPromotionJoined",e.SignInUpsellPromotionClaimed="signInUpsellPromotionClaimed",e.BackgroundImageEditPromotion="backgroundImageEditPromotion",e.BackgroundImagePromotion="backgroundImagePromotion",e.BackgroundImageVideoPromotion="backgroundImageVideoPromotion",e.PinProng1Flyout="pinProng1Flyout",e.NewYearThemeStore="newYearThemeStore",e.NewLayoutReviewCoachmark="newLayoutReview",e.LockScreenLocationCoachmark="lockScreenLocationCoachmark",e.LockScreenPersonalizeCoachmark="lockScreenPersonalize",e.prong1RotationSettingsButton="prong1RotationSettingsButton",e.Prong1SettingsButtonDialog="prong1SettingsButtonDialog",e.prong1ShuffleButton="prong1ShuffleButton",e.RefreshAnimationCoarchmarkKey="prong1RefreshButton",e.prong2ProfileMigration="prong2ProfileMigration",e.prong2PersonalizedButton="prong2PersonalizedButton",e.prong2PlayPivotButton="prong2PlayPivotButton",e.NurturingPlacementManagerTestKey="nurturingPlacementManagerTestKey",e.actionTrayComment="actionTrayComment",e.actionTrayCommentControl="actionTrayCommentControl",e.actionTrayCommentFirst="actionTrayCommentFirst",e.actionTrayCommentFirstControl="actionTrayCommentFirstControl",e.consumptionTopicTag="consumptionTopicTag"}(s||(s={})),function(e){e.Adjacent="Adjacent",e.Center="Center",e.Opposite="Opposite"}(a||(a={})),function(e){e.Outside="Outside",e.Target="Target",e.OutsideAndTarget="OutsideAndTarget"}(c||(c={}))},8887:function(e,t,r){"use strict";r.d(t,{N:function(){return s}});var i=r(5302),n=r(44132),o=r(21215);class s{constructor(e,t,r,i){this.chromiumApiRetryCount=5,this.isNtpPrivateApiAvailable=e=>window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate[e],this.prefSettingKey=e,this.searchForKeyName=t,this.targetKeyName=r,this.defaultItem=i}async getPreferenceSetting(e,t){try{const r=await this.getPreferenceSettingValueArray(t),i=r.findIndex((t=>t[this.searchForKeyName]===e));return i>-1?r[i]:null}catch(t){const r=`Failed to find user preference key: ${e}`;return this.logAppError(i.Aps,r,t),null}}async savePreferenceSetting(e,t){try{const r=await this.getPreferenceSettingValueArray()||[],i=r.findIndex((t=>t[this.searchForKeyName]===e));if(i>-1){const e={...r[i],...t};r[i]=e}else{const i={...this.defaultItem,...t};i[this.searchForKeyName]=e,r.push(i)}return this.setAndSavePreferenceSetting(r)}catch(t){const r="Failed to store user preference setting";return this.logAppError(i.nS9,r,`Key:${e}.Error:${t}`),!1}}isApiAvailableToUse(){return new Promise((e=>{const t="Error in isApiAvailableToUse";try{this.isGoodToUseNtpSettingsPrivate("getAllPrefs")?void 0===this.isPrefSettingKeyAvailable?window.chrome.ntpSettingsPrivate.getAllPrefs((r=>{if(this.isPrefSettingKeyAvailable=r&&r.findIndex((e=>e.key===this.prefSettingKey))>-1,!this.isPrefSettingKeyAvailable){let e="";try{r&&r.forEach((t=>e+=`${t.key}+`))}catch(e){this.logAppError(i.Aps,"Error: Can not log keylist from preference setting",e)}this.logAppError(i.me0,t,`missing preference key: ${this.prefSettingKey}, available keys: ${e}`)}e(this.isPrefSettingKeyAvailable)})):e(this.isPrefSettingKeyAvailable):(this.logAppError(i.MFQ,t,"getAllPrefs not present"),e(!1))}catch(t){this.logAppError(i.MFQ,"Error: Unexpected throw in isApiAvailableToUse",t),e(!1)}}))}logAppError(e,t,r){null===n.M0||void 0===n.M0||n.M0.sendAppErrorEvent({...e,message:t,pb:{...e.pb,customMessage:r}})}async getPreferenceSettingValueArray(e){try{if(this.settingValuesArray&&!e)return this.settingValuesArray;{const e=await this.getPreferenceValueFromBrowser();return this.settingValuesArray=e||[],this.settingValuesArray}}catch(e){const t=`Failed to read ${this.prefSettingKey} preference setting`;return this.logAppError(i.k8J,t,e),[]}}setAndSavePreferenceSetting(e){if(!(0,o.N)())return!1;try{if(this.isGoodToUseNtpSettingsPrivate("setPref"))return this.settingValuesArray=e,window.chrome.ntpSettingsPrivate.setPref(this.prefSettingKey,this.settingValuesArray),!0;{const e="window.chrome.ntpSettingsPrivate.setPref does not exist.";return this.logAppError(i.T5b,e,`Key:${this.prefSettingKey}`),!1}}catch(e){return!1}}isGoodToUseNtpSettingsPrivate(e){let t=this.isNtpPrivateApiAvailable(e),r=0;for(;r<this.chromiumApiRetryCount&&!t;)r++,setTimeout((()=>{t=this.isNtpPrivateApiAvailable(e),t&&n.M0.sendAppErrorEvent({...i.$9$,message:`Chromium API retry succeed after ${r} retry`})}),50);if(!t){const t=`functionName: ${e},\n            canUseDOM: ${(0,o.N)()},\n            windows: ${window},\n            document: ${window&&window.document},\n            createElement: ${window&&window.document&&window.document.createElement},\n            chrome: ${window&&window.chrome},\n            ntpSettingsPrivate: ${window&&window.chrome&&window.chrome.ntpSettingsPrivate},\n            ntpSettingsPrivate funtions: ${window&&window.chrome&&window.chrome.ntpSettingsPrivate&&Object.getOwnPropertyNames(window.chrome.ntpSettingsPrivate).toString()}\n            `;n.M0.sendAppErrorEvent({...i.Fe_,message:"Failed to get funtion from window.chrome.ntpSettingsPrivate.",pb:{...i.Fe_.pb,customMessage:t}})}return t}getPreferenceValueFromBrowser(){return new Promise(((e,t)=>{if(this.isGoodToUseNtpSettingsPrivate("getPref"))window.chrome.ntpSettingsPrivate.getPref(this.prefSettingKey,(function(t){t&&t.value?e(t.value):e(null)}));else{const e="window.chrome.ntpSettingsPrivate.getPref does not exist.";this.logAppError(i.pCD,e,""),t(e)}}))}}},22624:function(e,t,r){"use strict";r.d(t,{L:function(){return c}});var i=r(52185),n=r(81489),o=r(8887),s=r(5302);class a extends o.N{constructor(){super("ntp.record_user_choices","setting","value",{setting:"default",source:"default layout",timestamp:0,value:-1})}static getInstance(){return i.Gq.get("__RecordUserChoicesManager__",(()=>new a))}async deleteKeyValueFromPSL(e){try{let t=await this.getPreferenceSettingValueArray()||[];return t=t.filter((t=>t&&t[this.searchForKeyName]!==e)),this.setAndSavePreferenceSetting(t)}catch(t){const r="Failed to delete user preference setting";return this.logAppError(s.nS9,r,`Key:${e}.Error:${t}`),!1}}}const c=(0,n.h)(a)},95603:function(e,t,r){"use strict";r.d(t,{Nn:function(){return l},Xm:function(){return i},_9:function(){return d},nc:function(){return a},rr:function(){return s},sj:function(){return o}});const i={campaigns:"campaigns",feedLayout:"feed_layout",renderSingleColumn:"render_single_column",wpo:"wpo",wpoLytTmpl:"wpo_lyt_tmpl",topSites:"top_sites",recommendedSites:"recommended_sites",viewport:"viewport",wpo_nx:"wpo_nx",layoutPromotion:"layoutPromotion",layoutHistory:"layoutHistory"};var n,o,s;!function(e){e.Ntp="ntp",e.Wpo="wpo"}(n||(n={})),function(e){e.MultiColumn="multi",e.SingleColumn="single"}(o||(o={})),function(e){e.apiError="api_error"}(s||(s={}));const a={tscollapsed:"tscollapsed",layout_mode:"layout_mode",left_rail:"left_rail",quick_links_options:"quick_links_options",single_column:"single_column",recommended_sites:"recommended_sites",daily_discovery_in_search_box:"daily_discovery_in_search_box",news_below_searchbox:"news_below_searchbox",ntp_tips:"ntp_tips",search_history:"search_history",current_location_enabled:"current_location_enabled",enable_sponsored_content:"enable_sponsored_content",enable_split_screen:"enable_split_screen",hide_search_box:"hide_search_box",seen_interest_fre_count:"seen_interest_fre_count",visited_following_feed:"visited_following_feed",dismiss_scroll_down_button:"dismiss_scroll_down_button",bing_intl_upsell:"bing_intl_upsell",breaking_news_dismissed:"breaking_news_dismissed"};var c;!function(e){e.User="user",e.Wpo="wpo"}(c||(c={}));const d={backgroundImageTypePolicy:"ntp.background_type_blocked_by_policy",currentBackgroundImageType:"ntp.background_image_type",hideDefaultTopSites:"ntp.hide_default_top_sites",customBackgroundImageInfo:"ntp.local_background_image",layout:"ntp.layout_mode",quickLinks:"ntp.show_top_sites",quickLinksDisplaySetting:"ntp.quick_links_options",imageOfTheDay:"ntp.show_image_of_day",feeds:"ntp.news_feed_display",greeting:"ntp.show_greeting",showSettings:"ntp.show_settings",verticalTabsCollapsed:"edge.vertical_tabs.collapsed",verticalTabsOpened:"edge.vertical_tabs.opened",singleColumnEnabled:"ntp.single_column.enabled",userNurturingUpdated:"ntp.user_nurturing",hasUserSeenNewFre:"new_device_fre.has_user_seen_new_fre",defaultBrowserSettingEnabled:"browser.default_browser_setting_enabled",showAppLauncher:"ntp.enable_app_launcher",userChoices:"ntp.record_user_choices",selectedFeedPivot:"ntp.selected_feed_pivot"},l="_split";var f,u;!function(e){e.NotInChinaCoachMarkButton="notInChinaCoachMarkButton",e.FeedbackLink="feedbackLink"}(f||(f={})),function(e){e[e.focused=0]="focused",e[e.inspirational=1]="inspirational",e[e.informational=2]="informational",e[e.custom=3]="custom"}(u||(u={}))},12686:function(e,t,r){"use strict";r.d(t,{J:function(){return n}});var i=r(24709);class n{}n.updateLayout=new i.C("updateLayout"),n.initialize=new i.C("initialize")},52:function(e,t,r){"use strict";r.d(t,{HX:function(){return l},Uq:function(){return a},Wi:function(){return w},iz:function(){return i},nP:function(){return d}});var i,n=r(35448),o=r(57663);!function(e){e[e.MicrosoftNews=0]="MicrosoftNews",e[e.Office365=1]="Office365",e[e.Gaming=2]="Gaming",e[e.Play=3]="Play",e[e.NavigationPage=4]="NavigationPage",e[e.Following=5]="Following"}(i||(i={}));var s,a,c,d,l,f,u,p;!function(e){e.Enforced="ENFORCED",e.Recommended="RECOMMENDED"}(s||(s={})),function(e){e[e.focused=0]="focused",e[e.inspirational=1]="inspirational",e[e.informational=2]="informational",e[e.custom=3]="custom"}(a||(a={})),function(e){e[e.always=0]="always",e[e.peek=1]="peek",e[e.headingsonly=2]="headingsonly",e[e.onscroll=3]="onscroll",e[e.off=4]="off"}(c||(c={})),function(e){e.focused="focused",e.inspirational="inspirational",e.informational="informational",e.custom="custom"}(d||(d={})),function(e){e.bing="bing",e.custom="custom",e.iris="iris",e.off="off",e.theme="theme",e.enterprise="enterprise",e.imageAndVideo="imageAndVideo"}(l||(l={})),function(e){e[e.allowAll=0]="allowAll",e[e.disableImageOfTheDay=1]="disableImageOfTheDay",e[e.disableCustomImage=2]="disableCustomImage",e[e.disableAll=3]="disableAll"}(f||(f={})),function(e){e[e.off=0]="off",e[e.onerow=1]="onerow",e[e.tworows=2]="tworows",e[e.top=3]="top"}(u||(u={})),function(e){e.off="off",e.onerow="onerow",e.tworows="tworows",e.top="top"}(p||(p={}));var g;!function(e){e.off="off",e.onerow="onerow",e.tworows="tworows",e.threerows="threerows"}(g||(g={}));f.allowAll,l.imageAndVideo,d.inspirational,p.onerow;const m={focused:{quick_links:!0,feeds_position:"headingsonly",current_background_image_type:l.off,greeting:!0,hide_promoted_links:!1},inspirational:{quick_links:!0,feeds_position:"peek",current_background_image_type:l.imageAndVideo,greeting:!0,hide_promoted_links:!1},informational:{quick_links:!0,feeds_position:"always",current_background_image_type:l.imageAndVideo,greeting:!0,hide_promoted_links:!1}},h={focused:{quick_links:!0,feeds_position:"headingsonly",current_background_image_type:l.off,greeting:!0,hide_promoted_links:!1},inspirational:{quick_links:!0,feeds_position:"peek",current_background_image_type:l.imageAndVideo,greeting:!0,hide_promoted_links:!1},informational:{quick_links:!0,feeds_position:"always",current_background_image_type:l.imageAndVideo,greeting:!0,hide_promoted_links:!1}},w=o.jG.CurrentRequestTargetScope&&o.jG.CurrentRequestTargetScope.audienceMode===n.F.Enterprise?m:h;w.informational.current_background_image_type,d.informational,w.informational.quick_links,w.informational.hide_promoted_links,w.informational.feeds_position,w.informational.greeting},87015:function(e,t,r){"use strict";var i,n,o;r.d(t,{Ck:function(){return d},I8:function(){return c},MW:function(){return s},OF:function(){return o},UP:function(){return a},_C:function(){return p},be:function(){return i},hZ:function(){return g}}),function(e){e.SetEdgeAsDefault="9",e.SetEdgeAsDefaultV2="rewards_anaheim_install",e.EdgeNTP_NewsDailySet_Child1="EdgeNTP_NewsDailySet_Child1",e.EdgeNTP_NewsDailySet_Child2="EdgeNTP_NewsDailySet_Child2",e.EdgeNTP_NewsDailySet_Child3="EdgeNTP_NewsDailySet_Child3",e.ENUS_infomode_switch_keep_s1_100="ENUS_infomode_switch_keep_s1_100",e.ENUS_infomode_switch_keep_s2_400="ENUS_infomode_switch_keep_s2_400",e.ENUS_infomode_keep_disqualification="ENUS_infomode_keep_disqualification",e.ENUS_FV_sign_in_200points="ENUS_FV_sign_in_200points",e.EdgeNTP_ENTP_AccLink_Promo="EdgeNTP_ENTP_AccLink_Promo",e.ENUS_readarticle10_100points="ENUS_readarticle10_100points",e.ENUS_readarticle5_50points="ENUS_readarticle5_50points",e.ENUS_readarticle3_30points="ENUS_readarticle3_30points",e.ENUS_sharearticle5_20points="ENUS_sharearticle5_20points",e.ENUS_sharearticle10_40points="ENUS_sharearticle10_40points",e.ENUS_sharearticle20_80points="ENUS_sharearticle20_80points",e.BackupPayment="ENUS_readandearn_backup_payment"}(i||(i={})),function(e){e.TopicDataActions="TopicDataActions",e.LayoutActions="LayoutActions"}(n||(n={})),function(e){e.TryInformationalMode="TryInformationalMode",e.SetEdgeAsDefault="SetEdgeAsDefault"}(o||(o={}));const s="SwitchPageLayout",a="https://www.bing.com/fd/auth/signin?action=acclink&provider=windows_live_id&return_url=https://www.bing.com&src=EXPLICIT&cobrandid=6bc5c73f-92af-46e7-87d4-c9c4ea2cb56d&publ=RewardsDO&pn=AccountLinking&crea=ML2DRL",c=new Map;c.set(i.SetEdgeAsDefault,!1),c.set(i.SetEdgeAsDefaultV2,!1),c.set(i.ENUS_infomode_switch_keep_s1_100,!1);const d=new Map,l={experienceConnector:n.LayoutActions,actionName:o.TryInformationalMode,requiredCount:1,observedActivityCount:0},f={activities:[{experienceConnector:n.LayoutActions,actionName:o.SetEdgeAsDefault,requiredCount:1,observedActivityCount:0}],isRewardActivityComplete:!1,isOfferReported:!1},u={activities:[l],isRewardActivityComplete:!1,isOfferReported:!1,isLocalMessage:!0,isLocalFollowOnMessage:!0};d.set(i.SetEdgeAsDefault,[f]),d.set(i.SetEdgeAsDefaultV2,[f]),d.set(i.ENUS_infomode_switch_keep_s1_100,[u]);const p="ML2K2O",g="CONTENTSERVICES"},71940:function(e,t,r){"use strict";r.r(t),r.d(t,{ActionName:function(){return i.OF},OfferId:function(){return i.be},RewardsDataActions:function(){return o},RewardsDataConnector:function(){return I},RewardsDataReducer:function(){return D},RewardsServiceClient:function(){return y},ToolingInfo:function(){return L},mockConfig:function(){return $.mockConfig}});var i=r(87015),n=r(24709);class o{}o.setIsRewardsUser=new n.C("SetIsRewardsUser"),o.setRewardPoints=new n.C("SetRewardPoints"),o.setUnclaimedRewardPoints=new n.C("SetUnclaimedRewardPoints"),o.setRewardsOffers=new n.C("SetRewardsOffer"),o.setRewardsTokens=new n.C("SetRewardsTokens"),o.setRewardsEligibility=new n.C("SetRewardsEligibility");var s=r(1019),a=r(62907),c=r(523),d=r(57663),l=r(20076),f=r(15598),u=r(12686),p=r(52),g=r(5302),m=r(29363),h=r(7766),w=r(88048),_=r(32308),S=r(44132);function v(e){const t={...e.headers||{}};return Object.keys(t).forEach((e=>{/authorization/i.test(e)&&delete t[e]})),JSON.stringify({...e,headers:t})}class y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.endpointV2=e,this.fetchRewardsProfileServiceEndpoint="./News/Users/me/Rewards",this.reportRewardsActivityServiceEndpoint="./News/Users/me/RewardsActivities",this.ocid="rewards-peregrine",this.eventType="Default"}async getRewardsUserProfile(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e!==a.Hy.SignedIn&&!this.endpointV2)return null;const r={method:"GET",credentials:"include",cache:"no-cache",headers:await h.$D.getOneServiceHeaders()};let i;i=t?(0,w.PH)(this.fetchRewardsProfileServiceEndpoint,w.Ph):(0,w.PH)(this.fetchRewardsProfileServiceEndpoint);[...h.$D.getOneServiceParamsWithAuth((0,d.Yq)().UserId,this.ocid)].forEach((e=>{e.value&&i.searchParams.set(e.key,e.value)})),this.endpointV2&&i.searchParams.set("version","2");try{var n;const e=await(0,_.w)((async()=>{const e=await fetch(i.href,r);return 404===e.status?{}:e.ok?e.json():(400===e.status?S.M0.sendAppErrorEvent({...g.lZX,message:"Bad request on account of invalid parameters",pb:{...g.lZX.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(r)} Service url: ${i.href}`}}):500===e.status?S.M0.sendAppErrorEvent({...g.bwz,message:"Error fetching user profile",pb:{...g.bwz.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(r)} Service url: ${i.href}`}}):S.M0.sendAppErrorEvent({...g.QUT,message:"Unknown error occurred while fetching user profile",pb:{...g.QUT.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(r)} Service url: ${i.href}`}}),null)}),"getUserProfileResponse");return{response:e,debugId:null==e||null===(n=e.headers)||void 0===n?void 0:n.get("ddd-debugid")}}catch(e){return S.M0.sendAppErrorEvent({...g.r_t,message:"Exception during user profile service call",pb:{...g.r_t.pb,customMessage:`Error code: ${e?e.code:"undefined"} Error message: ${e?e.message:"undefined"}\n                        Request params: ${v(r)} Service url: ${i.href}`}}),null}}async createRewardsProfile(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r={method:"POST",credentials:"include",cache:"no-cache",headers:await h.$D.getOneServiceHeaders()},i=(0,w.PH)(this.fetchRewardsProfileServiceEndpoint);i.searchParams.set("fdhead","prg-1s-acclnk-puid");[...h.$D.getOneServiceParamsWithAuth((0,d.Yq)().UserId,this.ocid)].forEach((e=>{e.value&&i.searchParams.set(e.key,e.value)})),e&&i.searchParams.set("crea",e),t&&i.searchParams.set("program",t),this.endpointV2&&i.searchParams.set("version","2");try{await(0,_.w)((async()=>{const e=await fetch(i.href,r);return!!e.ok||(400===e.status?S.M0.sendAppErrorEvent({...g.lZX,message:"Bad request on account of invalid parameters",pb:{...g.lZX.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(r)} Service url: ${i.href}`}}):500===e.status?S.M0.sendAppErrorEvent({...g.bwz,message:"Error creating user profile",pb:{...g.bwz.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(r)} Service url: ${i.href}`}}):S.M0.sendAppErrorEvent({...g.QUT,message:"Unknown error occurred while fetching user profile",pb:{...g.QUT.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(r)} Service url: ${i.href}`}}),!1)}),"createProfileResponse");return!0}catch(e){return S.M0.sendAppErrorEvent({...g.r_t,message:"Exception during create user profile service call",pb:{...g.r_t.pb,customMessage:`Error code: ${e?e.code:"undefined"} Error message: ${e?e.message:"undefined"}\n                        Request params: ${v(r)} Service url: ${i.href}`}}),!1}}async reportMsRewardsActivity(e,t,r,i){if(e!==a.Hy.SignedIn)return null;const n=new Date,o=(0,d.Yq)(),s={method:"POST",body:JSON.stringify({activityId:o.ActivityId,eventType:t,dateTime:n.toISOString(),timezoneOffset:this.getDateTimezoneOffSet(n),market:o.CurrentMarket,offerId:r,pageType:o.TrackInfo&&o.TrackInfo.sitePage&&o.TrackInfo.sitePage.page_type,product:o.TrackInfo&&o.TrackInfo.sitePage&&o.TrackInfo.sitePage.page_product,eventContext:i}),headers:await h.$D.getOneServiceHeaders(),credentials:"include"},c=(0,w.PH)(this.reportRewardsActivityServiceEndpoint);[...h.$D.getOneServiceParamsWithAuth(o.UserId,this.ocid)].forEach((e=>{e.value&&c.searchParams.set(e.key,e.value)}));try{return!!await(0,_.w)((async()=>{const e=await fetch(c.href,s);return e.ok?e.json():(400===e.status?S.M0.sendAppErrorEvent({...g.UHb,message:"Bad request when reporting rewards",pb:{...g.UHb.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(s)} Service url: ${c.href}`}}):500===e.status?S.M0.sendAppErrorEvent({...g.Aeb,message:"Unknown errors when reporting rewards",pb:{...g.Aeb.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(s)} Service url: ${c.href}`}}):S.M0.sendAppErrorEvent({...g.QUT,message:"Unknown errors occurred when reporting rewards",pb:{...g.QUT.pb,customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${v(s)} Service url: ${c.href}`}}),!1)}),"reportMsRewardsActivity")}catch(e){return S.M0.sendAppErrorEvent({...g.A31,message:"Exception reporting reward activity",pb:{...g.A31.pb,customMessage:`Error code: ${e?e.code:"undefined"} Error message: ${e?e.message:"undefined"}\n                        Request params: ${v(s)} Service url: ${c.href}`}}),!1}}async reportMsRewardsActivityV2(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=new Date,n=(0,d.Yq)();let o;r?(i.setMinutes(i.getMinutes()-480),o=i.toISOString(),o=`${o.substring(0,o.length-1)}0001-08:00`):o=i.toISOString();const s={method:"POST",body:JSON.stringify({activityId:n.ActivityId,eventType:this.eventType,dateTime:o,timezoneOffset:this.getDateTimezoneOffSet(i),market:n.CurrentMarket,pageType:n.TrackInfo&&n.TrackInfo.sitePage&&n.TrackInfo.sitePage.page_type,product:n.TrackInfo&&n.TrackInfo.sitePage&&n.TrackInfo.sitePage.page_product,eventContext:{offerId:e},version:2,activityType:t}),headers:await h.$D.getOneServiceHeaders(),credentials:"include"},a=(0,w.PH)(this.reportRewardsActivityServiceEndpoint);[...h.$D.getOneServiceParamsWithAuth(n.UserId,this.ocid)].forEach((e=>{e.value&&a.searchParams.set(e.key,e.value)}));try{return await(0,_.w)((async()=>{var e;const t=await fetch(a.href,s);var r;return t.ok?{success:!!t.json(),debugId:null==t||null===(e=t.headers)||void 0===e?void 0:e.get("ddd-debugid")}:(400===t.status?S.M0.sendAppErrorEvent({...g.UHb,message:"Bad request when reporting rewards",pb:{...g.UHb.pb,customMessage:`Error code: ${t.status} Error message: ${t.statusText}\n                                        Request params: ${v(s)} Service url: ${a.href}`}}):500===t.status?S.M0.sendAppErrorEvent({...g.Aeb,message:"Unknown errors when reporting rewards",pb:{...g.Aeb.pb,customMessage:`Error code: ${t.status} Error message: ${t.statusText}\n                                        Request params: ${v(s)} Service url: ${a.href}`}}):S.M0.sendAppErrorEvent({...g.QUT,message:"Unknown errors occurred when reporting rewards",pb:{...g.QUT.pb,customMessage:`Error code: ${t.status} Error message: ${t.statusText}\n                                        Request params: ${v(s)} Service url: ${a.href}`}}),{success:!1,debugId:null==t||null===(r=t.headers)||void 0===r?void 0:r.get("ddd-debugid")})}),"reportMsRewardsActivityV2")}catch(e){return S.M0.sendAppErrorEvent({...g.A31,message:"Exception reporting reward activity V2",pb:{...g.A31.pb,customMessage:`Error code: ${e?e.code:"undefined"} Error message: ${e?e.message:"undefined"}\n                        Request params: ${v(s)} Service url: ${a.href}`}}),{success:!1}}}getDateTimezoneOffSet(e){if(!e)return"";let t=e.getTimezoneOffset();const r=t<0?"+":"-";t=Math.abs(t);return`${r}${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`}}var b=r(17395),P=r(44887),k=r(30666);let E;const C=()=>E;var A=r(27940),R=r(21215),U=r(91734),T=r(95603);var O=r(90351),M=r(22745);class I extends k.e{constructor(e,t,r,n,o,s,c){super(e,t,r,n,o,s,c),this.signInStatus=a.Hy.Unknown,this.offerPlacedOnUserScreen=void 0,this.activityTrackerMap=void 0,this.bingRewardsOfferStatusMap=void 0,this.rewardsServiceClient=new y(s.endpointV2),this.offerPlacedOnUserScreen=i.I8,this.activityTrackerMap=i.Ck,this.bingRewardsOfferStatusMap=new Map,s.enableRewardsOffers&&("windowsShell"!==d.jG.AppType&&"windowsShellV2"!==d.jG.AppType?(0,b.rr)().then((e=>{var t;if(this.signInStatus=e,e!==a.Hy.SignedIn&&!this.config.endpointV2)return;const r=(null===(t=(0,d.Yq)())||void 0===t?void 0:t.isAadAccountUser)||e===a.Hy.SignedIn&&(0,b.xQ)()===a.Qm.AAD,i=(0,l.u6)();if(r){const e=P.gz.AccountLinkPromoENTP;if(this.config.enableLocalStampForAccLink){this.checkAndLocalStamp(e)||i||(this.checkAndLocalStamp(e,!0),this.config.enableAccountLinkPromotion&&this.sendAccountLinkToJoinPlacement())}}else this.fetchUserProfile().then((async()=>{this.getCurrentState().isRewardsUser&&(this.setOffersInState(),this.setEligibilityInState(),this.setTokensInState(),this.registerObservers(),this.syncActivityTrackerMapWithIrisOffers(),this.config.enableInformationalPromotion&&this.promoteInformationalOffers()),this.config.signInPromotionActive&&this.promoteSigninUpsell()}))})):this.fetchUserProfile())}async sendAccountLinkToJoinPlacement(){if(await this.getRewardsCoachmarkDataConnector(),!this.rewardsCoachmarkDataConnector)return void S.M0.sendAppErrorEvent({...g.P8E,message:"RewardsCoachmarkDataConnector is not defined, cannot proceed with account link promotion."});const e=this.showLinkAccountPrompt.bind(this);S.M0.addOrUpdateTmplProperty("rewardscm_accLinkPromotion_show","1"),this.rewardsCoachmarkDataConnector.sendAccountLinkToJoinPlacement({onEngage:e})}async showLinkAccountPrompt(){window.open(i.UP,"_self")}async promoteSigninUpsell(){this.config.processPromotionsAfterTTVR&&await(0,m.b1)(),await this.getRewardsCoachmarkDataConnector();const{isRewardsUser:e,isSignedIn:t}=await this.checkAndLogUserStatus();if(!t)return;const r=await this.checkIfSignInUpsellPromotionSignInViewed();S.M0.addOrUpdateTmplProperty("rewardscm_signinviewed",r?"1":"0"),r&&(e?this.promoteSigninUpsellForRewardsUser():this.promoteSigninUpsellForNotRewardsUser())}async checkIfSignInUpsellPromotionSignInViewed(){var e,t,r,i;if(null!==(e=this.config)&&void 0!==e&&e.skipCheckSignInPromViewed)return!0;const n=(null===(t=await(null===(r=C())||void 0===r||null===(i=r.getInteractions)||void 0===i?void 0:i.call(r)))||void 0===t?void 0:t[P.gz.SignInUpsellPromotionSignIn])||[];if(!n.length)return!1;let o=0;if(n.forEach((e=>{e.ts>o&&(o=e.ts)})),"number"!=typeof o||o<=0)return S.M0.sendAppErrorEvent({...g.Yym,message:"Latest view timestamp of Sign in upsell promotion of signing not a positive number"}),!1;return!((new Date).getTime()-o>2592e6)}async promoteSigninUpsellForRewardsUser(){var e,t;if(null!==(e=this.bingRewardsOfferStatusMap.get(i.be.ENUS_FV_sign_in_200points))&&void 0!==e&&e.isComplete){var r,n,o;var s,a;await this.checkIfOfferCompletionCoachMarkMissed(i.be.ENUS_FV_sign_in_200points,P.gz.SignInUpsellPromotionClaimed,null===(r=this.config)||void 0===r||null===(n=r.completionCoachmarkOffers)||void 0===n||null===(o=n[i.be.ENUS_FV_sign_in_200points])||void 0===o?void 0:o.maxEligibleTimeInHours)&&(null===(s=this.rewardsCoachmarkDataConnector)||void 0===s||null===(a=s.sendSignInUpsellPromotionClaimedPlacement)||void 0===a||a.call(s))}else{var c,d,l;if(S.M0.addOrUpdateTmplProperty("rewardscm_singinClaimed_eligible","1"),null!==(t=this.config)&&void 0!==t&&t.enableSignInPromotion)if(await this.reportRewardsAction(i.be.ENUS_FV_sign_in_200points),null!==(c=this.bingRewardsOfferStatusMap.get(i.be.ENUS_FV_sign_in_200points))&&void 0!==c&&c.isComplete)null===(d=this.rewardsCoachmarkDataConnector)||void 0===d||null===(l=d.sendSignInUpsellPromotionClaimedPlacement)||void 0===l||l.call(d);else S.M0.sendAppErrorEvent({...g.ZKD,message:"Rewards sign in offer not completed for rewards user",pb:{...g.ZKD.pb,customMessage:"Fail to complete sign-in offer for rewards user"}})}}async promoteSigninUpsellForNotRewardsUser(){var e;if(S.M0.addOrUpdateTmplProperty("rewardscm_singinToJoin_eligible","1"),null!==(e=this.config)&&void 0!==e&&e.enableSignInPromotion){var t,r;const e=this.joinAndClaimSignInUpsellRewardsOffer.bind(this);null===(t=this.rewardsCoachmarkDataConnector)||void 0===t||null===(r=t.sendSignInUpsellPromotionToJoinPlacement)||void 0===r||r.call(t,{onEngage:e})}}async checkAndLogUserStatus(){var e;const t=this.getCurrentState().isRewardsUser,r=await this.checkIsSignedIn(),n=this.bingRewardsOfferStatusMap.has(i.be.ENUS_FV_sign_in_200points);let o="";return o=(null===(e=this.bingRewardsOfferStatusMap.get(i.be.ENUS_FV_sign_in_200points))||void 0===e?void 0:e.isComplete)?"2":n?"1":"0",S.M0.addOrUpdateTmplProperty("rewardscm_userState",`${t?"1":"0"}_${r?"1":"0"}_${o}`),{isRewardsUser:t,isSignedIn:r}}checkIsSignedIn(){return new Promise((e=>{var t,r,i,n,o,s;null!==(t=window)&&void 0!==t&&null!==(r=t.chrome)&&void 0!==r&&null!==(i=r.authPrivate)&&void 0!==i&&i.getPrimaryAccountInfo?null===(n=window)||void 0===n||null===(o=n.chrome)||void 0===o||null===(s=o.authPrivate)||void 0===s||s.getPrimaryAccountInfo((t=>{const r=(null==t?void 0:t.account_id)||"";e(!!r)})):e(!1)}))}async joinAndClaimSignInUpsellRewardsOffer(){var e;if(await this.createRewardsProfile(i._C,i.hZ),await this.fetchUserProfile(),this.setOffersInState(),await this.reportRewardsAction(i.be.ENUS_FV_sign_in_200points),null!==(e=this.bingRewardsOfferStatusMap.get(i.be.ENUS_FV_sign_in_200points))&&void 0!==e&&e.isComplete)return!0;{let e="";return e=this.getCurrentState().isRewardsUser?this.bingRewardsOfferStatusMap.get(i.be.ENUS_FV_sign_in_200points)?"User already completed sign-in offer":"No sign-in offer in user profile":"Fail to become a rewards user",S.M0.sendAppErrorEvent({...g.ZKD,message:"Rewards sign in offer not completed for non-rewards user",pb:{...g.ZKD.pb,customMessage:e}}),!1}}async fetchUserProfile(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.rewardsUserProfileResponse=await this.rewardsServiceClient.getRewardsUserProfile(this.signInStatus,e),!this.rewardsUserProfileResponse||!this.rewardsUserProfileResponse.response)return;const t=(0,O.Z)(this.rewardsUserProfileResponse.response,"profile.points",void 0),r=null!=t;o.setIsRewardsUser.getActionSender(this).send(r),S.M0.addOrUpdateTmplProperty("rewardscm_isRewardsUser",r?"1":"0"),r&&o.setRewardPoints.getActionSender(this).send(t);const i=(0,O.Z)(this.rewardsUserProfileResponse.response,"offers",void 0);i&&(i.forEach((e=>{this.config.endpointV2?this.bingRewardsOfferStatusMap.set(e.offerId,{activityType:e.activityType,isComplete:"True"===e.isComplete,progress:e.progress||0,points:e.points||0,maxPoints:e.maxPoints,offerId:e.offerId,completionDate:e.completionDate?new Date(e.completionDate):null}):this.bingRewardsOfferStatusMap.set(e.offerId,{activityType:e.offerId,isComplete:"True"===e.isComplete,progress:e.progress||0,points:e.points||0,maxPoints:e.maxPoints,offerId:e.offerId})})),this.bingRewardsOffers=i)}registerObservers(){var e;u.J.updateLayout.registerObserver((e=>{const t=e&&e.params;!t||t.length<1||t[0].currentLayout!=p.nP.informational&&"always"!==t[0].selectedFeedDisplaySetting&&this.checkEligibilityInformationalSwitchOffer()})),null!==(e=this.config)&&void 0!==e&&e.useNFSwitchOfferCoachMark||document.addEventListener("changeToInformationalSuccess",(e=>{this.trackRewardActions(i.be.ENUS_infomode_switch_keep_s1_100,i.MW)})),document.addEventListener("setDefaultBrowserSuccess",(e=>{this.config.endpointV2?this.trackRewardActions(i.be.SetEdgeAsDefaultV2,i.OF.SetEdgeAsDefault,!1):this.trackRewardActions(i.be.SetEdgeAsDefault,i.OF.SetEdgeAsDefault,!1)})),(0,M.Uo)(c.z.RewardsCoachmarkData,(e=>{var t;null!=e&&null!==(t=e.activeCoachmark)&&void 0!==t&&t.offerId&&this.offerPlacedOnUserScreen.has(e.activeCoachmark.offerId)&&this.offerPlacedOnUserScreen.set(e.activeCoachmark.offerId,!0)}))}async switchInformationalLayoutAndReportAction(){var e,t;return((e,t,r)=>{if(e===t||!r)return;let i;if(e!==p.nP.custom){const r=p.Wi[e];i={currentBackgroundImageType:r.current_background_image_type,originalLayout:t,currentLayout:e,greetingEnabled:r.greeting,imageOfTheDayEnabled:r.current_background_image_type!==p.HX.off,quickLinksEnabled:r.quick_links,hideDefaultTopSites:r.hide_promoted_links,selectedFeedDisplaySetting:r.feeds_position}}else{const t=r.getCurrentState();i={...t,originalLayout:t.currentLayout,currentLayout:e}}r.updateLayout(i),(0,U.qi)(T.nc.layout_mode,p.Uq[i.currentLayout])})(p.nP.informational,this.chromiumPageSettingsConnector.getCurrentState().currentLayout,this.chromiumPageSettingsConnector),!(!this.bingRewardsOfferStatusMap.has(i.be.ENUS_infomode_switch_keep_s1_100)||null!==(e=this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s1_100))&&void 0!==e&&e.isComplete)&&(await this.reportRewardsAction(i.be.ENUS_infomode_switch_keep_s1_100),null===(t=this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s1_100))||void 0===t?void 0:t.isComplete)}async reportRewardsAction(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return void S.M0.sendAppErrorEvent({...g.gr5,message:"OfferId is not defined"});if(this.isOfferDisabled(e))return;if(null===(t=this.config)||void 0===t||!t.reportingActivityEndpointV2)return void S.M0.sendAppErrorEvent({...g.oPt,message:"Only version 2 end point is supported"});const i=this.getCurrentState().rewardsOffers;if(!i||!i.length)return;const n=i.find((t=>t.offerId===e));if(!n||n.isComplete)return;this.checkAndStampForActivityReporting(e);const o=await this.rewardsServiceClient.reportMsRewardsActivityV2(n.offerId,n.activityType,r);await this.fetchUserProfileToGetOffersWithRetry(e,null==o?void 0:o.debugId,void 0,(()=>{this.setOffersInState()}))}async createRewardsProfile(e,t){return await this.rewardsServiceClient.createRewardsProfile(e,t)}async trackRewardActions(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return void S.M0.sendAppErrorEvent({...g.gr5,message:"OfferId is not defined"});if(!t)return void S.M0.sendAppErrorEvent({...g.cg9,message:"Action name is not defined"});const i=this.activityTrackerMap.get(e);i&&this.bingRewardsOfferStatusMap.has(e)&&!this.bingRewardsOfferStatusMap.get(e).isComplete&&(this.offerPlacedOnUserScreen.has(e)&&!this.offerPlacedOnUserScreen.get(e)||i.forEach((async i=>{if(!i.isRewardActivityComplete){let e=!0;i.activities.forEach((t=>{let r=!1;++t.observedActivityCount>=t.requiredCount&&(r=!0),e=e&&r})),i.isRewardActivityComplete=e}if(!i.isOfferReported&&i.isRewardActivityComplete){this.checkAndStampForActivityReporting(e);let o="";if(this.config.reportingActivityEndpointV2){const t=await this.rewardsServiceClient.reportMsRewardsActivityV2(e,this.bingRewardsOfferStatusMap.get(e).activityType);i.isOfferReported=t.success,o=t.debugId}else{var n;i.isOfferReported=await this.rewardsServiceClient.reportMsRewardsActivity(this.signInStatus,t,null===(n=this.bingRewardsOfferStatusMap.get(e).activityType)||void 0===n?void 0:n.toString())}r&&this.renderFollowOnMessage(i,e,o)}})))}async renderFollowOnMessage(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.isOfferReported&&this.renderFollowOnMessageForOffer(t,e.isLocalFollowOnMessage,r)}async renderFollowOnMessageForOffer(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.fetchUserProfileToGetOffersWithRetry(e,r,t,((e,t)=>{t&&this.rewardsCoachmarkDataConnector&&this.rewardsCoachmarkDataConnector.addFollowOnCoachmarksForOffer(e)}))}syncActivityTrackerMapWithIrisOffers(){this.activityTrackerMap.forEach(((e,t)=>{e.some((e=>e.isLocalMessage))&&!this.isOfferDisabled(t)||this.activityTrackerMap.delete(t)}))}async getChromiumPageSettingsConnector(){const e=await A._.getInstance().rootReducer.getDataConnector(c.z.ChromiumPageSettings);this.chromiumPageSettingsConnector=e}async getRewardsCoachmarkDataConnector(){if(!this.rewardsCoachmarkDataConnector){const e=await A._.getInstance().rootReducer.getDataConnector(c.z.RewardsCoachmarkData);this.rewardsCoachmarkDataConnector=e}}async delay(e){return new Promise((t=>window.setTimeout(t,e)))}setTokensInState(){this.rewardsUserProfileResponse&&this.rewardsUserProfileResponse.response&&o.setRewardsTokens.getActionSender(this).send(this.rewardsUserProfileResponse.response.tokens||[])}setEligibilityInState(){this.rewardsUserProfileResponse&&this.rewardsUserProfileResponse.response&&o.setRewardsEligibility.getActionSender(this).send({backupPayment:this.rewardsUserProfileResponse.response.eligibleBackupPayment||!1,freeTipping:this.rewardsUserProfileResponse.response.eligibleFreeTipping||!1,freeSubscription:this.rewardsUserProfileResponse.response.eligibleFreeSubscription,autoOpen:"edgeChromium"===d.jG.AppType&&this.rewardsUserProfileResponse.response.auto_open||!1})}setOffersInState(){let e;e="views"==d.jG.AppType?[i.be.ENUS_readarticle3_30points,i.be.ENUS_readarticle5_50points,i.be.ENUS_readarticle10_100points,i.be.ENUS_sharearticle5_20points,i.be.ENUS_sharearticle10_40points,i.be.ENUS_sharearticle20_80points,i.be.BackupPayment]:[i.be.EdgeNTP_NewsDailySet_Child1,i.be.EdgeNTP_NewsDailySet_Child2,i.be.EdgeNTP_NewsDailySet_Child3,i.be.ENUS_infomode_switch_keep_s2_400,i.be.ENUS_infomode_switch_keep_s1_100,i.be.ENUS_FV_sign_in_200points];const t=[];e.forEach((e=>{this.bingRewardsOfferStatusMap.has(e)&&t.push(this.bingRewardsOfferStatusMap.get(e))})),0!=t.length&&o.setRewardsOffers.getActionSender(this).send(t)}isOfferDisabled(e){const t=this.config.disableOffers;return t&&t[e]&&t[e].disable}checkEligibilityInformationalSwitchOffer(){if(this.isOfferDisabled(i.be.ENUS_infomode_keep_disqualification)||!this.bingRewardsOfferStatusMap.has(i.be.ENUS_infomode_keep_disqualification)||this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_keep_disqualification).isComplete)return;if(!this.bingRewardsOfferStatusMap.has(i.be.ENUS_infomode_switch_keep_s1_100))return;const e=this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s1_100);!e.isComplete||!e.completionDate||Date.now()-e.completionDate.getTime()>6048e5||(this.checkAndStampForActivityReporting(i.be.ENUS_infomode_keep_disqualification),this.rewardsServiceClient.reportMsRewardsActivityV2(i.be.ENUS_infomode_keep_disqualification,this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_keep_disqualification).activityType))}async promoteInformationalOffers(){var e,t;const r=[null!==(e=this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s1_100))&&void 0!==e&&e.isComplete?"1":"0",null!==(t=this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s2_400))&&void 0!==t&&t.isComplete?"1":"0"];if(S.M0.addOrUpdateTmplProperty("rewardscm_infoOfferStatus",r.join("_")),this.config.processPromotionsAfterTTVR){if(!(0,R.N)())return;await(0,m.b1)()}await this.getRewardsCoachmarkDataConnector(),this.rewardsCoachmarkDataConnector?(await this.getChromiumPageSettingsConnector(),this.chromiumPageSettingsConnector&&(this.promoteInformationalSwitchOffer(),this.promoteInformationalKeepOffer())):S.M0.sendAppErrorEvent({...g.P8E,message:"RewardsCoachmarkDataConnector is not defined"})}async promoteInformationalSwitchOffer(){var e;if(!(this.bingRewardsOfferStatusMap.has(i.be.ENUS_infomode_switch_keep_s1_100)&&!this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s1_100).isComplete&&!this.isOfferDisabled(i.be.ENUS_infomode_switch_keep_s1_100)))return;const t=null===(e=this.chromiumPageSettingsConnector)||void 0===e?void 0:e.getCurrentState();if(!t||!t.configData||!t.configData.inPageSearchBoxType)return void S.M0.sendAppErrorEvent({...g.hJt,message:"PageSettings or inPageSearchBoxType not defined"});if(!t||!t.selectedFeedDisplaySetting||"always"===t.selectedFeedDisplaySetting)return;const r=this.switchInformationalLayoutAndReportAction.bind(this);await this.rewardsCoachmarkDataConnector.addInformationalSwitchOfferCoachmark(r)}async promoteInformationalKeepOffer(){var e,t;if(!this.bingRewardsOfferStatusMap.has(i.be.ENUS_infomode_switch_keep_s2_400)||this.isOfferDisabled(i.be.ENUS_infomode_switch_keep_s2_400))return;if(!this.bingRewardsOfferStatusMap.has(i.be.ENUS_infomode_switch_keep_s1_100))return;const r=this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s1_100);if(!r||!r.isComplete||!r.completionDate)return;if(null!==(e=this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s2_400))&&void 0!==e&&e.isComplete){if(this.config.useNFSwitchOfferCoachMark){var n,o,s,a;const e=await this.checkIfOfferCompletionCoachMarkMissed(i.be.ENUS_infomode_switch_keep_s2_400,P.gz.informationalKeepCompletion),t=Date.now()-((null===(n=this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s1_100))||void 0===n||null===(o=n.completionDate)||void 0===o?void 0:o.getTime())||0),r=((null===(s=this.config.completionCoachmarkOffers)||void 0===s||null===(a=s[i.be.ENUS_infomode_switch_keep_s2_400])||void 0===a?void 0:a.maxEligibleTimeInHours)||0)+168;var c,d;if(e&&t<=60*r*60*1e3)S.M0.addOrUpdateTmplProperty("rewardscm_infokeep_trigger_missed","1"),null===(c=this.rewardsCoachmarkDataConnector)||void 0===c||null===(d=c.promoteInformationalKeepCompletion)||void 0===d||d.call(c)}return}const l=r.completionDate.getTime();if(!l||Date.now()-l<=6048e5||l<new Date("10/24/2022 UTC").getTime())return;const f=null===(t=this.chromiumPageSettingsConnector)||void 0===t?void 0:t.getCurrentState();f&&f.currentLayout?f.currentLayout!==p.nP.informational&&"always"!==f.selectedFeedDisplaySetting||this.reportRewardsAction(i.be.ENUS_infomode_switch_keep_s2_400).then((()=>{var e,t;this.bingRewardsOfferStatusMap.has(i.be.ENUS_infomode_switch_keep_s2_400)&&this.bingRewardsOfferStatusMap.get(i.be.ENUS_infomode_switch_keep_s2_400).isComplete&&(S.M0.addOrUpdateTmplProperty("rewardscm_infokeep_trigger","1"),null===(e=this.rewardsCoachmarkDataConnector)||void 0===e||null===(t=e.promoteInformationalKeepCompletion)||void 0===t||t.call(e))})):S.M0.sendAppErrorEvent({...g.I2u,message:"PageSettings or currentLayout not defined"})}checkAndStampForActivityReporting(e){if(!e)return;const t=this.config.tmplReportingActivityOffers;if(t&&t[e]&&t[e].enabledTMPL){let r="";r=t[e].tmplString?t[e].tmplString:`UserReportingRewardsActivityForOffer_${e}`,S.M0.addOrUpdateTmplProperty(r,"1")}}async fetchUserProfileToGetOffersWithRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,n=!0,o=0;let s=this.config.delayGetUserProfileCallInMs?this.config.delayGetUserProfileCallInMs:500,a=!1;for(;n&&o<5;o++)await this.delay(s),!a&&o>3&&this.config.allowRetryWithAltDomain&&(a=!0),await this.fetchUserProfile(a),this.bingRewardsOfferStatusMap.has(e)&&this.bingRewardsOfferStatusMap.get(e).isComplete&&(n=!1,i(e,r)),s*=2;n&&S.M0.sendAppErrorEvent({...g.q6p,message:"Max retry attempt reached to update rewards points on user screen",pb:{...g.q6p.pb,customMessage:`Attempted ${o} times but user's reward points were not updated for Offer Id : ${e}`,debugId:t,rewardsUserProfileResponse:JSON.stringify(this.rewardsUserProfileResponse)}})}checkAndLocalStamp(e){if(!e)return!1;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])return S.M0.addOrUpdateTmplProperty(e,"1"),(0,f.$o)().setItem(`${e}_Stamped`,"true"),!0;const t=`${e}_Stamped`;return!!(0,f.$o)().getItem(t)&&(S.M0.addOrUpdateTmplProperty(e,"1"),!0)}async checkIfOfferCompletionCoachMarkMissed(e,t,r){var i,n,o,s,a,c,d,l;if(null===(i=this.config.completionCoachmarkOffers)||void 0===i||null===(n=i[e])||void 0===n||!n.enabled)return!1;if(null===(o=this.bingRewardsOfferStatusMap.get(e))||void 0===o||!o.isComplete)return!1;const f=await(null===(s=C())||void 0===s||null===(a=s.getInteractions)||void 0===a?void 0:a.call(s));if(((null==f||null===(c=f[t])||void 0===c?void 0:c.length)??0)>0)return!1;const u=(null===(d=this.bingRewardsOfferStatusMap.get(e))||void 0===d||null===(l=d.completionDate)||void 0===l?void 0:l.getTime())||0,p=Date.now()-u;return!((r||0)>0&&u>0&&p>60*r*60*1e3)}}var N=r(38947);class D{reduce(e,t){if(!e)return{isRewardsUser:void 0,rewardPoints:void 0,unclaimedRewardPoints:void 0,rewardsOffers:void 0,rewardsTokens:void 0,rewardsEligibility:void 0};if(!t)return e;let r,i=!1;return i=i||N.G.handleAction(t,o.setIsRewardsUser,(t=>{r={...e,isRewardsUser:t}})),i=i||N.G.handleAction(t,o.setRewardPoints,(t=>{r={...e,rewardPoints:t}})),i=i||N.G.handleAction(t,o.setUnclaimedRewardPoints,(t=>{r={...e,unclaimedRewardPoints:t}})),i=i||N.G.handleAction(t,o.setRewardsOffers,(t=>{r={...e,rewardsOffers:t}})),i=i||N.G.handleAction(t,o.setRewardsTokens,(t=>{r={...e,rewardsTokens:t}})),i=i||N.G.handleAction(t,o.setRewardsEligibility,(t=>{r={...e,rewardsEligibility:t}})),r||e}}var $=r(44131);const L={experienceConfigSchema:s.RewardsDataConfigSchema,mockConfig:$.mockConfig,defaultMockState:{},mockState:[{key:"preview",value:{}}]}},44131:function(){},1019:function(){}}]);