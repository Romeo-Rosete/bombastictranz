"use strict";(self.webpackChunk_msnews_msnews_experiences=self.webpackChunk_msnews_msnews_experiences||[]).push([["social-data-connector","msnews/publishers-service-client"],{40053:function(e,t,n){var i;n.d(t,{S:function(){return i},PublisherServiceClient:function(){return f}}),function(e){e.More="More",e.Mute="Mute",e.Read="Read"}(i||(i={}));var o=n(16715),s=n(57663),r=n(59878),a=n(88048),c=n(7766),d=n(32308),l=n(84882),u=n(82415),p=n(51480),m=n(665),h=n(77062),g=n(62907),y=n(17395);class f{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.fetchImpl=e,this.addPageInfoToOcid=t,this.followedPublishersEndpoint="v1/News/Users/Me/PreferredProviders",this.followedSourcesEndpoint="msn/sources",this.publishersServiceEndpoint="Msn/Providers",this.actionsServiceEndpoint="Graph/Actions",this.followActionSourceEndpoint="community/follows",this.ocid="feeds"}getOcid(){return this.ocid}async getUserMutedPublishers(){const e=await this.getUserActions(i.Mute);if(!e||!e.value)return null;if(!e.value.length)return[];const t=e.value.reduce(((e,t)=>(e[t.targetId]=t,e)),{}),n=await this.getPublisherDetails(Object.keys(t));if(!n||!n.value||!n.value.length)return null;return n.value.map((e=>{const n={createdDateTime:t[e.id].createdDateTime};return{...e,...n}}))}async getUserFollowedPublishers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;const t=await this.getRequestInit(),n=[...await this.getCommonParams(),{key:"$top",value:`${e}`}],i=(0,a.PH)(this.followedPublishersEndpoint);this.appendQs(n,i),(0,o.aH)()||(0,h.s6)(i);const s=await this.sendRequest(decodeURIComponent(i.href),t,"getFollowedPublishers");return null==s?void 0:s.value}async getUserFollowedSources(){var e,t,n,i;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;const r=await this.getRequestInit(),c=[...await this.getCommonParams(),{key:"$top",value:`${s}`},{key:"queryType",value:"MyFeed"}],d=(0,a.PH)(this.followedSourcesEndpoint);let l;this.appendQs(c,d),(0,o.aH)()||(0,h.s6)(d);try{l=await this.sendRequest(decodeURIComponent(d.href),r,"getFollowedSources")}catch(e){throw new Error(`{url: ${d.href}}`)}return(null===(e=l)||void 0===e||null===(t=e.value)||void 0===t?void 0:t.length)>0?null===(n=l)||void 0===n||null===(i=n.value[0])||void 0===i?void 0:i.subCards.map((e=>{var t;const n=e.intAttributes&&1==e.intAttributes.disableProfile;return{...e,profileId:n?null:e.profileId,displayName:e.name,logos:[{imageLink:{href:null===(t=e.image)||void 0===t?void 0:t.url}}]}})):[]}async publisherUserAction(e,t,n){if(!e||!t)return null;const i=await this.getRequestInit();i.method=n;let o=await this.getCommonParams();"POST"===n?i.body=JSON.stringify({actionType:t,targetId:e,targetType:"SourceProvider"}):"DELETE"===n&&(o=[...o,{key:"$filter",value:`actionType eq '${t}' and targetId eq '${e}'`}]);const s=(0,a.PH)(this.actionsServiceEndpoint);this.appendQs(o,s);const r=await this.sendRequest(decodeURIComponent(s.href),i,`deleteUserAction ${t}`,!0,!0);if(r.status>=400){const n=`OneService returned error response. Status: ${r.status} for actionType: ${t}, targetId: ${e}`;throw new Error(n)}return r}async updateSourceFollowState(e,t){if(!e)return null;const n=await this.getRequestInit();let i=await this.getCommonParams();i=[...i],t?(n.method="POST",n.body=JSON.stringify({targetId:e})):(n.method="DELETE",i=[...i,{key:"targetId",value:e}]);const o=(0,a.PH)(this.followActionSourceEndpoint);this.appendQs(i,o);const s=t?"follow":"unfollow";try{return await this.sendRequest(decodeURIComponent(o.href),n,`updateSourceFollowState ${s}`,!0,!0)}catch(t){throw new Error(`OneService returned error response. Community follow service  for targetId: ${e}, action: ${s}`)}}async updatePublisherReadTime(e,t,n){if(!e)return null;const o=await this.getRequestInit(),s=await this.getCommonParams(),r=i.Read;o.method="POST",o.body=JSON.stringify({actionType:r,targetType:n,targetId:e,updatedDateTime:t});const c=(0,a.PH)(this.actionsServiceEndpoint);this.appendQs(s,c);try{return await this.sendRequest(decodeURIComponent(c.href),o,`updateSourceReadTime ${r}`,!0,!0)}catch(t){throw new Error(`OneService returned error response for actionType: ${r}, targetId: ${e}`)}}async getUserPublishersReadTimes(){try{const e=await this.generatePublisherStatusRequest(void 0,i.Read);return null==e?void 0:e.value}catch(e){throw new Error("OneService returned error response for fetching followed sources read times.")}}async getUserPublisherStatus(e,t){var n;return!(null===(n=(await this.generatePublisherStatusRequest(e,t)).value)||void 0===n||!n.length)}async generatePublisherStatusRequest(e,t){const n=await this.getRequestInit();n.method="GET";const i=e?`and targetId eq '${e}'`:"";let s=await this.getCommonParams();s=[...s,{key:"$filter",value:`actionType eq '${t}' ${i} `}];const r=(0,a.PH)(this.actionsServiceEndpoint);return this.appendQs(s,r),(0,o.aH)()||(0,h.s6)(r),await this.sendRequest(decodeURIComponent(r.href),n,`getUserPublisherStatus ${t}`)}async getUserActions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const n=await this.getRequestInit(),i=[...await this.getCommonParams(),{key:"$filter",value:`actionType eq '${e}' and deleted eq false and targetType eq 'SourceProvider'`},{key:"$top",value:`${t}`}],s=(0,a.PH)(this.actionsServiceEndpoint);return this.appendQs(i,s),(0,o.aH)()||(0,h.s6)(s),await this.sendRequest(decodeURIComponent(s.href),n,`getUserActions ${e}`)}async getPublisherDetails(e){const t=await this.getRequestInit(),n=(0,a.PH)(this.publishersServiceEndpoint),i=[...c.$D.getOneServiceParamsWithoutAuth(null,this.ocid,this.addPageInfoToOcid),{key:"ids",value:e.join(",")}];return this.appendQs(i,n),await this.sendRequest(decodeURIComponent(n.href),t,"getPublisherDetails")}async getCommonParams(){var e;"winWidgets"===s.jG.AppType&&(this.ocid="sidebar"===(null===(e=r.Al.ClientSettings)||void 0===e?void 0:e.pagetype)?"shoreline":"winp2",this.addPageInfoToOcid=!1);if((0,o.aH)())return this.getSapphireQueryParams();this.forcedApiKey&&(this.addPageInfoToOcid=!1),(0,o._3)()&&(this.ocid="OnOSkypeChannels");const t=await this.isUserSignedIn()?c.$D.getOneServiceParamsWithAuth(s.jG.UserId||s.jG.ActivityId,this.ocid,this.addPageInfoToOcid):c.$D.getOneServiceParamsWithoutAuth(s.jG.UserId||s.jG.ActivityId,this.ocid,this.addPageInfoToOcid);if(this.forcedApiKey){t.find((e=>"apikey"==e.key)).value=this.forcedApiKey}return t}getSapphireQueryParams(){const e=c.$D.getOneServiceNonDynamicParamsWithoutAuth(this.ocid,this.addPageInfoToOcid),t=(0,l._4)();return t&&(e.push({key:s.jG.OneServiceContentMarketQspKey,value:t.market}),s.jG.ShouldUseFdheadQsp&&e.push({key:"fdhead",value:t.features}),e.push({key:"activityId",value:t.activityId}),t.latitude&&t.longitude&&e.push({key:"location",value:`${t.latitude}|${t.longitude}`})),e}async getRequestInit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null==e&&(e={method:"GET"}),e.credentials="include",e.headers=(0,u.wq)()?await(0,p.dG)():await c.$D.getOneServiceHeaders(),e}async isUserSignedIn(){const e=(0,r.nP)().UserIsSignedIn;if(void 0!==e)return e;return await(0,y.XJ)()===g.Hy.SignedIn}async sendRequest(e,t,n,i,s){return(0,o.aH)()?await this.sapphireRequest(decodeURIComponent(e),t):await this.networkRequest(decodeURIComponent(e),t,n,i,s)}async sapphireRequest(e,t){const n={url:e,headers:t.headers,body:t.body,refresh:!0};let i;switch(t.method){case"POST":i=await(0,m.Ef)(n);break;case"DELETE":i=await(0,m.o9)(n);break;default:i=await(0,m.FM)(n)}return JSON.parse(i||"{}")}async networkRequest(e,t,n,i,o){return(0,d.w)((async()=>{const n=await this.fetchImpl(e,t);if(!n.ok)throw Error(n.statusText);return i&&(0,h.T1)(),o?n:n.json()}),n)}appendQs(e,t){e.forEach((e=>{e.value&&t.searchParams.set(e.key,e.value)}))}setForcedApiKey(e){this.forcedApiKey=e}}},70971:function(e,t,n){n.d(t,{z:function(){return o}});var i=n(24709);const o={setTheme:new i.C("SetTheme"),updateMe:new i.C("UpdateMe"),updateUserCommunitySettings:new i.C("UpdateUserCommunitySettings"),updateNotifications:new i.C("UpdateNotifications"),updateActivities:new i.C("UpdateActivities"),updateStrikeActivities:new i.C("UpdateStrikeActivities"),updateCreatorFullPageContents:new i.C("UpdateCreatorFullPageContents"),updateProviderFullPageContents:new i.C("UpdateProviderFullPageContents"),deleteActivities:new i.C("DeleteActivities"),updateActivityStatus:new i.C("UpdateActivityStatus"),setContent:new i.C("SetContent"),updateContent:new i.C("UpdateContent"),updateContentRating:new i.C("UpdateContentRating"),insertComments:new i.C("FetchContentComments"),resetSpecificCommentId:new i.C("ResetSpecificCommentid"),updateCommentRating:new i.C("UpdateCommentRating"),reportComment:new i.C("ReportComment"),incrementReplyCount:new i.C("IncrementReplyCount"),insertComment:new i.C("InsertComment"),updateUser:new i.C("UpdateUser"),updateUserFollowers:new i.C("UpdateUserFollowers"),updateUserFollowing:new i.C("UpdateUserFollowing"),updateUserPostsDict:new i.C("UpdateUserPostsDict"),updateUserPostCountDict:new i.C("UpdateUserPostCountDict"),updateUserComments:new i.C("UpdateUserComments"),deleteUserComment:new i.C("DeleteUserComment"),setProviderFullPageContents:new i.C("SetProviderFullPageContents"),setReactionBreakdown:new i.C("SetReactionBreakdown"),setSocialEntrypointContentType:new i.C("SetSocialEntrypointContent"),setGradientOverlayData:new i.C("SetGradientOverlayData"),setPublisherSubscribeFollowButtonData:new i.C("SetPublisherSubscribeFollowButtonData"),setPopup:new i.C("SetPopup"),addTyper:new i.C("AddTyper"),updateTypers:new i.C("UpdateTypers"),updateViewCount:new i.C("UpdateViewCount"),recordSignalRHub:new i.C("RecordSignalRHub"),updateResponsiveClass:new i.C("UpdateResponsiveClass"),deleteMyData:new i.C("DeleteMyData"),updateActivityAppeal:new i.C("UpdateActivityAppeal"),mapCmsIdToContentId:new i.C("MapCmsIdToContentId"),resetError:new i.C("ResetError"),setMarketSettings:new i.C("SetMarketSettings"),updatePostItemsDict:new i.C("UpdatePostItemsDict"),updatePollContextDict:new i.C("UpdatePollContextDict"),updatePollInsight:new i.C("UpdatePollInsight"),setCivicSciencePollLoaded:new i.C("SetCivicSciencePollLoaded")}},19303:function(e,t,n){n.r(t),n.d(t,{BridgeEventNames:function(){return f},SocialDataActions:function(){return i.z},SocialDataConnector:function(){return $},SocialDataReducer:function(){return L},ToolingInfo:function(){return Ae},listenBridgeEvent:function(){return g},removeBridgeEventListener:function(){return y}});var i=n(70971),o=n(62907),s=n(42122),r=n(5302),a=n(55465),c=n(5539),d=n(76090),l=n(76753),u=n(79236),p=n(4418);const m={};function h(e){const t={eventName:e,data:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}};try{document.dispatchEvent(new CustomEvent(e,{detail:t})),window.top.postMessage(t,"*")}catch(e){s.k.logError(e)}}function g(e,t){window.addEventListener("message",m[e]=n=>{n.data.eventName==e&&t(n.data)})}function y(e){m[e]&&window.removeEventListener("message",m[e])}const f={signInClicked:"sign-in-clicked",saveCachedMyReaction:"save-cached-my-reaction",openPopup:"open-popup",closePopup:"close-popup"};var v=n(61149),C=n(20938),S=n(45067),P=n(3520),w=n(18906),b=n(40053);function A(e,t,n){const i=document,o="script";if(!i.getElementById(t)){const s=i.getElementsByTagName(o)[0],r=i.createElement(o);r.id=t,r.src=e,r.onload=n,s.parentNode.insertBefore(r,s)}}class k{static async open(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(k.signalRHub!==e){if(window.signalR){k.signalRHub=e;const n=await v.VK.getSignalRConnectionInfo(e);n.accessToken=n.accessToken||n.accessKey,n.url=n.url||n.endpoint;const i={accessTokenFactory:()=>n.accessToken},o=(new window.signalR.HubConnectionBuilder).withUrl(n.url,i).configureLogging(window.signalR.LogLevel.Information).build();return o.on("newMessage",t),k.signalRConnection&&k.signalRConnection.stop(),k.signalRConnection=o,k.signalRConnection.start().catch(),this.get()}n||A("https://assets.msn.com/labs/views/CommentWidget/js/signalr.min.js","signalR-jssdk",k.open.bind(this,e,t,!0))}}static close(){k.signalRConnection&&(k.signalRConnection.stop(),k.signalRConnection=void 0,k.signalRHub=void 0)}static get(){return{connection:k.signalRConnection,hub:k.signalRHub}}}var T=n(58302),U=n(48593),R=n(28123),I=n(16715),M=n(57663),E=n(17395),D=n(59637),G=n(30666),_=n(55584),N=n(44132);const B=new class{constructor(){this.onAppError=void 0}log(e){if(this.onAppError)try{this.onAppError(e)}catch(e){s.k.logError(e)}}setOnAppError(e){this.onAppError=e}};function F(e,t){return e&&e.find((e=>e.id===t||e.replies&&e.replies.find((e=>e.id===t))))}let O=!1;class $ extends G.e{constructor(e,t,n,i,o,s,r){super(e,t,n,i,o,s,r),this.logAuthError=(e,t,n)=>{N.M0.sendAppErrorEvent({...e,message:t,pb:{...e.pb,customMessage:n}})}}getSocialBarConnectorFunctionsWithStateBindings(){const e=this.getCurrentState();return{checkAndLogReducerError:this.checkAndLogReducerError.bind(this),styleConnector:{updateResponsiveClass:this.updateResponsiveClass.bind(this)},socialBarConnector:{onSocialBarComponentConnected:this.onSocialBarComponentConnected.bind(this,e.me,e.userCommunitySettings),sendContentReaction:this.sendContentReaction.bind(this),isUserCommunitySettingsFetched:this.isUserCommunitySettingsFetched.bind(this,e.userCommunitySettings)},popupConnector:{openPopup:this.openPopup.bind(this,e.theme),closePopup:this.closePopup.bind(this,e.popup)}}}getSocialEntrypointConnectorFunctionsWithStateBindings(){const e=this.getCurrentState();return{checkAndLogReducerError:this.checkAndLogReducerError.bind(this),styleConnector:{updateResponsiveClass:this.updateResponsiveClass.bind(this)},postConnector:{getPostByPostId:this.getPostByPostId.bind(this),getAndUpdatePosts:this.getAndUpdatePosts.bind(this),updatePollContextDict:this.updatePollContextDict.bind(this)},commentConnector:{getAndUpdateContent:this.getAndUpdateContent.bind(this),onEntrypointComponentConnect:this.onEntrypointComponentConnect.bind(this,e.me,e.marketSettings),reportComment:this.reportComment.bind(this)}}}getSocialCommentConnectorFunctionsWithStateBindings(){const e=this.getCurrentState();return{checkAndLogReducerError:this.checkAndLogReducerError.bind(this),styleConnector:{updateResponsiveClass:this.updateResponsiveClass.bind(this)},postConnector:{getPostByPostId:this.getPostByPostId.bind(this),getAndUpdatePosts:this.getAndUpdatePosts.bind(this),updatePollContextDict:this.updatePollContextDict.bind(this)},commentConnector:{fetchInitialDataToRenderCommentCTAButton:this.fetchInitialDataToRenderCommentCTAButton.bind(this),onCommentComponentConnect:this.onCommentComponentConnect.bind(this,e.me,e.marketSettings),getAndUpdateContent:this.getAndUpdateContent.bind(this),submitComment:this.submitComment.bind(this,e.me,e.theme),deleteComment:this.deleteComment.bind(this,e.me,e.theme),appealComment:this.appealComment.bind(this),reportComment:this.reportComment.bind(this),sendCommentReaction:this.sendCommentReaction.bind(this),showMoreComments:this.showMoreComments.bind(this),showMoreReplies:this.showMoreReplies.bind(this),loadMoreComments:this.loadMoreComments.bind(this),loadPreviousComments:this.loadPreviousComments.bind(this),onSortTypeChanged:this.onSortTypeChanged.bind(this),updateTypers:this.updateTypers.bind(this),broadcastAsTyping:this.broadcastAsTyping.bind(this,e.me),broadcastAsViewing:this.broadcastAsViewing.bind(this),listenForTypers:this.listenForTypers.bind(this),isUserCommunitySettingsFetched:this.isUserCommunitySettingsFetched.bind(this,e.userCommunitySettings),updatePollInsight:this.updatePollInsight.bind(this)},usersConnector:{fetchUser:this.fetchUser.bind(this,e.users),followUser:this.followUser.bind(this,e.users,e.me,e.theme),createUser:this.createUser.bind(this,e.me),fetchMe:this.fetchMe.bind(this),appealMe:this.appealMe.bind(this),appealMyPicture:this.appealMyPicture.bind(this),fetchActivities:this.fetchActivities.bind(this,e.activities),markActivityAsRead:this.markActivityAsRead.bind(this),updateUsername:this.updateUsername.bind(this,e.me)},popupConnector:{openPopup:this.openPopup.bind(this,e.theme),closePopup:this.closePopup.bind(this,e.popup)}}}getSocialProfileConnectorFunctionsWithStateBindings(){const e=this.getCurrentState();return{checkAndLogReducerError:this.checkAndLogReducerError.bind(this),styleConnector:{updateResponsiveClass:this.updateResponsiveClass.bind(this)},profileConnector:{onProfilePageComponentConnected:this.onProfilePageComponentConnected.bind(this,e.users,e.me,e.providerFullPageContents,e.marketSettings),onActivityPageComponentConnected:this.onActivityPageComponentConnected.bind(this,e.me,e.marketSettings),onCreatorHubPageConnected:this.onCreatorHubPageConnected.bind(this),fetchUserPosts:this.fetchUserPosts.bind(this,e.users),fetchUserFollowers:this.fetchUserFollowers.bind(this,e.users),fetchUserFollowings:this.fetchUserFollowings.bind(this,e.users),fetchUserComments:this.fetchUserComments.bind(this,e.users),fetchProviderFullPage:this.fetchProviderFullPage.bind(this),fetchProviderFullPageNextPage:this.fetchProviderFullPageNextPage.bind(this),fetchCreatorFullPageNextPage:this.fetchCreatorFullPageNextPage.bind(this),setProfilePrivate:this.setProfilePrivate.bind(this),setProfileNameMasking:this.setProfileNameMasking.bind(this),deleteMyData:this.deleteMyData.bind(this,e.me,e.users),initializePublisherServiceClient:this.initializePublisherServiceClient.bind(this),followPublisher:this.followPublisher.bind(this),getPublisherIsFollowing:this.getPublisherIsFollowing.bind(this)},commentConnector:{appealComment:this.appealComment.bind(this),appealActivity:this.appealActivity.bind(this),deleteComment:this.deleteComment.bind(this,e.me,e.theme)},usersConnector:{fetchUser:this.fetchUser.bind(this,e.users),followUser:this.followUser.bind(this,e.users,e.me,e.theme),createUser:this.createUser.bind(this,e.me),fetchMe:this.fetchMe.bind(this),appealMe:this.appealMe.bind(this),appealMyPicture:this.appealMyPicture.bind(this),fetchActivities:this.fetchActivities.bind(this,e.activities),fetchStrikeActivities:this.fetchStrikeActivities.bind(this,e.strikeActivities),markActivityAsRead:this.markActivityAsRead.bind(this),updateUsername:this.updateUsername.bind(this,e.me)},popupConnector:{openPopup:this.openPopup.bind(this,e.theme),closePopup:this.closePopup.bind(this,e.popup)}}}getProfileArticlesConnectorFunctionsWithStateBindings(){const e=this.getCurrentState();return{checkAndLogReducerError:this.checkAndLogReducerError.bind(this),profileConnector:{fetchUserPosts:this.fetchUserPosts.bind(this,e.users),unpublishUserPost:this.unpublishUserPost.bind(this,e.users),publishUserPost:this.publishUserPost.bind(this,e.users),fetchProviderFullPage:this.fetchProviderFullPage.bind(this),fetchProviderFullPageNextPage:this.fetchProviderFullPageNextPage.bind(this)},commentConnector:{getAndUpdateContent:this.getAndUpdateContent.bind(this)}}}getSocialConnectorFunctionsWithStateBindings(){const e=this.getCurrentState();return{checkAndLogReducerError:this.checkAndLogReducerError.bind(this),styleConnector:{updateResponsiveClass:this.updateResponsiveClass.bind(this)},profileConnector:{deleteMyData:this.deleteMyData.bind(this,e.me,e.users)},usersConnector:{fetchUser:this.fetchUser.bind(this,e.users),followUser:this.followUser.bind(this,e.users,e.me,e.theme),createUser:this.createUser.bind(this,e.me),fetchMe:this.fetchMe.bind(this),appealMe:this.appealMe.bind(this),appealMyPicture:this.appealMyPicture.bind(this),fetchActivities:this.fetchActivities.bind(this,e.activities),markActivityAsRead:this.markActivityAsRead.bind(this)},reactionBreakdownConnector:{onReactionBreakdownComponentConnected:this.onReactionBreakdownComponentConnected.bind(this,e.me),onReactionBreakdownComponentDisconnected:this.onReactionBreakdownComponentDisconnected.bind(this)},popupConnector:{openPopup:this.openPopup.bind(this,e.theme),closePopup:this.closePopup.bind(this,e.popup)},publisherSubscribeFollowButtonConnector:{initializePublisherServiceClient:this.initializePublisherServiceClient.bind(this),followPublisher:this.followPublisher.bind(this),getPublisherIsFollowing:this.getPublisherIsFollowing.bind(this)}}}getBeaconConnectorFunctionsWithStateBindings(){const e=this.getCurrentState();return{popupConnector:{openPopup:this.openPopup.bind(this,e.theme),closePopup:this.closePopup.bind(this,e.popup)}}}async setTheme(e){i.z.setTheme.getActionSender(this).send(e)}async setGradientOverlayData(e){i.z.setGradientOverlayData.getActionSender(this).send(e)}async setPublisherSubscribeFollowButtonData(e){i.z.setPublisherSubscribeFollowButtonData.getActionSender(this).send(e)}async fetchInitialDataToRenderCommentCTAButton(e){e&&e.id&&(this.getAndUpdateContent(e),O||this.fetchUserCommunitySettings())}onCommunityComponentConnect(e,t){e||this.fetchMe(),t||this.fetchMarketSettings(),O||this.fetchUserCommunitySettings()}async onCommentComponentConnect(e,t,n,o,s){var r,a,c,d;this.onCommunityComponentConnect(e,t);const l=await this.getAndUpdateContent(n);return!l.notCreated&&"on"===l.commentStatus&&l.commentSummary&&l.commentSummary.totalCount>0&&(void 0===(null===(r=l.comments)||void 0===r||null===(a=r.list)||void 0===a?void 0:a.length)||0===(null===(c=l.comments)||void 0===c||null===(d=c.list)||void 0===d?void 0:d.length))&&(o?this.loadSpecificComment(l.id,o).catch((()=>i.z.resetSpecificCommentId.getActionSender(this).send())):this.loadAllComments(l.id,n)),l}async onEntrypointComponentConnect(e,t,n){const i=await this.getAndUpdateContent(n);var o,s,r,a;"on"==(null==i?void 0:i.pollStatus)&&(this.onCommunityComponentConnect(e,t),!i.notCreated&&"on"===i.commentStatus&&i.commentSummary&&i.commentSummary.totalCount>0&&(void 0===(null===(o=i.comments)||void 0===o||null===(s=o.list)||void 0===s?void 0:s.length)||0===(null===(r=i.comments)||void 0===r||null===(a=r.list)||void 0===a?void 0:a.length))&&(i.comments=await v.VK.getCommentsByContentId(i.id,{top:n.top||2,skip:n.skip||0,sortType:n.sortType})));return i}async loadSpecificComment(e,t){const n=await v.VK.getCommentById(t);if(!n||n.contentId!==e)throw new Error("The specific comment doesn't belong to this content");if(n.parentId){const t=await v.VK.getCommentsByAnchorCommentId(n.id,{top:2,orderBy:"time desc"}),o=await v.VK.getCommentsByAnchorCommentId(n.id,{top:2,orderBy:"time asc"}),s={...{...t,hasPrevious:t.hasMore},list:t.list.reverse().concat(o.list.slice(1)),hasMore:o.hasMore},r=await v.VK.getCommentsByAnchorCommentId(n.parentId,{top:1,orderBy:"rating"});i.z.insertComments.getActionSender(this).send(e,r,!1),i.z.insertComments.getActionSender(this).send(e,s,!1,n.parentId),this.updateCommentRatings(e,r.list.concat(s.list))}else{const t=await v.VK.getCommentsByAnchorCommentId(n.id,{top:2,orderBy:"rating asc"}),o=await v.VK.getCommentsByAnchorCommentId(n.id,{top:2,orderBy:"rating desc"}),s={...{...t,hasPrevious:t.hasMore},list:t.list.reverse().concat(o.list.slice(1)),hasMore:o.hasMore};i.z.insertComments.getActionSender(this).send(e,s,!1),this.updateCommentRatings(e,s.list)}}async loadAllComments(e,t){const n=t.top||2,o=t.skip||0,s=t.sortType;v.VK.getCommentsByContentId(e,{top:n,skip:o,sortType:s}).then((t=>{i.z.insertComments.getActionSender(this).send(e,t,!1),this.updateCommentRatings(e,t.list)}))}showMoreComments(e,t,n,o){return v.VK.getCommentsByContentId(e,{top:t,skip:n,sortType:o}).then((t=>{i.z.insertComments.getActionSender(this).send(e,t,!0),this.updateCommentRatings(e,t.list)}))}onSortTypeChanged(e,t,n){const o={top:t,skip:0,sortType:n};v.VK.getCommentsByContentId(e,o).then((t=>{i.z.insertComments.getActionSender(this).send(e,t,!1),this.updateCommentRatings(e,t.list)})),i.z.resetSpecificCommentId.getActionSender(this).send()}loadCommentsUsingAnchorComment(e,t,n,o){const s=o?"time":"rating",r="time"===s?!n:n,a="time"===s&&!r||"rating"===s&&r;v.VK.getCommentsByAnchorCommentId(t,{top:5,orderBy:`${s} ${r?"asc":"desc"}`}).then((t=>{let n=t.list.slice(1);a?(n=n.reverse(),t.hasPrevious=t.hasMore,t.hasMore=void 0):t.hasPrevious=void 0,t.list=n,i.z.insertComments.getActionSender(this).send(e,t,!0,o,a),this.updateCommentRatings(e,t.list)}))}loadMoreComments(e,t,n){this.loadCommentsUsingAnchorComment(e,t,!1,n)}loadPreviousComments(e,t,n){this.loadCommentsUsingAnchorComment(e,t,!0,n)}showMoreReplies(e,t,n,o,s){const r={top:n,skip:o,orderBy:s};v.VK.getCommentsByParentId(t,r).then((n=>{i.z.insertComments.getActionSender(this).send(e,n,!0,t),this.updateCommentRatings(e,n.list)}))}updateCommentRatings(e,t){t.forEach((t=>{var n;i.z.updateCommentRating.getActionSender(this).send(e,t.id,null===(n=t.myReaction)||void 0===n?void 0:n.toLowerCase(),!1)}))}reportComment(e){i.z.reportComment.getActionSender(this).send(e)}handleUserLoginFromState(e,t){return!!e&&(e.state==a.k.userStateType.anonymous?(this.openPopup(t,"multiLoginPage"),!1):e.state!=a.k.userStateType.newUser||(this.openPopup(t,"onboardingPage"),!1))}async submitComment(e,t,n,o,r,a,c,d){if(!(o.trim().length<1)&&this.handleUserLoginFromState(e,t)){(null==n?void 0:n.totalCommentCount)>0&&(d=void 0);try{let t;return await v.VK.postComment(n.id,e.id,o,r,a,c,d).then((t=>Object.assign(t,{user:e}))).then((e=>{t=e,i.z.insertComment.getActionSender(this).send(n.id,e,r,!0);const o=e.contentId;v.VK.broadcastCommentNotification(o,e.id,r)})).catch((e=>{try{e&&(t={errorCode:e.code,errorSubCodes:e.subCodes})}catch(e){t={errorCode:0}}})),t}catch(e){s.k.logError(`Error: comment post failed => ${JSON.stringify(e)}`)}}}deleteComment(e,t,n,o,s){this.handleUserLoginFromState(e,t)&&v.VK.deleteComment(n).then((e=>{i.z.deleteUserComment.getActionSender(this).send(s,n,o)}))}sendCommentReaction(e,t,n){n?v.VK.sendResetReaction({item:v._Q.comments,id:e.id,reactionType:null}).then((t=>{i.z.updateCommentRating.getActionSender(this).send(e.contentId,e.id,void 0,!0)})):v.VK.sendReaction({item:v._Q.comments,id:e.id,reactionType:t}).then((t=>{i.z.updateCommentRating.getActionSender(this).send(e.contentId,e.id,t,!0)}))}async sendContentReaction(e,t,n){n?v.VK.sendResetReaction({item:v._Q.contents,id:e.id,reactionType:null,localStorageSave:window.ReactNativeWebView&&this.saveReactionInSuperAppLocalStorage}).then((t=>{i.z.updateContentRating.getActionSender(this).send(e.id,void 0)})):v.VK.sendReaction({item:v._Q.contents,id:e.id,reactionType:t,localStorageSave:window.ReactNativeWebView&&this.saveReactionInSuperAppLocalStorage}).then((t=>{i.z.updateContentRating.getActionSender(this).send(e.id,t)}))}async getContent(e){const{id:t,url:n,market:o}=e;let s=this.getLocalContent(t,o);if(s)return s;const r=await v.VK.getContentById({cmsId:t,market:o,url:n});return s=this.getLocalContent(t,o),s||(i.z.setContent.getActionSender(this).send(r,r.id||(0,c.N)({},t,o)),i.z.mapCmsIdToContentId.getActionSender(this).send(t,o,r.id||(0,c.N)({},t,o)),r)}getLocalContent(e,t){const n=this.getCurrentState();return n&&n.contents&&n.contents[(0,c.N)(n.contentIds,e,t)]}async getAndUpdateContent(e){const t=await this.getContent(e);if(!t.notCreated){var n;const e=null===(n=t.myReaction)||void 0===n?void 0:n.toLowerCase();i.z.updateContent.getActionSender(this).send(t.id,{rating:e})}return t}fetchUser(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=e&&e[t];return!n&&o&&(o.isFetched||o.isFetching)?Promise.resolve():(i.z.updateUser.getActionSender(this).send(t,{isFetching:!0}),v.VK.getUserById(t).then((e=>{i.z.updateUser.getActionSender(this).send(t,{data:e,isFetched:!0,isFetching:!1})})).catch((e=>i.z.updateUser.getActionSender(this).send(t,{isFetching:!1}))))}async followUser(e,t,n,o,s){var r,a,c;let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=!o.startsWith("cid-")||["publisher","creator"].includes(null===(r=e[o])||void 0===r||null===(a=r.data)||void 0===a||null===(c=a.subType)||void 0===c?void 0:c.toLowerCase());(l||this.handleUserLoginFromState(t,n))&&(s?v.VK.followUser(o,l).then((n=>{const s={data:{isFollowing:!0,followers:e[o].data.followers&&{...e[o].data.followers,list:e[o].data.followers.list.concat(e[t.id].data)},followersCount:e[o].data.followersCount+1}},r={data:{following:e[t.id].data.following&&{...e[t.id].data.following,list:d?e[t.id].data.following.list:e[t.id].data.following.list.concat(e[o].data)},followingCount:e[t.id].data.followingCount+1}};i.z.updateUser.getActionSender(this).send(o,s),i.z.updateUser.getActionSender(this).send(t.id,r)})):v.VK.unfollowUser(o).then((n=>{const s={data:{isFollowing:!1,followers:e[o].data.followers&&{...e[o].data.followers,list:e[o].data.followers.list.filter((n=>n.id!=e[t.id].data.id))},followersCount:e[o].data.followersCount-1}},r={data:{following:e[t.id].data.following&&{...e[t.id].data.following,list:d?e[t.id].data.following.list:e[t.id].data.following.list.filter((t=>t.id!=e[o].data.id))},followingCount:e[t.id].data.followingCount-1}};i.z.updateUser.getActionSender(this).send(o,s),i.z.updateUser.getActionSender(this).send(t.id,r)})))}async createUser(e){let t=await v.VK.createUser();t={...e,...t},i.z.updateMe.getActionSender(this).send(t)}async updateUsername(e,t){const n=await v.VK.updateUsername(t);return"Approved"===n&&i.z.updateMe.getActionSender(this).send({...e,name:t}),n}async onSocialBarComponentConnected(e,t,n){e||(e=await this.fetchMe()),O||this.fetchUserCommunitySettings();const o=await this.getContent(n);if(!o.notCreated){const t=(0,C.X)("cachedMyReaction");t&&(o.rating=t,i.z.updateContent.getActionSender(this).send(o.id,{rating:t})),v.VK.getFriendRatings(v._Q.contents,o.id).then((n=>{this.processRatings(o.id,e,n,t)}))}return o}processRatings(e,t,n,o){if(!n||!n.items)return;const s={};if(n.items.map((e=>{const t=e.links.find((e=>"User"==e.type));t&&t.item&&(i.z.updateUser.getActionSender(this).send(t.item.id,{data:S.k.convertUser(t.item),isFetched:!0,isFetching:!1}),s[t.item.id]=e.subType.toLowerCase())})),!o&&t&&t.id in s&&(i.z.updateContent.getActionSender(this).send(e,{rating:s[t.id]}),delete s[t.id]),!o&&t&&t.id){const o=n.items.find((e=>e.sourceId==t.id));o&&o.subType&&i.z.updateContent.getActionSender(this).send(e,{rating:o.subType.toLowerCase()})}i.z.updateContent.getActionSender(this).send(e,{friendRatings:s})}async fetchUserPosts(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.$.None,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,r=0;const a=e&&e[t],{data:c}=a||{},{postsDict:d}=c||{},l=null==d?void 0:d[w.$[o]];return!n&&(0,T.q)(l)&&(r=l.length),v.VK.getPostListByUserId(t,s,r,o).then((e=>{const{searchMatchedTotal:s=0,documents:r=[]}=e||{};return i.z.updateUserPostCountDict.getActionSender(this).send(t,w.$[o],s),i.z.updateUserPostsDict.getActionSender(this).send(t,w.$[o],r,n),e.documents}))}async unpublishUserPost(e,t,n,o){const s=e&&e[t],{data:r}=s||{},{postsDict:a}=r||{},c=(null==a?void 0:a[o])||[],d=c.findIndex((e=>e.id===n));return-1!==d&&c.splice(d,1,{...c[d],isUnpublishing:!0}),i.z.updateUserPostsDict.getActionSender(this).send(t,o,c,!0),v.VK.unpublishPost(n,c[d].type)}async publishUserPost(e,t,n,o){const s=e&&e[t],{data:r}=s||{},{postsDict:a}=r||{},c=(null==a?void 0:a[o])||[],d=c.findIndex((e=>e.id===n));return-1!==d&&c.splice(d,1,{...c[d],isProcessing:!0}),i.z.updateUserPostsDict.getActionSender(this).send(t,o,c,!0),v.VK.publishPost(n,c[d].type)}async fetchUserFollowers(e,t){const n=e&&e[t]&&e[t].data&&e[t].data.followers;if(!n||!1!==n.hasMore)return v.VK.getFollowersByUserId(t,10,n&&n.list?n.list.length:0).then((e=>i.z.updateUserFollowers.getActionSender(this).send(t,e)))}async fetchUserFollowings(e,t){const n=e&&e[t]&&e[t].data&&e[t].data.following;if(!n||!1!==n.hasMore)return v.VK.getFollowingsByUserId(t,10,n&&n.list?n.list.length:0).then((e=>i.z.updateUserFollowing.getActionSender(this).send(t,e)))}fetchUserComments(e,t,n,o){let s=0;return!n&&e&&e[t]&&e[t].data&&e[t].data.comments&&e[t].data.comments.list&&(s=e[t].data.comments.list.length),v.VK.getCommentsByUserId(t,10,s,o).then((e=>i.z.updateUserComments.getActionSender(this).send(t,e,n)))}async fetchActivities(e){if(!e||!1!==e.hasMore)return v.VK.getUserActivities(20,e&&e.list?e.list.length:0).then((e=>i.z.updateActivities.getActionSender(this).send(e)))}async fetchStrikeActivities(e){if(!e)return v.VK.getUserStrikeActivities().then((e=>i.z.updateStrikeActivities.getActionSender(this).send(e)))}async markActivityAsRead(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v.VK.updateUserActivityStatus(e,!0).then((n=>{t&&i.z.updateActivityStatus.getActionSender(this).send(e,!0)}))}async fetchMe(){var e,t=this;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const c=this.getCurrentState();if(c.me)return c.me;const p=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v.VK.useCache=!1;const c=await v.VK.fetchMe(n);if(v.VK.useCache=!0,i.z.updateMe.getActionSender(t).send({...c,loginFromPopup:e}),e&&(0,d.PI)(c),s&&c.state===a.k.userStateType.anonymous){const e=(0,E.xQ)(),n=(0,U.XS)();e===o.Qm.AAD?t.logAuthError(r.Ef6,"Client detected AAD user but server returned anonymous user",`canUseEdgeIdentity: ${(0,R.TJ)()}, edgeIdentity: ${JSON.stringify(n)}`):e===o.Qm.MSA?t.logAuthError(r.lg8,"Client detected MSA user but server returned anonymous user",`canUseEdgeIdentity: ${(0,R.TJ)()}, edgeIdentity: ${JSON.stringify(n)}`):t.logAuthError(r.yE1,"Client detected unknown signed in user but server returned anonymous user",`canUseEdgeIdentity: ${(0,R.TJ)()}, edgeIdentity: ${JSON.stringify(n)}`)}return N.M0.addOrUpdateTmplProperty("CommunityUserMeFetchCalled"),c};if(null!==(e=this.config)&&void 0!==e&&e.notUseAuthLib)return(0,l.z)()&&u.b.bindBingEvent(u.T.update1sToken,(()=>{(0,D.Vo)(),p(!1)}),!0),p(!1);if(!(0,I._3)()&&!(0,I.wq)()&&!(0,I.Rz)()){const e=await(0,E.rr)();if(e===o.Hy.SignedIn)return p(!1,!0);_.s.signedInStatus.registerObserver((t=>{var n;if((null==t||null===(n=t.params)||void 0===n?void 0:n.length)>0){const n=null==t?void 0:t.params[0];n!==e&&n===o.Hy.SignedIn&&p(!1,!0)}}))}return p(s)}async fetchUserCommunitySettings(){O=!0;const e=await v.VK.fetchUserCommunitySettings();i.z.updateUserCommunitySettings.getActionSender(this).send(e)}isUserCommunitySettingsFetched(e){return void 0!==e}async fetchMarketSettings(){const e=await v.VK.getMarketSettings();return i.z.setMarketSettings.getActionSender(this).send(e),e}async fetchProviderFullPage(e,t){const n=await v.VK.getProviderFullPageData(e,t);i.z.setProviderFullPageContents.getActionSender(this).send(n)}async onReactionBreakdownComponentConnected(e,t){e||this.fetchMe();const n=await this.getContent({id:t.cmsId,market:t.market});let o;t.commentId||n&&n.id?o=await v.VK.getRatingBreakdown(t.commentId?v._Q.comments:v._Q.contents,t.commentId||n.id,n):console.warn("Could not get reaction breakdown info. Missing input parameter; please provide commentId, contentId, pageUrl or canonicalUrl");const s={};Object.keys(o.items).forEach((e=>{s[e]=o.items[e].map((e=>{const t=e.user,n=t.id;i.z.updateUser.getActionSender(this).send(n,{data:S.k.convertUser(t),isFetched:!0,isFetching:!1});const o={...e,userId:n};return delete o.user,o}))})),o.items=s,i.z.setReactionBreakdown.getActionSender(this).send({reactions:o})}async onReactionBreakdownComponentDisconnected(){i.z.setReactionBreakdown.getActionSender(this).send({reactions:{reactionCounts:{all:0,like:0,love:0,angry:0,surprised:0,thinking:0,sad:0},items:{all:[],like:[],love:[],angry:[],surprised:[],thinking:[],sad:[]}}})}async onProfilePageComponentConnected(e,t,n,o,s,r){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"newest";t||(t=await this.fetchMe()),o||this.fetchMarketSettings();const c="me"==s?t.id:s;v.VK.getUserProfile(c).then((e=>{if(i.z.updateUser.getActionSender(this).send(c,{data:e,isFetched:!0,isFetching:!1}),(0,l.z)()&&e){let t={name:void 0,avatarUrl:void 0,postsCount:void 0,reactionsCount:void 0};t={...t,...e},u.b.dispatchBingEvent(u.T.updateUser,t)}})),r&&"channelpage"==r.toLowerCase()&&!n&&this.fetchProviderFullPage(s,a)}async onActivityPageComponentConnected(e,t){e||(e=await this.fetchMe()),t||this.fetchMarketSettings();const n=e.id;v.VK.getUserProfile(n).then((e=>{i.z.updateUser.getActionSender(this).send(n,{data:e,isFetched:!0,isFetching:!1})}))}async onCreatorHubPageConnected(){i.z.updateCreatorFullPageContents.getActionSender(this).send(null),v.VK.getCreatorHubFullPageData().then((e=>{i.z.updateCreatorFullPageContents.getActionSender(this).send(e)}))}setProfilePrivate(e,t,n){v.VK.updateUserSettings(e,t,n).then((o=>{const s={isPrivateProfile:t,intAttributes:{enableDisplayNameMasking:n?1:0}};i.z.updateUser.getActionSender(this).send(e,{data:s})}))}setProfileNameMasking(e,t,n){v.VK.updateUserSettings(e,t,n).then((t=>v.VK.getUserById(e))).catch((o=>{const s={isPrivateProfile:t,intAttributes:{enableDisplayNameMasking:n?1:0}};i.z.updateUser.getActionSender(this).send(e,{data:s})})).then((t=>{i.z.updateUser.getActionSender(this).send(e,{data:t})}))}openPopup(e,t,n){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];!function(e,t){let n=[];for(const t in a.k.theme)if(a.k.theme[t].name===e){n=a.k.theme[t].disabledComponents;break}return n.includes(t)}(e,t.toLowerCase())?("multiloginpage"==t.toLowerCase()&&(n={...n,useVisibilityMarkToBecomeVisible:!0}),i.z.setPopup.getActionSender(this).send(t,n,o)):"multiloginpage"===t.toLowerCase()?h(f.signInClicked):h(f.openPopup,{component:t.toLowerCase(),id:n&&n.id,fullScreen:n&&n.fullScreen||!1})}closePopup(e,t){const n=this.getCurrentState();n.previousPopup?i.z.setPopup.getActionSender(this).send(n.previousPopup.moduleName,n.previousPopup.popupProps,!1):e&&e.moduleName?i.z.setPopup.getActionSender(this).send(void 0,void 0,!1):t&&t.disableBridge||h(f.closePopup,{refreshPage:(null==t?void 0:t.refreshPage)||!1})}async listenForTypers(e,t,n){const o=n&&n.id||e&&t&&e+"_"+t;!o||n&&n.typingUpdates&&n.typingUpdates.hubName&&n.typingUpdates.hubName===o||(i.z.recordSignalRHub.getActionSender(this).send(o),k.open(o,this.handleSignalRMessage.bind(this,o,e,t)))}async handleSignalRMessage(e,t,n,o){if("view-notification"===o.type)i.z.updateViewCount.getActionSender(this).send(e,o.data.viewing);else if("typing-notification"===o.type){const s=o.data;s.lastTypingTime=Date.now(),i.z.addTyper.getActionSender(this).send(s,e,t,n)}else if("comment-notification"===o.type){const s=this.getCurrentState(),r=s&&s.contents&&s.contents[e],{commentId:a}=o.data,c=r.comments&&r.comments.list;if(F(c,a))return;const d=await v.VK.getCommentById(a);if(!d)return;const{createdBy:l,contentId:u}=d;if(u!==e)return;const p=d.parentId,m=F(c,p);if(p&&!m)return void i.z.incrementReplyCount.getActionSender(this).send(e);if(m&&m.replies.length<m.replyCount)return void i.z.incrementReplyCount.getActionSender(this).send(p);if(!r||!r.id)return void await this.onCommentComponentConnect(s.me,s.marketSettings,{id:t,market:n});if(!d.user){await this.fetchUser(s.users,l);const e=this.getCurrentState().users[l];d.user=e.data}i.z.insertComment.getActionSender(this).send(u,d,p)}}isUpdateTypersChanged(e){const t=this.getCurrentState(),n=t.contents;for(const i in t.contents){const t=n[i]&&n[i].typingUpdates||{typingUsers:{}};if(Object.keys(t.typingUsers).filter((n=>t.typingUsers[n].lastTypingTime<e)).length>0)return!0}return!1}async updateTypers(){const e=Date.now()-5e3;this.isUpdateTypersChanged(e)&&i.z.updateTypers.getActionSender(this).send(e)}async updatePollInsight(e){i.z.updatePollInsight.getActionSender(this).send(e)}broadcastAsTyping(e,t,n,i){const o=i&&i.id||t&&n&&t+"_"+n;o&&e&&v.VK.broadcastTypingNotification(o,e.id,e.name,e.avatarUrl)}broadcastAsViewing(e,t){v.VK.broadcastViewNotification(e,t)}updateResponsiveClass(e){i.z.updateResponsiveClass.getActionSender(this).send(e)}deleteMyData(e,t,n){v.VK.deleteMyData(n);let o={...t[e.id].data};n.comment&&(o={...o,postsCount:0,commentSummary:{totalCount:0,subCommentSummaries:[]},comments:{list:[],asc:!1,commentStatus:"On",hasMore:!1,hasPrevious:!0,moreCount:0,skip:0,top:10,totalCount:0}}),n.reaction&&(o={...o,likesCount:0,reactionsCount:0,reactionSummary:{totalCount:0,subReactionSummaries:[]}}),n.follow&&(o.followers.list.forEach((e=>{const t=e.id;i.z.updateUser.getActionSender(this).send(t,{data:{isFollowing:!1}})})),o={...o,followingCount:0,following:{list:[]},followSummary:{totalCount:0,subFollowSummaries:[]}}),n.activity&&i.z.deleteActivities.getActionSender(this).send(),i.z.updateUser.getActionSender(this).send(e.id,{data:o})}appealComment(e,t){v.VK.appealComment(e).then((e=>{this.appealActivity(t)}))}appealMe(e){v.VK.appealMe().then((t=>{this.appealActivity(e)}))}appealMyPicture(e){v.VK.appealMyPicture().then((t=>{this.appealActivity(e)}))}appealActivity(e){i.z.updateActivityAppeal.getActionSender(this).send(e,!0)}checkAndLogReducerError(){const e=this.getCurrentState().error;if(!e)return;i.z.resetError.getActionSender(this).send();const t=r.h8f;B.log({...t,message:"Reducer incorrect argument",pb:{...t.pb,customMessage:`Undefined argument "${e.argument}" for "${e.action}" action`}})}saveReactionInSuperAppLocalStorage(e,t){h(f.saveCachedMyReaction,{id:e,reaction:t})}initializePublisherServiceClient(){this.publisherServiceClient=new b.PublisherServiceClient(window.fetch.bind(window),!1)}async followPublisher(e,t){try{return await this.publisherServiceClient.publisherUserAction(e,b.S.More,t?"POST":"DELETE"),!0}catch(e){return B.log({...r.BXO,message:"Failed to follow/unfollow publisher"}),!1}}async getPublisherIsFollowing(e){try{return await this.publisherServiceClient.getUserPublisherStatus(e,b.S.More)}catch(e){return B.log({...r.s22,message:"Failed to fetch publisher follow status"}),!1}}async fetchProviderFullPageNextPage(){var e;const t=this.getCurrentState();if(null!==(e=t.providerFullPageContents)&&void 0!==e&&e.nextPageUrl){const e=await v.VK.SendGetRequest(t.providerFullPageContents.nextPageUrl);i.z.updateProviderFullPageContents.getActionSender(this).send(e)}}async fetchCreatorFullPageNextPage(){var e;const t=this.getCurrentState();if(null!==(e=t.creatorFullPageContents)&&void 0!==e&&e.nextPageUrl){const e=await v.VK.SendGetRequest(t.creatorFullPageContents.nextPageUrl);i.z.updateCreatorFullPageContents.getActionSender(this).send(e,!0)}}async getPostByPostId(e){if(!e)return;return await v.VK.getPostById(e)}isPollStatusBlocked(e){var t;const n=this.getCurrentState(),i=n&&n.contents&&n.contents[e];return(0,p.tg)(null==i?void 0:i.pollStatus)||(0,p.tg)(null===(t=n.marketSettings)||void 0===t?void 0:t.pollStatus)}async getAndUpdatePosts(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{topicId:n,postType:o,market:s=M.jG.CurrentMarket,orderBy:r,top:a=5,skip:c=0}=e;if(this.isPollStatusBlocked(n)&&o===P.h.Poll)return[];const d=this.getLocalPostItems(e)||[];if(d&&d.length>0&&(t||d.length===a))return d;const l=c+d.length,u=a-d.length,m=await v.VK.getPostsByTopicId(n,o,s,r,u,l);return i.z.updatePostItemsDict.getActionSender(this).send((0,p.OQ)(n,s),m),d.concat(m)}getLocalPostItems(e){const{topicId:t,market:n=M.jG.CurrentMarket,top:i=5,skip:o=0,postType:s}=e,r=this.getCurrentState();if(this.isPollStatusBlocked(t)&&s===P.h.Poll)return[];if(r&&r.postItemsDict&&r.postItemsDict[(0,p.OQ)(t,n)]){return[...r.postItemsDict[(0,p.OQ)(t,n)]].splice(o,i)}return[]}updatePollContextDict(e,t){i.z.updatePollContextDict.getActionSender(this).send(e,t)}setSocialEntrypointContentType(e,t){i.z.setSocialEntrypointContentType.getActionSender(this).send(e,t)}setCivicSciencePollLoaded(e){i.z.setCivicSciencePollLoaded.getActionSender(this).send(e)}}var z=n(38947);class L{reduce(e,t){if(!e)return{};if(!t)return e;let n;return z.G.handleAction(t,i.z.setTheme,(t=>{t=t||e.theme||"default",n={...e,theme:t}})),z.G.handleAction(t,i.z.updateMe,(t=>{n={...e,me:t,users:j(e.users,t.id,{data:t,isFetched:!0,isFetching:!1}),contents:ne(e.contents,t.id,t.name),...Ce("UpdateUser",{userId:t.id})}})),z.G.handleAction(t,i.z.updateUserCommunitySettings,(t=>{n={...e,userCommunitySettings:t}})),z.G.handleAction(t,i.z.updateCreatorFullPageContents,((t,i)=>{n={...e,creatorFullPageContents:we(e.creatorFullPageContents,t,i)}})),z.G.handleAction(t,i.z.updateProviderFullPageContents,(t=>{n={...e,providerFullPageContents:Pe(e.providerFullPageContents,t)}})),z.G.handleAction(t,i.z.setProviderFullPageContents,(t=>{n={...e,providerFullPageContents:Se(t)}})),z.G.handleAction(t,i.z.updateNotifications,(t=>{n={...e,notifications:Q(e.notifications,t)}})),z.G.handleAction(t,i.z.updateActivities,(t=>{n={...e,activities:X(e.activities,t)}})),z.G.handleAction(t,i.z.updateStrikeActivities,(t=>{n={...e,strikeActivities:t}})),z.G.handleAction(t,i.z.deleteActivities,(()=>{n={...e,activities:{top:0,skip:0,hasMore:!1,moreCount:0,list:[]}}})),z.G.handleAction(t,i.z.updateActivityStatus,((t,i)=>{n={...e,activities:Z(e.activities,t,i),notifications:Y(e.notifications,t,i)}})),z.G.handleAction(t,i.z.updateActivityAppeal,((t,i)=>{n={...e,activities:ee(e.activities,t,i)}})),z.G.handleAction(t,i.z.setContent,((t,i)=>{n={...e,contents:{...e.contents,[i]:t},...Ce("SetContent",{contentId:i})}})),z.G.handleAction(t,i.z.updateContent,((t,i)=>{n={...e,contents:{...e.contents,[t]:{...e.contents[t],...i}},...Ce("UpdateContent",{contentId:t})}})),z.G.handleAction(t,i.z.updateContentRating,((t,i)=>{n={...e,contents:{...e.contents,[t]:se(e.contents[t],i)},...Ce("UpdateContentRating",{contentId:t})}})),z.G.handleAction(t,i.z.insertComments,((t,i,o,s,r)=>{n={...e,contents:{...e.contents,[t]:J(e.contents[t],i,o,s,r)},...Ce("InsertComments",{contentId:t})}})),z.G.handleAction(t,i.z.resetSpecificCommentId,(()=>{n={...e,specificCommentId:void 0}})),z.G.handleAction(t,i.z.updateCommentRating,((t,i,o,s)=>{n={...e,contents:{...e.contents,[t]:ie(e.contents[t],i,o,s)},...Ce("updateCommentRating",{contentId:t,commentId:i})}})),z.G.handleAction(t,i.z.reportComment,(t=>{n={...e,contents:te(e.contents,t),...Ce("reportComment",{commentId:t})}})),z.G.handleAction(t,i.z.incrementReplyCount,((t,i)=>{n={...e,contents:{...e.contents,[t]:ae(e.contents[t],i)},...Ce("IncrementReplyCount",{contentId:t,commentId:i})}})),z.G.handleAction(t,i.z.insertComment,((t,i,o,s)=>{n={...e,contents:{...e.contents,[t]:ce(e.contents[t],i,o,s)},...Ce("InsertComment",{contentId:t,comment:i})}})),z.G.handleAction(t,i.z.updateUser,((t,i)=>{n={...e,users:j(e.users,t,i),...Ce("UpdateUser",{userId:t})}})),z.G.handleAction(t,i.z.updateUserFollowers,((t,i)=>{n={...e,users:x(e.users,t,i),...Ce("UpdateUserFollowers",{userId:t})}})),z.G.handleAction(t,i.z.updateUserFollowing,((t,i)=>{n={...e,users:q(e.users,t,i),...Ce("UpdateUserFollowing",{userId:t})}})),z.G.handleAction(t,i.z.updateUserPostsDict,((t,i,o,s)=>{n={...e,users:K(e.users,t,i,o,s),...Ce("UpdateUserPostsDict",{userId:t,posts:o})}})),z.G.handleAction(t,i.z.updateUserPostCountDict,((t,i,o)=>{n={...e,users:H(e.users,t,i,o),...Ce("UpdateUserPostCountDict",{userId:t,postCount:o})}})),z.G.handleAction(t,i.z.updateUserComments,((t,i,o)=>{n={...e,users:V(e.users,t,i,o),...Ce("UpdateUserComments",{userId:t,comments:i})}})),z.G.handleAction(t,i.z.deleteUserComment,((t,i,o)=>{n={...e,users:W(e.users,t,i),contents:de(e.contents,i,o),...Ce("DeleteUserComment",{userId:t,commentId:i})}})),z.G.handleAction(t,i.z.setReactionBreakdown,(t=>{n={...e,reactionBreakdown:t}})),z.G.handleAction(t,i.z.setGradientOverlayData,(t=>{n={...e,gradientOverlayData:t}})),z.G.handleAction(t,i.z.setPublisherSubscribeFollowButtonData,(t=>{n={...e,publisherSubscribeFollowButtonData:t}})),z.G.handleAction(t,i.z.setPopup,((t,i,o)=>{n={...e,popup:{moduleName:t,popupProps:i},previousPopup:o?{...e.popup}:void 0}})),z.G.handleAction(t,i.z.addTyper,((t,i,o,s)=>{n={...e,contents:pe(o,s,e.contents,e.me,t,i)}})),z.G.handleAction(t,i.z.updateTypers,(t=>{n={...e,contents:me(e.contents,e.me,t)}})),z.G.handleAction(t,i.z.updateViewCount,((t,i)=>{n={...e,contents:{...e.contents,[t]:he(e.contents[t],i)}}})),z.G.handleAction(t,i.z.recordSignalRHub,(t=>{n={...e,contents:{...e.contents,[t]:ge(e.contents[t],t)}}})),z.G.handleAction(t,i.z.updateResponsiveClass,(t=>{n={...e,responsiveClass:t}})),z.G.handleAction(t,i.z.mapCmsIdToContentId,((t,i,o)=>{n={...e,contentIds:{...e.contentIds,[(0,c.q)(t,i)]:o},...Ce("MapCmsIdToContentId",{contentId:o,cmsId:t})}})),z.G.handleAction(t,i.z.resetError,(()=>{n={...e,error:void 0}})),z.G.handleAction(t,i.z.setMarketSettings,(t=>{n={...e,marketSettings:t}})),z.G.handleAction(t,i.z.updatePostItemsDict,((t,i)=>{n={...e,postItemsDict:{...e.postItemsDict,[t]:be(e.postItemsDict,t,i)},...Ce("UpdatePostItemsDict",{topicId:t})}})),z.G.handleAction(t,i.z.updatePollContextDict,((t,i)=>{n={...e,pollContextDict:{...e.pollContextDict,[t]:i},...Ce("UpdatePollContextDict",{id:t})}})),z.G.handleAction(t,i.z.updatePollInsight,(t=>{n={...e,pollInsight:{...e.pollInsight,...t}}})),z.G.handleAction(t,i.z.setSocialEntrypointContentType,((t,i)=>{n={...e,socialEntrypointContentType:{...e.socialEntrypointContentType||{},[i]:t}}})),z.G.handleAction(t,i.z.setCivicSciencePollLoaded,(t=>{n={...e,isCivicSciencePollLoaded:t}})),n||e}}function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const i={isFetched:!1,isFetching:!1,data:void 0},o=e[t]||i;return{...e,[t]:{...o,...n,data:{...o.data,...n.data}}}}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const i=e[t];return i?{...e,[t]:{...i,data:{...i.data,followers:{...i.data.followers,...n,list:i.data.followers.list.concat(n.list)}}}}:e}function q(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const i=e[t];return i?{...e,[t]:{...i,data:{...i.data,following:{...i.data.following,...n,list:i.data.following.list.concat(n.list)}}}}:e}function K(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=e[t];if(!s)return e;const r=s.data.postsDict||{};return r[n]=o||!r[n]?i:r[n].concat(i),{...e,[t]:{...s,data:{...s.data,postsDict:r}}}}function H(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const o=e[t];if(!o)return e;const s=o.data.postCountDict||{};return s[n]=i,{...e,[t]:{...o,data:{...o.data,postCountDict:s}}}}function V(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=e[t];return o?{...e,[t]:{...o,data:{...o.data,comments:i?n:{...o.data.comments,...n,list:o.data.comments.list.concat(n.list)}}}}:e}function W(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const i=e[t];return i&&i.data.comments?{...e,[t]:{...i,data:{...i.data,comments:{...i.data.comments,list:ye(i.data.comments.list,n)}}}}:e}function J(e,t,n,i,o){const s=e&&e.comments&&e.comments.list?e.comments.list:[];if(i)return re(e,(e=>e.id==i?{...e,replies:ve(e.replies,t.list),replyCount:t.totalCount,repliesHasPrevious:void 0!==t.hasPrevious?t.hasPrevious:e.repliesHasPrevious,repliesHasMore:void 0!==t.hasMore?t.hasMore:e.repliesHasMore}:e));{let i;return i=n?o?t.list.concat(s):s.concat(t.list):t.list,{...e,comments:{...t,list:i,hasPrevious:void 0!==t.hasPrevious?t.hasPrevious:e.comments&&e.comments.hasPrevious,hasMore:void 0!==t.hasMore?t.hasMore:e.comments&&e.comments.hasMore}}}}function Q(e,t){const n=e?e.list:[];for(let e=0;e<t.list.length;e++){const i=t.list[e];n.find((e=>e.id==i.id))||n.push(i)}return n.sort((function(e,t){const n=new Date(e.datetime),i=new Date(t.datetime);return n<i?1:n>i?-1:0})),{...t,list:n.length>3?n.slice(0,3):n}}function Y(e,t,n){if(e)return n?{...e,list:e.list.filter((e=>e.id!=t))}:e}function X(e,t){const n=e?e.list:[];for(let e=0;e<t.list.length;e++){const i=t.list[e];if(i.type==a.k.activityType.reaction){n.find((e=>e.type==a.k.activityType.reaction&&e.target.comment&&e.target.comment.id==i.target.comment.id))&&(i.skipRender=!0)}n.push(i)}return{...t,list:n}}function Z(e,t,n){if(!e)return;const i=e?e.list:[];return i.find((e=>e.id==t))&&(i.find((e=>e.id==t)).isSeen=n),{...e,list:i}}function ee(e,t,n){if(!e)return;const i=e?e.list:[],o=i.findIndex((e=>e.id==t));return o>=0&&(i[o]={...i[o],appealSent:n}),{...e,list:i}}function te(e,t){if(e)return ue(e,(function(e){if(!e)return;const n=e&&e.comments&&e.comments.list?e.comments.list:[];return re({...e,comments:{...e.comments,list:fe(n,t)}},(e=>({...e,replies:fe(e.replies,t)})))}))}function ne(e,t,n){if(e)return ue(e,(function(e){if(e)return re(e,(e=>e.user.id!=t?e:{...e,user:{...e.user,name:n}}))}))}function ie(e,t,n,i){return re(e,(e=>{if(e.id!=t)return e;const o={...e,rating:n};return i&&(e.rating&&(o.reactionCounts[e.rating]=Math.max(0,(o.reactionCounts[e.rating]||0)-1),o.reactionSummary=oe(!0,e.rating,o.reactionSummary),o.myReaction=null),n&&(o.reactionCounts[n]=Math.max(1,(o.reactionCounts[n]||0)+1),o.reactionSummary=oe(!1,n,o.reactionSummary),o.myReaction=n.toLowerCase())),o}))}function oe(e,t,n){if(e){var i;const e=null===(i=n)||void 0===i?void 0:i.subReactionSummaries.findIndex((e=>e.type.toLowerCase()===t.toLowerCase()));e>-1&&(n.subReactionSummaries[e].totalCount-=1,n.totalCount-=1,n.subReactionSummaries[e].totalCount<1&&n.subReactionSummaries.splice(e,1))}else{var o,s;const e=null===(o=n)||void 0===o||null===(s=o.subReactionSummaries)||void 0===s?void 0:s.findIndex((e=>e.type.toLowerCase()===t.toLowerCase()));if(e>-1)n.subReactionSummaries[e].totalCount+=1;else{const e={type:t.charAt(0).toUpperCase()+t.slice(1),totalCount:1};n?n.subReactionSummaries.push(e):n={subReactionSummaries:[e],totalCount:1}}n.totalCount+=1}return n}function se(e,t){return(e=e||{reactionCounts:{}}).rating&&(e.reactionCounts[e.rating]=Math.max(0,e.reactionCounts[e.rating]-1)),t&&(e.reactionCounts[t]=Math.max(1,e.reactionCounts[t]+1)),{...e,rating:t}}function re(e,t){return{...e,comments:{...e.comments,list:e.comments&&e.comments.list?e.comments.list.map((function e(n){const i=t(n);return{...i,replies:i.replies?i.replies.map(e):null}})):null}}}function ae(e,t){const n=re(e,(e=>e.id!==t?e:{...e,replyCount:e.replyCount+1}));if(n.commentSummary){n.commentSummary.totalCount++;const e=n.commentSummary.subCommentSummaries.find((e=>"Reply"==e.type));e&&e.totalCount++}return n.totalCommentCount++,n}function ce(e,t,n,i){if(t.addedOffline=Boolean(i),n){const i=re(e,(e=>e.id!=n?e:{...e,replies:e.replies.concat(t)}));if(i.commentSummary){i.commentSummary.totalCount++;const e=i.commentSummary.subCommentSummaries.find((e=>"Reply"==e.type));e&&e.totalCount++}return i.totalCommentCount++,i}{const n={...e,comments:{...e.comments,list:[t].concat(e.comments.list)}};if(n.commentSummary){n.commentSummary.totalCount++;const e=n.commentSummary.subCommentSummaries.find((e=>"Comment"==e.type));e&&e.totalCount++}return n.totalCommentCount++,n}}function de(e,t,n){if(e)return ue(e,(function(e){if(!e)return;const i=e&&e.comments&&e.comments.list?e.comments.list:[];return n?re(e,(e=>e.id!=n?e:{...e,replies:ye(e.replies,t)})):{...e,comments:{...e.comments,list:ye(i,t)}}}))}function le(e,t){if(!t)return[];const n=Object.keys(t);if(0===n.length)return[];const i=[];e&&t[e]&&i.push(t[e]);for(const o of n)if(e&&t[e]&&t[e].id===o||i.push(t[o]),i.length>=3)return i;return i}function ue(e,t){const n={};for(const[i,o]of Object.entries(e))n[i]=t(o);return n}function pe(e,t,n,i,o,s){return ue(n,(n=>{const r=n&&n.id||e&&t&&e+"_"+t;if(!n||r!==s||Object.keys(n.typingUpdates.typingUsers).includes(o.id))return n;const a={...n.typingUpdates},c=i&&i.id,d={...a.typingUsers,[o.id]:o};return a.typingUsers=d,a.displayedTypers=le(c,d),a.numTypers=Object.keys(d).length,{...n,typingUpdates:a}}))}function me(e,t,n){return ue(e,(e=>{const i=e&&{...e.typingUpdates},o=t&&t.id;if(i&&i.typingUsers){const t={};for(const e in i.typingUsers){const o=i.typingUsers[e];o.lastTypingTime>=n&&(t[e]=o)}return Object.keys(t).length==Object.keys(i.typingUsers).length?e:{...e,typingUpdates:{...i,typingUsers:t,displayedTypers:le(o,t),numTypers:Object.keys(t).length}}}}))}function he(e,t){const n=t?(e.viewCount||0)+1:e.viewCount-1;return{...e,viewCount:n}}function ge(e,t){return{...e,typingUpdates:{typingUsers:{},displayedTypers:[],numTypers:0,hubName:t}}}function ye(e,t){const n=[];for(let i=0;i<e.length;i++){const o=e[i];o.id==t&&(o.isDeleted=!0,o.isHidden=!0,o.visibleStatus="DeletedByUser"),n.push(o)}return n}function fe(e,t){const n=[];for(let i=0;i<e.length;i++){const o=e[i];o.id==t&&(o.isReported=!0),n.push(o)}return n}function ve(e,t){const n=e.concat(t).map((e=>(e.addedOffline=!1,e))),i=n.map((e=>e.id));return n.filter((function(e,t){return i.indexOf(e.id)>=t}))}function Ce(e,t){for(const[n,i]of Object.entries(t))if(!i)return{error:{action:e,argument:n}};return{error:void 0}}function Se(e){var t,n;const i="ProfileCarousel",o=e.sections;return 0===o.length?{nextPageUrl:e.nextPageUrl,template:"providertop",feedCards:[],carouselCards:[]}:{nextPageUrl:e.nextPageUrl,template:o[0].template,feedCards:o[0].cards.filter((e=>e.type!==i)),carouselCards:null===(t=o[0].cards.filter((e=>e.type===i)))||void 0===t||null===(n=t[0])||void 0===n?void 0:n.subCards}}function Pe(e,t){if(e||t.sections&&0!==t.sections.length){if(e){const n=!(t.sections&&t.sections[0]&&t.sections[0].cards);return{nextPageUrl:n?"":t.nextPageUrl,template:n?e.template:t.sections[0].template,feedCards:[...e.feedCards,...n?[]:t.sections[0].cards],endOfFeed:n}}return Se(t)}return{nextPageUrl:void 0,template:void 0,feedCards:[],carouselCards:[]}}function we(e,t,n){if(t&&(e||t.sections&&0!==t.sections.length)){if(n){var i,o,s;const n=t.sections&&t.sections.find((e=>"creatorinfinite"===e.template)),r=!(null!=n&&null!==(i=n.cards)&&void 0!==i&&null!==(o=i[0])&&void 0!==o&&null!==(s=o.subCards)&&void 0!==s&&s.length);return{nextPageUrl:r?"":t.nextPageUrl,feedCards:[...e.feedCards,...r?[]:n.cards[0].subCards],rightRailCards:[...e.rightRailCards],endOfFeed:r}}var r,a;return{nextPageUrl:t.nextPageUrl,feedCards:(null===(r=t.sections.find((e=>"creatorinfinite"===e.template)))||void 0===r?void 0:r.cards[0].subCards)||[],rightRailCards:(null===(a=t.sections.find((e=>"creatorright"===e.template)))||void 0===a?void 0:a.cards)||[]}}return{nextPageUrl:void 0,feedCards:[],rightRailCards:[]}}function be(e,t,n){if(!e||!e[t])return n;const i=e[t];return n=n.filter((e=>!i.find((t=>t.postId===e.postId)))),(0,T.q)(n)?i.concat(n):i}const Ae={experienceConfigSchema:{}}},45067:function(e,t,n){n.d(t,{k:function(){return p}});var i=n(57663),o=n(15598),s=n(5884),r=n(55465),a=n(77262),c=n(22680),d=n(98137),l=n(68738);const u=e=>null!=e;class p{static convertContent(e){if(!e)return null;const t=r.k.binaryReactionOrder,n={};t.map((t=>{e&&(e.reactionSummary?n[t]=(e.reactionSummary.subReactionSummaries.find((e=>e.type.toLowerCase()==t))||{totalCount:0}).totalCount:n[t]=0)}));const i=!e.cmsId&&e.id?e.id.replace(`_${e.market}`,""):e.id;return{comments:{skip:0,top:0,moreCount:0,list:[]},...e,id:i,reactionStatus:e.reactionStatus?e.reactionStatus.toLowerCase():"on",commentStatus:e.commentStatus?e.commentStatus.toLowerCase():"on",pollStatus:e.pollStatus?e.pollStatus.toLowerCase():"on",totalCommentCount:e.commentSummary?e.commentSummary.totalCount:0,reactionCounts:n}}static convertUser(e){if(e){let t;t=e.isSocialUser?r.k.userStateType.existingUser:e.id&&!e.id.startsWith("m-")?r.k.userStateType.newUser:r.k.userStateType.anonymous;let n=e.nameStatus&&"Unknown"!==e.nameStatus?e.nameStatus:r.k.userNameStatusType.normal;return t!=r.k.userStateType.newUser||null!=e.primaryName&&""!==e.primaryName.trim()||(n=r.k.userNameStatusType.notAllow),"vid-ksdbkre0pxrdbnxqmr5xbyu056sdgdim5cna8urvbu45yi3x7jqs"==e.id&&(e.coverImageUrl=`${(0,i.Yq)().StaticsUrl}/latest/community/img/premium-profile-promo-card/LA-cover-banner-image.png`),{...e,name:e.primaryName,avatarUrl:e.notUseAvatar||!e.primaryAvatar?void 0:e.primaryAvatar,likesCount:e.reactionSummary?e.reactionSummary.totalCount:0,postsCount:e.commentSummary?e.commentSummary.totalCount:0,followersCount:(e.followSummary&&e.followSummary.subFollowSummaries.find((e=>"FollowBy"==e.type))||{totalCount:0}).totalCount,followingCount:(e.followSummary&&e.followSummary.subFollowSummaries.find((e=>"Follow"==e.type))||{totalCount:0}).totalCount,reactionsCount:e.reactionSummary&&e.reactionSummary.totalCount||0,badge:"Commenter",state:t,avatarStatus:e.avatarStatus||r.k.userAvatarStatusType.normal,nameStatus:n,ageGroup:e.ageGroup||r.k.userAgeGroup.above18,banLevel:e.banLevel,isFollowing:e.isFollowedByMe}}return{state:r.k.userStateType.anonymous}}static convertUpdateUserNameResponse(e){return e?"Active"==e.state?"InReview":"Closed"==e.state&&"Approved"==e.reason?"Approved":"Rejected":"Rejected"}static convertUserList(e){return e?{skip:e.skip,top:e.top,hasMore:e.hasMore,moreCount:e.totalCount-(e.top+e.skip),totalCount:e.totalCount,list:e.items.map((e=>this.convertUser(e.links.length>0&&e.links.find((e=>"User"==e.type)).item||null)))}:null}static convertComment(e){if(!e)return null;let t=null,n=null;if(e.links){const i=e.links.find((t=>"User"==t.type&&t.item.id==e.createdBy));t=i?p.convertUser(i.item):null;const o=e.links.find((e=>"Content"==e.type));n=o?p.convertContent(o.item):null}const i=e.visibleStatus!=r.k.visibleStatusType.Normal,o=e.visibleStatus==r.k.visibleStatusType.InReview,s=[r.k.visibleStatusType.DeletedByAI,r.k.visibleStatusType.DeletedByHI,r.k.visibleStatusType.DeletedByUser].includes(e.visibleStatus),a={};return r.k.reactionOrder.map((t=>{e.reactionSummary?a[t]=(e.reactionSummary.subReactionSummaries.find((e=>e.type.toLowerCase()==t))||{totalCount:0}).totalCount:a[t]=0})),{...e,ownerId:e.createdBy,text:e.body,createDatetime:e.createdTime,reactionCounts:a,user:t,content:n,isHidden:i,isInReview:o,isDeleted:s,replies:[],replyCount:e.commentSummary?e.commentSummary.totalCount:0}}static convertCommentList(e){return e?{commentStatus:"On",skip:e.skip,top:e.top,hasMore:e.hasMore,hasPrevious:e.hasPrevious,asc:e.asc,orderby:e.orderby,moreCount:e.totalCount-(e.top-1+e.skip-1+2),totalCount:e.totalCount,list:e.items.map((e=>p.convertComment(e)))}:null}static convertPost(e){return e&&e.postId?{...e}:null}static convertPostList(e){return e?e.map((e=>p.convertPost(e))):null}static convertReactionsResponseToReactionBreakdownData(e,t){if(!e)return null;const n=e.items;let i;try{i=e.links.find((e=>"Content"==e.type||"Comment"==e.type)).item.reactionSummary.subReactionSummaries}catch(e){i=null}const o={reactionCounts:{all:0},items:{all:[]},content:null};if(r.k.reactionOrder.map((e=>{o.reactionCounts[e]=0,o.items[e]=[]})),i&&i.map((e=>{o.reactionCounts[e.type.toLowerCase()]=e.totalCount,o.reactionCounts.all+=e.totalCount})),n&&n.filter((e=>r.k.reactionOrder.includes(e.subType.toLowerCase()))).map((e=>{const t=e.subType.toLowerCase(),n=e.links.find((e=>"User"==e.type))?e.links.find((e=>"User"==e.type)).item:{state:r.k.userStateType.anonymous,primaryName:"You"};n.isFollowing=!!e.links.find((e=>"Follow"==e.type)),o.items[e.subType.toLowerCase()].push({user:n,rateValue:t}),o.items.all.push({user:n,rateValue:t})})),e.links&&e.links.length>0){const t=e.links.filter((e=>"content"==e.type.toLowerCase()));t.length>0&&(o.content=t[0].item)}return o}static convertRatingToRateValue(e){e&&e.items&&(e=e.items[0]);return e&&e.subType?e.subType.toLowerCase():null}static convertUserStrikeActivities(e){var t,n,i,o;return{Warning:null===(t=e.items.map((e=>e.links.find(l.p1))).filter(u).find((e=>e.item.subType==r.k.accountModerationStatus.warning)))||void 0===t?void 0:t.item.createdDateTime,FirstStrike:null===(n=e.items.map((e=>e.links.find(l.p1))).filter(u).find((e=>e.item.subType==r.k.accountModerationStatus.firstStrike)))||void 0===n?void 0:n.item.createdDateTime,SecondStrike:null===(i=e.items.map((e=>e.links.find(l.p1))).filter(u).find((e=>e.item.subType==r.k.accountModerationStatus.secondStrike)))||void 0===i?void 0:i.item.createdDateTime,Ban:null===(o=e.items.map((e=>e.links.find(l.p1))).filter(u).find((e=>e.item.subType==r.k.accountModerationStatus.ban)))||void 0===o?void 0:o.item.createdDateTime}}static convertUserActivities(e){if(!e)return null;const t=e.items.map((e=>{var t;const n=null===(t=e.links.find(l.p1))||void 0===t?void 0:t.item;if(n)return"ApproveCommentAppeal"===n.subType?{targetId:n.targetId,createdDateTime:n.createdDateTime}:void 0})).filter(u),n=e.items.map((e=>{var t;const n=null===(t=e.links.find(l.p1))||void 0===t?void 0:t.item;if(n)return"RejectCommentAppeal"===n.subType?{targetId:n.targetId,createdDateTime:n.createdDateTime}:void 0})).filter(u);return e.items.map((e=>{var o;const s=null===(o=e.links.find(l.p1))||void 0===o?void 0:o.item;s&&("Takedown"===s.subType&&t.map((e=>{e.targetId.includes(s.targetId)&&(s.appealResult="approved",s.appealResponseDate=new Date(e.createdDateTime).toLocaleDateString(i.jG.CurrentMarket,{day:"2-digit",month:"long",year:"numeric"}))})),"Takedown"===s.subType&&n.map((e=>{e.targetId.includes(s.targetId)&&(s.appealResult="denied",s.appealResponseDate=new Date(e.createdDateTime).toLocaleDateString(i.jG.CurrentMarket,{day:"2-digit",month:"long",year:"numeric"}))})))})),{skip:e.skip,top:e.top,hasMore:e.hasMore,moreCount:e.totalCount-(e.top-1+e.skip-1+2),list:e.items.map((e=>this.convertUserActivity(e))).filter(u)}}static convertUserActivity(e){if(!e)return null;const t={id:e.id,type:e.type,datetime:e.createdDateTime,isSeen:e.read,notification:e.notification};switch(e.type){case r.k.activityType.follow:{const n=e.links.find(l.N9);return n?{...t,user:this.convertUser(n.item)}:null}case r.k.activityType.badge:{const n=e.links.find(l.bI);return{...t,badgeType:n?n.item.subType:void 0}}case r.k.activityType.reply:{const n=e.links.find(l.N9),i=e.links.find(l.SX),o=e.links.find(l.fc);return n&&o?{...t,user:this.convertUser(n.item),target:{url:null==i?void 0:i.item.url,body:o.item.body,comment:this.convertComment(o.item)}}:null}case r.k.activityType.reaction:{const n=e.links.find(l.N9),i=e.links.find(l.SX),o=e.links.find(l.fc),s=e.links.find(l.oU),r=s&&"Comment"==s.item.targetType?this.convertSubReactionSummariesToReactionCounts(o&&o.item.reactionSummary&&o.item.reactionSummary.subReactionSummaries):this.convertSubReactionSummariesToReactionCounts(i&&i.item.reactionSummary&&i.item.reactionSummary.subReactionSummaries),a=s&&"Comment"==s.item.targetType?o&&o.item.body:i&&i.item.title;return n&&a?{...t,user:this.convertUser(n&&n.item),target:{url:i&&i.item.url,reactionCounts:r,body:a,comment:o&&this.convertComment(o.item)}}:null}case r.k.activityType.moderation:{const n=e.links.find(l.SX),i=e.links.find(l.fc),o=e.links.find(l.p1),s=o?o.item.subType:void 0,a=o&&"Takedown"===o.item.subType&&o.item.reasons[0];return s?{...t,moderationErrorType:s,message:r.k.activityModerationErrorTypeStringKeyMap[s]||"",reason:a&&r.k.moderationTakedownReasonStringKeyMap[a]||"",appealResult:o&&o.item.appealResult,appealResponseDate:o&&o.item.appealResponseDate,target:i&&{url:n&&n.item.url,id:i.item.id,body:i.item.body,comment:i&&this.convertComment(i.item)}}:null}}return t}static convertSubReactionSummariesToReactionCounts(e){if(!e)return null;const t={all:0};return r.k.reactionOrder.map((e=>{t[e]=0})),e.map((e=>{t[e.type.toLowerCase()]=e.totalCount})),t}static mapFeedResponseToSocialBarData(e,t,n,i,o,s,a){const d=(0,c.l4)();if(d&&d.indexOf("reactionstest")>-1){try{i={totalCount:0,subCommentSummaries:[]},(n={totalCount:0,subReactionSummaries:[]}).totalCount=Math.floor(1e4*Math.random()),i.totalCount=Math.floor(1e4*Math.random());["angry","like","love","sad","surprised","thinking","upvote","downvote"].sort((()=>.5-Math.random())).slice(0,Math.floor(3*Math.random())).forEach((e=>n.subReactionSummaries.push({totalCount:Math.floor(10*Math.random()),type:e})))}catch{}if(i.totalCount>0)try{const e=[{id:"82ccfa9b-56ac-41ca-9546-9f3910ec3cec"},{id:"f21a5f91-a6a9-4e80-bb59-3839e296773f"},{id:"c400d1c0-2f0d-469f-986c-8bebe2de1060"},{id:"1be1cb2b-6210-43b4-b962-ce1df9b524d0"},{id:"4e19e02f-f6fc-405d-8f99-1f007ce7f5df"}],t=Math.floor(5*Math.random());o=e.slice(t,t+1)}catch{}}const l=n&&n.subReactionSummaries?n.subReactionSummaries:[],u=r.k.binaryReactionOrder,m={};u.map((e=>{m[e]=(e=>{if(Array.isArray(l)){const t=l.find((t=>t&&t.type&&"string"==typeof t.type&&t.type.toLowerCase()===e));return t?t.totalCount:0}})(e)}));const h=!t&&p.getLocalContentReaction(e,a);h&&m[t=h]++;const g=!n,y=!i;return{id:e,reactionStatus:s&&s.reactionStatus?s.reactionStatus.toLowerCase():"on",commentStatus:s&&s.commentStatus?s.commentStatus.toLowerCase():"on",reactionsOptedOut:g,commentsOptedOut:y,reactionCounts:m,totalCommentsCount:i&&i.totalCount,myReaction:t&&t.toLowerCase(),topComments:o}}static getLocalContentReaction(e,t){if(t)return t(e);if((0,o.$o)().supported){const t=(0,d.z_)();return(0,o.$o)().getItem((0,d.xp)(t,e))}return null}static setLocalContentReaction(e){if((0,o.$o)().supported){const t=(0,d.z_)();(0,o.$o)().setItem((0,d.xp)(t,e),"upvote")}}static deleteLocalContentReaction(e){if((0,o.$o)().supported){const t=(0,d.z_)();(0,o.$o)().removeItem((0,d.xp)(t,e))}}static convertCommentToTopCommentData(e,t,n){return e&&e.user?{market:n,username:e.user.primaryName,avatarUrl:e.user.notUseAvatar||!e.user.primaryAvatar?void 0:e.user.primaryAvatar,profileUrl:(0,a.B_)(`${r.k.externalUrls.profilePage}${e.user.id}`,n),commentUrl:(0,a.B_)(t,n,e.id),commentBody:e.text,contentUrl:`${t}#comments`,replyCount:e.replyCount,reactionCounts:e.reactionCounts,reactionSummary:e&&e.reactionSummary,createDatetime:e.createDatetime,commentId:e.id}:null}static convertPublisherFeed(e){var t,n,i;if(null==e||!e.sections)return;const o=null==e||null===(t=e.sections[0])||void 0===t?void 0:t.cards;if(!o||o.length<1)return;const s=null===(n=o[0])||void 0===n?void 0:n.provider;return{items:null===(i=o[0])||void 0===i?void 0:i.subCards.map((e=>({...e,provider:s})))}}static convertTopCommentedToPublisherCarouselData(e,t){return e.filter((e=>{const n=t[e.cmsId];return n.imageResources&&n.imageResources.length>0||n.thumbnail})).map((e=>{const n=t[e.cmsId];let i;return i=n.imageResources&&n.imageResources.length>0?n.imageResources.map((e=>({width:e.width,height:e.height,url:e.url,attribution:e.attribution,title:e.title,quality:e.quality,focalRegion:e.focalRegion,source:e.source}))):[{width:n.thumbnail.image.width,height:n.thumbnail.image.height,url:n.thumbnail.image.url,attribution:n.thumbnail.image.attribution,title:n.thumbnail.image.title,quality:n.thumbnail.image.quality,source:n.thumbnail.image.source}],{id:e.cmsId,type:"article",clickUrl:e.url,title:e.title,category:n.categories[0].product,readTimeMin:n.readTimeMin,reactionSummary:e.reactionSummary,images:i,publishedDateTime:e.createdTime,commentCount:e.commentSummary.totalCount,provider:{id:n.provider.id,name:n.provider.name,logoUrl:n.provider.logo.url,profileId:n.provider.publisherProfileId},subscriptionProductType:s.Cd[n.subscriptionProductType],url:e.url,locale:n.locale}}))}static convertMarketSettings(e){return{conversationTitles:e.conversationTitles,commentReportingTraits:e.reportingTraits.comment,postsReportingTraits:e.reportingTraits.posts,starRatingStatus:e.starRatingStatus,userNameReportingTraits:e.reportingTraits.userName,userPictureReportingTraits:e.reportingTraits.userPicture,pollStatus:e.pollStatus}}static convertTopics(e){if(!e)return;let t,n;try{t=e.Content?JSON.parse(e.Content):[]}catch(e){t=[]}try{n=e.ArticleTierTags?JSON.parse(e.ArticleTierTags):null}catch(e){n=null}return{title:e.Title,creationIdeaId:e.CreationIdeaId,content:t,imageUrl:e.ImageUrl,market:e.Market,rankPosition:e.RankPosition,score:e.Score,reason:e.Reason,articleTitle:e.ArticleTitle,articleUrl:e.ArticleUrl,articleTierTags:n}}}},68738:function(e,t,n){function i(e){return"User"===e.type}function o(e){return"Achievement"===e.type}function s(e){return"Reaction"===e.type}function r(e){return"Content"===e.type}function a(e){return"Comment"===e.type}function c(e){return"ModerationRecord"===e.type}n.d(t,{N9:function(){return i},SX:function(){return r},bI:function(){return o},fc:function(){return a},oU:function(){return s},p1:function(){return c}})},3520:function(e,t,n){n.d(t,{h:function(){return i}});const i=Object.freeze({Discussion:"Discussion",Poll:"Poll",Post:"Post"})},63024:function(e,t,n){var i,o;n.d(t,{F:function(){return i},i:function(){return o}}),function(e){e[e.NoProfile=0]="NoProfile",e[e.RewardsUser=1]="RewardsUser",e[e.MuidUser=2]="MuidUser"}(i||(i={})),function(e){e[e.Tipping=1]="Tipping",e[e.Subscription=2]="Subscription",e[e.BackupPaymentSubscription=3]="BackupPaymentSubscription"}(o||(o={}))},46751:function(e,t,n){var i,o,s;n.d(t,{FE:function(){return o},H:function(){return i},ZF:function(){return s}}),function(e){e.like="like",e.love="love",e.surprised="surprised",e.thinking="thinking",e.sad="sad",e.angry="angry",e.share="share"}(i||(i={})),function(e){e.upvote="upvote",e.downvote="downvote"}(o||(o={})),function(e){e.star1="star1",e.star2="star2",e.star3="star3",e.star4="star4",e.star5="star5"}(s||(s={}))},61149:function(e,t,n){n.d(t,{_Q:function(){return W},VK:function(){return V},PR:function(){return J}});var i=n(20938),o=n(98137),s=n(42122),r=n(44132);const a=new class{constructor(){this.onAppError=void 0}log(e){const t={...e,message:`Community API Request Failed - Error Code: ${e.message}`};if(this.onAppError)try{this.onAppError(t)}catch(e){s.k.logError(e)}else r.M0.sendAppErrorEvent(t)}setOnAppError(e){this.onAppError=e}};var c=n(5302);c.xQV,c.ic4,c.VWS,c.E7H;const d=c.pjz,l=c.Ely,u=c.Ead,p=c.nvG,m=c.XDS,h=c.HPv,g=c.rVI,y=c.F7i,f=c.daM,v=c.jyo,C=(c.tLx,c.tN1),S=c.Fyn,P=c.xdR;async function w(){return new Promise(((e,t)=>{if(window.AzureStorage)return e(window.AzureStorage);!function(e,t,n){const i=document,o="script";if(!i.getElementById(t)){const s=i.getElementsByTagName(o)[0],r=i.createElement(o);r.id=t,r.src=e,r.onload=n,s.parentNode.insertBefore(r,s)}}("https://assets.msn.com/labs/views/CommentWidget/js/azure-storage.blob.min.js","azure-storage-blob-jssdk",(()=>window.AzureStorage?e(window.AzureStorage):t()))}))}var b=n(2565),A=n(57663),k=n(59878),T=n(5232),U=n(28951),R=n(79493),I=n(63228),M=n(15598),E=n(7766),D=n(88048),G=n(18906),_=n(40053),N=n(63024),B=n(46751),F=n(55465);const O=e=>e.getFullYear()+"-"+`0${e.getMonth()+1}`.substr(-2)+"-"+`0${e.getDate()}`.substr(-2);var $=n(76753),z=n(52185),L=n(22680),j=n(45067),x=n(17395),q=n(32308);function K(e,t){return(0,q.O)(e,t,6e4)}const H="ddd-debugid";class V{static get useCache(){return z.Gq.get("__SocialServiceUseCacheKey__",(()=>!0))}static set useCache(e){z.Gq.set("__SocialServiceUseCacheKey__",e)}static get domain(){return z.Gq.get("__SocialServiceDomainKey__",(()=>F.k.externalUrls.api))}static set domain(e){z.Gq.set("__SocialServiceDomainKey__",e)}static get msphDomain(){return z.Gq.get("__SocialServiceMsphDomainKey__",(()=>F.k.externalUrls.msphApi))}static set msphDomain(e){z.Gq.set("__SocialServiceMsphDomainKey__",e)}static get additionalHeaders(){return z.Gq.get("__SocialServiceAdditionalHeadersKey__")}static set additionalHeaders(e){z.Gq.set("__SocialServiceAdditionalHeadersKey__",e)}static get additionalParameters(){return z.Gq.get("__SocialServiceAdditionalParametersKey__")}static set additionalParameters(e){z.Gq.set("__SocialServiceAdditionalParametersKey__",e)}static get contentAllowBlockListMap(){return z.Gq.get("__SocialServiceContentAllowBlockListMapKey__",(()=>({})))}static set contentAllowBlockListMap(e){z.Gq.set("__SocialServiceContentAllowBlockListMapKey__",e)}static get shouldUseAbortableFetch(){return z.Gq.get("__SocialServiceShouldUseAbortableFetchKey__",(()=>!1))}static set shouldUseAbortableFetch(e){z.Gq.set("__SocialServiceShouldUseAbortableFetchKey__",e)}static get abortableFetchTimeout(){return z.Gq.get("__SocialServiceAbortableFetchTimeoutKey__",(()=>500))}static set abortableFetchTimeout(e){z.Gq.set("__SocialServiceAbortableFetchTimeoutKey__",e)}static get cachedResponses(){return z.Gq.get("__SocialServiceCachedResponsesKey__",(()=>({})))}static set cachedResponses(e){z.Gq.set("__SocialServiceCachedResponsesKey__",e)}static get rewardsInfoObservers(){return z.Gq.get("__SocialServiceRewardsInfoObserversKey__",(()=>[]))}static set rewardsInfoObservers(e){z.Gq.set("__SocialServiceRewardsInfoObserversKey__",e)}static get msaAccessToken(){return z.Gq.get("__SocialServiceMsaAccessTokenKey__")}static set msaAccessToken(e){z.Gq.set("__SocialServiceMsaAccessTokenKey__",e)}static get muid(){return z.Gq.get("__SocialServiceMuidKey__")}static set muid(e){z.Gq.set("__SocialServiceMuidKey__",e)}static get socialServiceOCID(){return z.Gq.get("__SocialServiceSocialServiceOCIDKey__",(()=>"social-peregrine"))}static set socialServiceOCID(e){z.Gq.set("__SocialServiceSocialServiceOCIDKey__",e)}static get endpoints(){return z.Gq.get("__SocialServiceEndpointsKey__",(()=>({contents:V.domain.concat("urls/"),providerContents:V.domain.concat("contents"),comments:V.domain.concat("comments/"),posts:V.domain.concat("posts/"),users:V.domain.concat("users/"),follows:V.domain.concat("follows/"),marketsettings:V.domain.concat("marketsettings"),imageSearch:V.domain.concat("Image"),creationIdeas:V.domain.concat("creationideas/user"),systags:"https://api.msn.com/graph/systags",typingUpdates:`${(0,A.Yq)().AssetsUrl}/labs/api/`,publisherFeed:"https://api.msn.com/news/feed/pages/publisherfeed",paymentOptions:`${(0,A.Yq)().AssetsUrl}/xpay/subscription/paywall_nosign`,providerFullPage:`${(0,A.Yq)().AssetsUrl}/service/news/feed/pages/providerfullpage`,creatorHubFullPage:`${(0,A.Yq)().AssetsUrl}/service/news/feed/pages/creatorfullpage`,msphPost:V.msphDomain.concat("/contents/posts"),msphAccount:V.msphDomain.concat("/account/community"),msphInsights:V.msphDomain.concat("/Insights/Content/brief"),image:A.jG.IsChinaCompliance?"https://api.msn.cn":"https://api.msn.com/Finance/Image",hubble:"https://hubble.officeapps.live.com/mediasvc/api/media/aggregate"})))}static set endpoints(e){z.Gq.set("__SocialServiceEndpointsKey__",e)}static getMsaAccessToken(){return V.msaAccessToken||(0,i.X)("msaAccessToken")}static getMuid(){const e=V.muid||(0,i.X)("muid");return e?"m-"+e:null}static get isWinWidgetsAppType(){return"winWidgets"===A.jG.AppType||"windowsNewsPlus"===A.jG.AppType}static get isApiModerationVertical(){var e;return null===(e=F.k.moderationSourceOverrideVerticals)||void 0===e?void 0:e.includes(A.jG.AppType)}static get ocid(){var e;return this.isWinWidgetsAppType?"sidebar"===(null===k.Al||void 0===k.Al||null===(e=k.Al.ClientSettings)||void 0===e?void 0:e.pagetype)?"shoreline":"winp2":(0,i.X)("ocid")||(0,T.ku)()||E.$D.getOneServiceOCID(A.jG.TrackInfo,"")}static setAdditionalHeaders(e){V.additionalHeaders=e}static setAdditionalParameters(e){V.additionalParameters=e}static setDomain(e,t){this.domain=e,this.msphDomain=t,this.endpoints={...this.endpoints,contents:V.domain.concat("urls/"),providerContents:V.domain.concat("contents"),comments:V.domain.concat("comments/"),posts:V.domain.concat("posts/"),users:V.domain.concat("users/"),follows:V.domain.concat("follows/"),creationIdeas:V.domain.concat("creationideas/user"),msphPost:V.msphDomain.concat("/contents/posts"),msphAccount:V.msphDomain.concat("/account/community"),msphInsights:V.msphDomain.concat("/Insights/Content/brief")}}static configureAbortableFetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;V.shouldUseAbortableFetch=e,V.abortableFetchTimeout=t}static setMsaAccessToken(e){V.msaAccessToken=e}static setMuid(e){V.muid=e}static setSocialServiceOCID(e){this.socialServiceOCID=e}static async fetchMe(e){const t=await V.getUserById("me",e);return(0,o.yp)(t.id),t}static async getUserById(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return V.GET(V.endpoints.users+e,{version:"1.1",profile:"social",verify:t,market:A.jG.CurrentMarket}).then((e=>j.k.convertUser(e||null)))}static async createUser(e){const t={notUseAvatar:e||!1,market:A.jG.CurrentMarket};return V.POST(V.endpoints.users+"me",t,{profile:"social"}).then((e=>j.k.convertUser(e||null))).catch((e=>e.json().then((e=>{throw e}))))}static async updateUsername(e){const t={requestType:"UpdateName",changes:{PrimaryName:e}};return V.POST(V.endpoints.users+"me/userrequests",t).then((e=>j.k.convertUpdateUserNameResponse(e||null))).catch((e=>e.json().then((e=>{throw e}))))}static async getUserProfile(e){let t={followers:void 0,following:void 0,comments:void 0};try{const n=await V.GET(V.endpoints.users+e,{version:"1.1",profile:"social",market:A.jG.CurrentMarket});t={...t,...j.k.convertUser(n||null)}}catch(e){return t}return Promise.all([V.getFollowersByUserId(e).then((e=>{t.followers=e})),V.getFollowingsByUserId(e).then((e=>{t.following=e})),V.getCommentsByUserId(e).then((e=>{t.comments=e}))]).then((e=>t)).catch((t=>{s.k.logError("Error getting user profile: "+t.statusText),r.M0.sendAppErrorEvent({...c.lnl,message:`error getting user profile data ${e} ${JSON.stringify(t)}`})}))}static async getUserContents(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s={market:t,query:n,$top:o.top||20,$skip:o.skip||0,$orderby:o.orderBy||"Time",...i&&{productType:"premium"}};return V.GET(V.endpoints.users+e+"/contents",s)}static async updateUserSettings(e,t,n){const i={};return i[e]={isPrivateProfile:t,enableDisplayNameMasking:n},V.PUT(V.endpoints.users+e+"/settings",i,{})}static async deleteMyData(e){const t={...e,profile:"social"};return V.DELETE(V.endpoints.users+"me/",t)}static async getCreationIdeas(){const e={market:A.jG.CurrentMarket};return V.GET(V.endpoints.creationIdeas,e).then((e=>{var t;if(e&&(null===(t=e.Result)||void 0===t?void 0:t.length)>0)return e.Result.map((e=>j.k.convertTopics(e)))})).catch((async e=>{var t;t={reason:"get creation ideas failed",err:(null==e?void 0:e.message)??e},a.log({...P,message:"get_creation_ideas",pb:{...P.pb,url:V.endpoints.creationIdeas,method:"GET",customMessage:JSON.stringify(t)}})}))}static async getPostListByUserId(e){const t={requestsource:"community",handler:"list",top:arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,skip:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,status:arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.$.None};return V.GET(V.endpoints.msphPost,t).then((e=>e)).catch((async t=>{const n=e=>{a.log({...l,message:"list",pb:{...l.pb,url:V.endpoints.msphPost,method:"GET",customMessage:JSON.stringify(e)}})};if(400===t.status)try{const e=await t.json();4!==JSON.parse(e.Message).errorCode&&n({reason:"unexpected_error_code",data:e.Message})}catch(t){n({reason:"invalid_response",error:(null==t?void 0:t.message)??t})}else n({reason:"get posts failed",userId:e,err:(null==t?void 0:t.message)??t});return{searchMatchedTotal:0,documents:[]}}))}static async getPostDetail(e){const t={requestsource:"community",handler:"load_detail",itemId:e};return V.GET(V.endpoints.msphPost,t).then((e=>e)).catch((async t=>{const n=e=>{a.log({...u,message:"load_detail",pb:{...u.pb,url:V.endpoints.msphPost,method:"GET",customMessage:JSON.stringify(e)}})};if(400===t.status)try{const e=await t.json();4!==JSON.parse(e.Message).errorCode&&n({reason:"unexpected_error_code",data:e.Message})}catch(t){n({reason:"invalid_response",error:(null==t?void 0:t.message)??t})}else n({reason:"get post failed",postId:e,err:(null==t?void 0:t.message)??t})}))}static async submitPost(e,t){const n={requestsource:"community",handler:"save_publish",type:t},i=e=>{a.log({...d,message:n.handler,pb:{...d.pb,url:V.endpoints.msphPost,method:"POST",customMessage:JSON.stringify(e)}})};try{const t=await V.POST(V.endpoints.msphPost,e,n);return 2===t.status||(i({reason:"invalid_status",resp:t}),!1)}catch(e){return i({reason:"failed",err:(null==e?void 0:e.message)??e}),!1}}static async savePost(e,t){const n={requestsource:"community",handler:"save_draft",type:t},i=e=>{a.log({...g,message:"save_draft",pb:{...g.pb,url:V.endpoints.msphPost,method:"POST",customMessage:JSON.stringify(e)}})};try{const t=await V.POST(V.endpoints.msphPost,e,n);return 1===t.status?t.id:void i({reason:"invalid_status",resp:t})}catch(e){return void i({reason:"save post failed",err:(null==e?void 0:e.message)??e})}}static async publishPost(e,t){const n={requestsource:"community",handler:"publish",itemId:e,type:t},i=e=>{a.log({...m,message:"publish",pb:{...m.pb,url:V.endpoints.msphPost,method:"PUT",customMessage:JSON.stringify(e)}})};try{const t=await V.PUT(V.endpoints.msphPost,{},n);return 2===t.status||(i({reason:"invalid_status",postId:e,resp:t}),!1)}catch(t){return i({reason:"publish failed",postId:e,err:(null==t?void 0:t.message)??t}),!1}}static async unpublishPost(e,t){const n={requestsource:"community",handler:"unpublish",itemId:e,type:t};return V.PUT(V.endpoints.msphPost,{},n).then((e=>!0)).catch((e=>{var t;return t={reason:"unpublish failed",err:(null==e?void 0:e.message)??e},a.log({...p,message:"unpublish",pb:{...p.pb,url:V.endpoints.msphPost,method:"PUT",customMessage:JSON.stringify(t)}}),!1}))}static async deletePost(e,t){const n={requestsource:"community",handler:"delete",itemId:e,type:t};return V.DELETE(V.endpoints.msphPost,n).then((()=>!0)).catch((t=>{var n;return n={reason:"delete post failed",postId:e,err:(null==t?void 0:t.message)??t},a.log({...h,message:"delete",pb:{...h.pb,url:V.endpoints.msphPost,method:"POST",customMessage:JSON.stringify(n)}}),!1}))}static async appealPost(e,t,n){const i={requestsource:"community",handler:"appeal",itemId:e,type:t};return V.POST(V.endpoints.msphPost,n,i).then((()=>!0)).catch((t=>{var n;return n={reason:"submit appeal failed",postId:e,err:(null==t?void 0:t.message)??t},a.log({...y,message:"appeal",pb:{...y.pb,url:V.endpoints.msphPost,method:"POST",customMessage:JSON.stringify(n)}}),!1}))}static async createMsphAccount(){const e={requestsource:"community"},t={market:A.jG.CurrentMarket};try{return await V.POST(V.endpoints.msphAccount,t,e),"pending"}catch(e){const t=e=>{a.log({...f,message:"create_account",pb:{...f.pb,url:V.endpoints.msphAccount,method:"POST",customMessage:JSON.stringify(e)}})};if(400===e.status)try{const n=await e.json();switch(JSON.parse(n.Message).errorCode){case 38:return"invalid_market";case 844:return"not_poster_user";case 845:return"pending";case 36:return"not_community_user";case 846:return"invalid_name";case 847:return"invalid_avatar";default:return t({reason:"unexpected_error_code",data:n.Message}),"error"}}catch(e){return t({reason:"invalid_response",error:(null==e?void 0:e.message)??e}),"error"}return t({reason:"failed",status:e.status}),"error"}}static async queryMsphAccount(){const e={requestsource:"community"};try{return 2===(await V.GET(V.endpoints.msphAccount,e)).accountStatus?"active":"pending"}catch(e){const t=e=>{a.log({...f,message:"query_account",pb:{...f.pb,url:V.endpoints.msphAccount,method:"GET",customMessage:JSON.stringify(e)}})};if(400===e.status)try{const n=await e.json(),i=JSON.parse(n.Message);return 844===i.errorCode?"not_poster_user":848===i.errorCode?"not_msph_user":13===i.errorCode?"is_aad_user":1===i.errorCode?"not_msph_user":(t({reason:"unexpected_error_code",data:n.Message}),"error")}catch(e){return t({reason:"invalid_response",error:(null==e?void 0:e.message)??e}),"error"}return t({reason:"failed",status:e.status}),"error"}}static async getInsightsBrief(e,t){const n={requestsource:"community",startDate:O(new Date(e)),endDate:O(new Date(t))};return V.GET(V.endpoints.msphInsights,n).catch((async e=>{const t=e=>{a.log({...v,message:"get_analytics",pb:{...v.pb,url:V.endpoints.msphInsights,method:"GET",customMessage:JSON.stringify(e)}})};if(400===e.status)try{const n=await e.json();1!==JSON.parse(n.Message).errorCode&&t({reason:"unexpected_error_code",data:n.Message})}catch(e){t({reason:"invalid_response",error:(null==e?void 0:e.message)??e})}else t({reason:"get analysis data failed",err:(null==e?void 0:e.message)??e})}))}static async uploadPostImage(e){const t=`${Math.random().toString(36).slice(2)}.jpg`,n=new URL(this.endpoints.image);n.search=U.c.keyValueArrayToQueryString([...U.c.getParams(A.jG.ContentServiceUrlBase.search),...E.$D.getOneServiceParamsWithoutAuth(A.jG.UserId,"",!1),{key:"path",value:"community"},{key:"name",value:t}]);const i=await E.$D.getBaseRequestData("POST");i.body=e,i.headers["Content-Type"]="image/jpeg";try{const e=await fetch(n.href,i);return(await e.json()).url}catch(e){return(e=>{a.log({...C,message:"upload_image",pb:{...C.pb,url:this.endpoints.image,method:"POST",customMessage:JSON.stringify(e)}})})({reason:"failed",error:(null==e?void 0:e.message)??e}),null}}static extractDomainFromUrl(e){try{return new URL(e).hostname}catch(e){return""}}static async fetchImageFromHubble(e){try{const t=await V.POST(V.endpoints.hubble,e);if("Unsuccessful"===t.Status)return null;const n=t.ProviderResults.map((e=>e.Result.PartGroups.map((e=>{var t,n;const i=e.Provider,o=e.ImageParts.find((e=>"Image"===e.ImageCategory));if(!o)return null;let s=o;"BingSearch"===i?s=e.ImageParts.find((e=>"SmallThumbnail"===e.ImageCategory))||o:"StockImagesSearch"===i?s=e.ImageParts.find((e=>"XLargeThumbnail"===e.ImageCategory))||o:"Getty"===i&&(s=e.ImageParts.find((e=>"MediumThumbnail"===e.ImageCategory))||o);const r=(null===(t=e.TextParts.find((e=>"Title"===e.TextCategory)))||void 0===t?void 0:t.Text)||"";return{source:o.SourceUrl,thumbnail:s.SourceUrl,width:o.Width,height:o.Height,title:r,credit:"BingSearch"===i?this.extractDomainFromUrl((null===(n=e.TextParts.find((e=>"SourceLink"===e.TextCategory)))||void 0===n?void 0:n.Text)||o.SourceUrl):i}})))).flat().filter(Boolean);return{imgs:Array.from(new Set(n))}}catch(e){return(e=>{a.log({...S,pb:{...S.pb,url:this.endpoints.hubble,method:"POST",customMessage:JSON.stringify(e)}})})({reason:"failed",error:(null==e?void 0:e.message)??e}),null}}static async fetchImageFromBing(e){try{const t=await V.GET(V.endpoints.imageSearch,{...e,imageApiType:"1"});return{imgs:t.subResponse.value.map((e=>({source:e.contentUrl,thumbnail:e.thumbnailUrl,width:e.width,height:e.height,title:e.name,credit:this.extractDomainFromUrl(e.hostPageUrl||e.contentUrl)})))}}catch(e){return(e=>{a.log({...C,message:"search_image",pb:{...C.pb,url:this.endpoints.imageSearch,method:"GET",customMessage:JSON.stringify(e)}})})({reason:"failed",error:(null==e?void 0:e.message)??e}),null}}static async ImageCreatorCreate(e){try{const t={prompt:e,imageApiType:"2",mkt:(0,A.Yq)().CurrentMarket,setLang:(0,A.Yq)().CurrentMarket},n=await V.GET(V.endpoints.imageSearch,t);return{prompt:n.subResponse.prompt,readyInMs:n.subResponse.readyInMs+Date.now()+1e3,retrieveId:n.subResponse.webSearchUrl.split("/").pop()}}catch(e){return(e=>{a.log({...C,message:"ImageCreatorCreate",pb:{...C.pb,url:this.endpoints.imageSearch,method:"GET",customMessage:JSON.stringify(e)}})})({reason:"failed",error:(null==e?void 0:e.message)??e}),null}}static async ImageCreatorRetrieve(e,t){try{var n;const i={imageApiType:"3",retrieveId:t,q:e},o=await V.GET(V.endpoints.imageSearch,i);return{imgs:(null===(n=o.subResponse.images)||void 0===n?void 0:n.map((t=>({source:t.thumbnailUrl,thumbnail:t.thumbnailUrl,width:1024,height:1024,title:e,credit:"Image Creator"}))))||[]}}catch(e){const t=e=>{a.log({...C,message:"ImageCreatorRetrieve",pb:{...C.pb,url:this.endpoints.imageSearch,method:"GET",customMessage:JSON.stringify(e)}})};return 404===e.status||t({reason:"failed",error:(null==e?void 0:e.message)??e}),null}}static async getFollowersByUserId(e){const t={$top:arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,$skip:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0};return V.GET(V.endpoints.users+e+"/followers",t).then((e=>j.k.convertUserList(e)))}static async getFollowingsByUserId(e){const t={$top:arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,$skip:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0};return V.GET(V.endpoints.users+e+"/followings",t).then((e=>j.k.convertUserList(e)))}static async followUser(e,t){if(t){const t=new _.PublisherServiceClient(K),n=await t.getUserMutedPublishers(),i=n&&n.find((t=>t.profileId===e));i&&t.publisherUserAction(i.id,_.S.Mute,"DELETE")}return V.POST(V.endpoints.follows,{targetId:e},{})}static async unfollowUser(e){return V.DELETE(V.endpoints.follows,{targetId:e})}static async fetchUserCommunitySettings(){var e;const t={};V.getMsaAccessToken()&&(t.UserTicketType="2",t.UserAuthToken=V.getMsaAccessToken(),t.SiteName="api.msn.com"),V.getMuid()&&(t.muid=V.getMuid());const n=await b.N.getPdpUserPreference(!1,t,V.getMuid());return(null==n||null===(e=n.value)||void 0===e?void 0:e.length)>0&&n.value[0].communitySettings||null}static async appealMe(){return V.POST(V.endpoints.users+"me/appeals",{})}static async appealMyPicture(){return V.POST(V.endpoints.users+"me/pictureAppeals",{})}static async reportUser(e,t,n,i){const o="ProfilePicture"==t?"PictureAbusereports":"NameAbusereports",{reportMessage:r,intellectualPropertyDetails:a}=i||{},c={ReportType:n.charAt(0).toUpperCase()+n.slice(1),ReportMessage:r||"",IntellectualPropertyDetails:a};try{return V.POST(V.endpoints.users+e+"/"+o,c,{version:"1.1"})}catch(e){s.k.logError(e)}}static async getUserActivities(e,t){const n={$top:e||50,$skip:t||0,version:"1.1"},i=await V.GET(V.endpoints.users+"me/activities",n);return j.k.convertUserActivities(i)}static async getUserStrikeActivities(){const e=await V.GET(V.endpoints.users+"me/activities",{onlyStrikeHistory:!0,version:"1.1"});return j.k.convertUserStrikeActivities(e)}static async updateUserActivityStatus(e){const t={id:e,read:!(arguments.length>1&&void 0!==arguments[1])||arguments[1]};return V.POST(V.endpoints.users+"me/activities",t,{version:"1.1"})}static async getUserNotifications(){const e=await V.GET(`${V.endpoints.users}me/activities`,{onlynotification:!0,read:!1,$top:5,$skip:0,version:"1.1"});return j.k.convertUserActivities(e)}static async getProviderFullPageData(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"CommunityProfileId";const i={market:A.jG.CurrentMarket,ocid:"Peregrine",query:t};i[n]=e;try{const t=await V.GET(V.endpoints.providerFullPage,i);return t&&0!==t.sections.length||r.M0.sendAppErrorEvent({...c.KyA,message:`feed data is empty for publisher ${e}`}),t}catch{r.M0.sendAppErrorEvent({...c.KyA,message:`feed data is empty for publisher ${e}`})}}static async getCreatorHubFullPageData(){const e=window.location.hash.substring(1).toLowerCase(),t={market:A.jG.CurrentMarket,ocid:"Peregrine",query:"discover"==e.toLowerCase()?"":`msn_${e}`};return V.GET(V.endpoints.creatorHubFullPage,t)}static getProviderContents(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s={providerId:e,market:t,apiKey:A.jG.OneServiceApiKey,$top:o.top||20,$skip:o.skip||0,$orderby:o.orderBy||"Time desc",...n&&{contentType:n},...i&&{partnerTag:i}};return V.GET(V.endpoints.providerContents,s)}static async getPublisherFeed(e,t){const n={contentType:"article,video,slideshow,webcontent",market:t,apikey:A.jG.OneServiceApiKey,ocid:"Peregrine"};try{const t=await V.GET(V.endpoints.publisherFeed,n);return t&&0!==t.sections.length||r.M0.sendAppErrorEvent({...c.KyA,message:`feed data is empty for publisher ${e}`}),j.k.convertPublisherFeed(t)}catch{r.M0.sendAppErrorEvent({...c.KyA,message:`feed data is empty for publisher ${e}`})}}static async getTopCommentedContent(e,t){const n=A.jG.CurrentMarket,i={queryType:"TopCommented",timePeriod:e,$top:t,market:n},o=(await V.GET(V.endpoints.contents,i)).items,s=o.map((e=>e.cmsId)),r={};return await Promise.all(s.map((async e=>{const t=await fetch(`${(0,A.Yq)().AssetsUrl}/content/view/v2/Detail/${n}/${e}`,{method:"GET"});r[e]=await t.json()}))),j.k.convertTopCommentedToPublisherCarouselData(o,r)}static observeRewardsInfo(e){this.rewardsInfoObservers.push(e);const t=this.rewardsInfoObservers.length-1;return()=>this.rewardsInfoObservers[t]=void 0}static async notifyRewardsInfoObservers(){this.getRewardsInfo()}static async getRewardsInfo(e){const t={version:"2",scope:e,ocid:"Peregrine"};let n;try{var i,o,s,r,a,c;const d=await this.makeOneServiceRequest("news/users/me/rewards","GET",t),l=d.userType===N.F.RewardsUser,u=null===(i=d.tokens)||void 0===i||null===(o=i.find((e=>e.tokenType===N.i.Tipping)))||void 0===o?void 0:o.token,p=null===(s=d.tokens)||void 0===s||null===(r=s.find((e=>e.tokenType===N.i.Subscription)))||void 0===r?void 0:r.token,m=!!u,h=!l&&d.eligibleFreeTipping,g=m||h,y=!!p,f=!l&&d.eligibleFreeSubscription.includes(e),v=y||f,C=d.eligibleBackupPayment&&(null===(a=d.tokens)||void 0===a||null===(c=a.find((e=>e.tokenType===N.i.BackupPaymentSubscription)))||void 0===c?void 0:c.token);n={...d,isRewardsUser:l,freeTippingOfferToken:u,freeSubscriptionOfferToken:p,backupPaymentToken:C,isFreeTippingEligibleRewardsUser:m,isFreeTippingEligibleNonRewardsUser:h,isFreeTippingEligibleUser:g,isFreeSubscriptionEligibleRewardsUser:y,isFreeSubscriptionEligibleNonRewardsUser:f,isFreeSubscriptionEligibleUser:v}}catch(e){n={isRewardsUser:!1}}return this.rewardsInfoObservers.forEach((e=>{e&&e(n)})),n}static async createRewardsUser(e){const t={market:A.jG.CurrentMarket,source:e,ocid:"Peregrine"};try{const e=await this.makeOneServiceRequest("news/users/me/rewards","POST",t);return this.notifyRewardsInfoObservers(),{isUserCreated:!0,message:e.Message||""}}catch(e){try{var n;const t="User already exists.";if((null==e?void 0:e.Message)===t||(null===(n=await(null==e?void 0:e.json()))||void 0===n?void 0:n.Message)===t)return{isUserCreated:!0,message:t}}catch(e){}return{isUserCreated:!1,message:e.message||e.Message||""}}}static async getXpaySubscriptionPaymentOptions(e){if(!["vid-ksdbkre0pxrdbnxqmr5xbyu056sdgdim5cna8urvbu45yi3x7jqs"].includes(e)||"en-us"!=A.jG.CurrentMarket)return[];const t=A.jG&&A.jG.CurrentMarket&&A.jG.CurrentMarket.split("-");return V.GET(V.endpoints.paymentOptions,{publisherIdFromMsn:e,market:t[1]}).then((e=>{var t;return(null==e||null===(t=e.paymentOptionGroups[0])||void 0===t?void 0:t.paymentOptions)||[]})).catch((e=>(console.error("error occured while trying to get subscription payment options: ",e),[])))}static async getXPayTokenInfo(){return A.jG.Environment===R.q.int?V.GET(F.k.externalUrls.ppeApi+"xpaytoken"):V.GET(V.domain+"xpaytoken")}static async getMarketSettings(){return V.GET(V.endpoints.marketsettings,{market:A.jG.CurrentMarket}).then((e=>j.k.convertMarketSettings(e||null)))}static async getContentById(e){let{cmsId:t,market:n,url:i}=e;const o=t&&this.isURL(t)?t:null,s={cmsid:t,market:n,version:"1.1"};return i&&(s.url=i),o&&(delete s.cmsid,s.url=o),n||delete s.market,V.GET(V.endpoints.contents,s).then((e=>j.k.convertContent(e||null)))}static async getAllowAndBlockList(e,t){return V.contentAllowBlockListMap[t]||(V.contentAllowBlockListMap[t]=V.getContentById({cmsId:e,market:t})),V.contentAllowBlockListMap[t]}static isURL(e){return!(!e||!e.includes("."))&&/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)}static async getCommentById(e){return V.GET(V.endpoints.comments+e).then((e=>j.k.convertComment(e||null)))}static async getCommentsByContentId(e,t){const n={contentId:e,$top:t.top||50,$skip:t.skip||0,$orderby:t.orderBy||t.sortType||"Rating"};return V.GET(V.endpoints.comments,n).then((e=>{let t="On";try{t=e.links.find((e=>"Content"==e.type)).item.commentStatus||t}catch(e){s.k.logError("Invalid content data in comments response.")}try{const n=j.k.convertCommentList(e||null);return n.commentStatus=t,n}catch(e){return s.k.logError("Invalid comment list data in comments response."),{commentStatus:"Off",list:[]}}}))}static async getCommentsByParentId(e,t){const n={parentId:e,$top:t.top||10,$skip:t.skip||0,$orderby:t.orderBy||"Time"};return V.GET(V.endpoints.comments,n).then((e=>j.k.convertCommentList(e||null)))}static async getCommentsByAnchorCommentId(e,t){const n={anchorId:e,$top:t.top||10,$skip:t.skip||0,$orderby:t.orderBy||"Time"};return V.GET(V.endpoints.comments,n).then((e=>j.k.convertCommentList(e||null)))}static async getCommentsByUserId(e){const t={userId:e,$top:arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,$skip:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,$orderby:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Time"};return V.GET(V.endpoints.comments,t).then((e=>j.k.convertCommentList(e||null))).catch((t=>{r.M0.sendAppErrorEvent({...c._yq,message:`Error getting user comments ${e} ${JSON.stringify(t)}`})}))}static async postComment(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;const a={ContentId:e,Body:n,parentId:i&&i!=e?i:void 0,mentionReply:arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0};let c={};return o&&(c.version=o),r&&(c.url=r),V.additionalParameters&&(c={...c,...V.additionalParameters}),new Promise(((e,t)=>{V.POST(V.endpoints.comments,a,c).then((t=>{e(j.k.convertComment(t||null))}),(e=>{e.json().then((e=>{t(e)})).catch((n=>{s.k.logError("Error getting comment info: "+e.statusText),t()}))}))}))}static async deleteComment(e){return V.DELETE(V.endpoints.comments+e,{})}static async appealComment(e){return V.POST(V.endpoints.comments+e+"/appeals",{})}static async reportComment(e,t,n){const{reportMessage:i,intellectualPropertyDetails:o}=n||{},r={ReportType:t,ReportMessage:i||"",IntellectualPropertyDetails:o};try{return V.POST(V.endpoints.comments+e+"/abusereports",r,{version:"1.1"})}catch(e){s.k.logError(e)}}static async reportPoll(e,t,n){const i={ReportType:t,id:e};null!=n&&n.length&&(i.Description=n);try{return V.POST(V.endpoints.posts+e+"/abusereports",i,{version:"1.1"})}catch(e){s.k.logError(e)}}static async uploadCopyrightFile(e){const t=await V.GET(V.endpoints.users+"me/UploadSasToken",{type:"ContentReport"}),n=await w(),i=`https://${t.accountUrl.split("?")[0]}`,o=n.Blob.createBlobServiceWithSas(i,t.sasString);return new Promise(((n,i)=>{o.createBlockBlobFromBrowserFile(t.container,t.blobName,e,(async(e,o,s)=>e?i(e):n(t.id)))}))}static prepareHubString(e){return e.replace(/-/g,"_")}static async getSignalRConnectionInfo(e){const t=this.prepareHubString(e);return V.POST(V.endpoints.typingUpdates+"RealtimeTypingNegotiate",{},{hub:t})}static async broadcastCommentNotification(e,t,n){const i=this.prepareHubString(e),o={type:"comment-notification",data:{commentId:t,commentParentId:n}};return V.POST(V.endpoints.typingUpdates+"RealtimeTypingBroadcast",o,{hub:i}).then((e=>{}),(e=>{}))}static async broadcastTypingNotification(e,t,n,i){const o=this.prepareHubString(e),s={type:"typing-notification",data:{id:t,name:n,profileImageUrl:i}};return V.POST(V.endpoints.typingUpdates+"RealtimeTypingBroadcast",s,{hub:o}).then((e=>{}),(e=>{}))}static async broadcastViewNotification(e,t){const n=this.prepareHubString(e),i={type:"view-notification",data:{viewing:t}};return V.POST(V.endpoints.typingUpdates+"RealtimeTypingBroadcast",i,{hub:n}).then((e=>{}),(e=>{}))}static async sendReaction(e){let{id:t,item:n,localStorageSave:i,reactionType:o,url:r}=e,a={};r&&(a.url=r),V.additionalParameters&&(a={...a,...V.additionalParameters});const c={subType:o};try{const e=await V.POST(V.endpoints[n]+t+"/reactions",c,a);return Y(t,o,!1,i),j.k.convertRatingToRateValue(e||null)}catch(e){return s.k.logError(e),o}}static async sendResetReaction(e){let{id:t,item:n,localStorageSave:i,url:o}=e,r={};o&&(r={...r,url:o}),V.additionalParameters&&(r={...r,...V.additionalParameters});try{return Y(t,null,!0,i),V.DELETE(V.endpoints[n]+t+"/reactions",r)}catch(e){s.k.logError(e)}}static async getFriendRatings(e,t){return V.GET(V.endpoints[e]+t+"/reactions",{friends:!0,$top:2})}static async getRating(e,t){return V.GET(V.endpoints[e]+t+"/reactions",{}).then((e=>j.k.convertRatingToRateValue(e||null)))}static async getRatingBreakdown(e,t,n){return V.GET(V.endpoints[e]+t+"/reactions",{others:!0}).then((e=>j.k.convertReactionsResponseToReactionBreakdownData(e||null,n)))}static async sendContentStarRating(e,t,n,i){const o={subType:n,surveyId:i};V.POST(V.endpoints.contents+e+"_"+t+"/starratings",o,{})}static async sendResetContentStarRating(e,t,n){const i={surveyId:n};V.DELETE(V.endpoints.contents+e+"_"+t+"/starratings",i)}static async getContentStarRating(e,t,n){const i={surveyId:n};return V.GET(V.endpoints.contents+e+"_"+t+"/starratings",i).then((e=>j.k.convertRatingToRateValue(e||null)))}static async getContentStarRatingAverage(e,t){const n=await this.getStarRatingContentById(e,t);let i=0,o=0;for(const e in Object.keys(n.reactionCounts))switch(i+=n.reactionCounts[e],e){case B.H.angry:o+=1*n.reactionCounts[e];break;case B.H.like:o+=2*n.reactionCounts[e];break;case B.H.love:o+=3*n.reactionCounts[e];break;case B.H.sad:o+=4*n.reactionCounts[e];break;case B.H.surprised:o+=5*n.reactionCounts[e]}return n&&{contentId:n.id,averageStarRating:o/i}}static async getStarRatingContentById(e,t){return V.getContentById({cmsId:`${(0,A.Yq)().AssetsUrl}/labs/star-rating/${t}/${e}/rating`,market:t})}static async getPostsByTopicId(e,t,n,i,o,s){const r={topicId:e,postType:t||"",market:n||A.jG.CurrentMarket||"en-us",top:o||5,skip:s||0,orderBy:i||"Time"},a=U.c.getQueryParameterByName("isPpe",(0,L.l4)())?F.k.externalUrls.ppeApi.concat("posts/"):V.endpoints.posts;return V.GET(a,r).then((e=>j.k.convertPostList(e||null))).catch((e=>[]))}static async getPostById(e){const t={postId:e},n="true"===U.c.getQueryParameterByName("isPpe",(0,L.l4)())?F.k.externalUrls.ppeApi.concat("posts/"):V.endpoints.posts;return V.GET(n,t).then((e=>j.k.convertPost(e||null))).catch((e=>null))}static async SendGetRequest(e){try{var t;const n=await this.fetchSocial(e,{method:"GET"}),i=await n.json();return i.debugId=null===(t=n.headers)||void 0===t?void 0:t.get(H),i}catch{return{}}}static async GET(e,t){const n={method:"GET",queryParams:t=t||{},body:void 0};return this.xhr(e,n)}static async POST(e,t,n){const i={method:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"POST",queryParams:n=n||{},body:t};return this.xhr(e,i)}static async PUT(e,t,n){return V.POST(e,t,n,"PUT")}static async DELETE(e,t){const n={method:"DELETE",queryParams:t=t||{},body:void 0};return this.xhr(e,n)}static async xhr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:void 0,queryParams:void 0,body:void 0},n="GET"!==t.method?{"Content-Type":"application/json"}:{};n={...await E.$D.getOneServiceHeaders(!1),...n},V.additionalHeaders&&(n={...n,...V.additionalHeaders}),V.getMsaAccessToken()&&(n.UserTicketType="2",n.UserAuthToken=V.getMsaAccessToken(),n.SiteName="api.msn.com"),V.getMuid()&&(n.muid=V.getMuid());const o=E.$D.getCommonParams2(this.socialServiceOCID),s=(0,$.O)();s&&(s.ocid&&(o.find((e=>"ocid"==e.key)).value=s.ocid),s.apiKey&&(o.find((e=>"apikey"==e.key)).value=s.apiKey)),o.forEach((n=>{"user"===n.key&&e.startsWith(V.endpoints.posts)||n.value&&(t.queryParams[n.key]=n.value)})),t.queryParams.wrapodata="false",(0,$.z)()?t.queryParams.source=(null==s?void 0:s.source)||"BingImage":e.startsWith(V.domain)&&this.isApiModerationVertical&&(t.queryParams.source=`${A.jG.AppType}-community`);const r=(0,i.n)(t.queryParams),a={method:t.method||"GET",headers:n,credentials:e.match("xpay/subscription/paywall_nosign")?"same-origin":"include"};t.body&&(a.body=JSON.stringify(t.body));return(V.useCache?V.fetchCachedResponse(e+r,a):V.fetchSocial(e+r,a)).then((n=>{if(!(n.status>=200&&n.status<300||401==n.status))throw(n.status>499||400==n.status)&&this.onRequestError(e,t,n),n;if(204==n.status)return{};try{return n.clone().json().then((e=>{var t;return e.value&&(e=e.value[0]),e.debugId=null===(t=n.headers)||void 0===t?void 0:t.get(H),e}))}catch(i){throw this.onRequestError(e,t,n),{status:n.status,statusText:"INVALID_RESPONSE"}}}))}static fetchCachedResponse(e,t){if(t&&"GET"==t.method&&e in V.cachedResponses)return V.cachedResponses[e];t&&"GET"!=t.method&&V.clearCache();const n=V.fetchSocial(e,t);return t&&"GET"==t.method&&(V.cachedResponses[e]=n,setTimeout((()=>{e in V.cachedResponses&&delete V.cachedResponses[e]}),2500)),n}static async fetchSocial(e,t){return V.shouldUseAbortableFetch?(0,I.Sm)(e,V.abortableFetchTimeout,t):K(e,t)}static clearCache(){V.cachedResponses={}}static onRequestError(e,t,n){const i=this.getAppErrorFromUrl(e);n.clone().json().then((o=>{o.value&&(o=o.value[0]),a.log({...i,message:`${t.method}-${n.status}-${o.code||""}${o.subCodes&&o.subCodes.length>0?"-"+o.subCodes[0]:""}`,pb:{...i.pb,url:e,method:t.method,responseStatus:n.status,responseBody:o}})}))}static getAppErrorFromUrl(e){return e.startsWith(V.endpoints.contents)?e.includes("reactions")?c.yRc:e.includes("starratings")?c.vHv:c.ic4:e.startsWith(V.endpoints.comments)?e.includes("reactions")?c.Pdg:e.includes("abusereports")?c.n$r:e.includes("appeals")?c.ToT:c.E7H:e.startsWith(V.endpoints.posts)?e.includes("abusereports")?c.j3Z:c.Gnh:e.startsWith(V.endpoints.users)?c.VWS:e.startsWith(V.endpoints.follows)?c.sWY:e.startsWith(V.endpoints.typingUpdates)?e.includes("RealtimeTypingNegotiate")?c.QsR:c.See:e.startsWith(V.endpoints.marketsettings)?c.aHf:c.xQV}static async makeOneServiceRequest(e,t,n,i){const o=(0,D.PH)(e),s=(0,x.hC)()?E.$D.getOneServiceParamsWithAuth(A.jG.UserId,"",!1):E.$D.getOneServiceParamsWithoutAuth(A.jG.UserId,"",!1),r={};[...s,...Object.keys(n).map((e=>({key:e,value:n[e]}))),...[...o.searchParams.keys()].map((e=>({key:e,value:o.searchParams.get(e)})))].forEach((e=>{r[e.key]=e.value}));const a=o.origin+o.pathname;return"GET"===t?this.GET(a,r):this.POST(a,i,r)}}var W;!function(e){e.contents="contents",e.comments="comments",e.users="users"}(W||(W={}));const J=async e=>{const t=(0,L.zp)().toLowerCase().indexOf(F.k.selectPpeParameter)>-1;if(A.jG.Environment!==R.q.int||t?A.jG.Environment===R.q.prod&&t&&console.warn("PPE environment must not be enabled in PROD environment for Subscription SDK to work"):console.warn("PPE environment will be used for xpay token JWT in INT environment for Subscription SDK to work"),Q.supported){const t=A.jG.Environment===R.q.int?"int":"prod",n=`community_xpay_token_${e}_${t}`,i=`community_xpay_token_expires_${e}_${t}`,o=Q.getItem(n);if(o){const e=Q.getItem(i);if(e&&new Date(parseInt(e)).valueOf()-Date.now()>1e4)return o}const s=await V.getXPayTokenInfo();return Q.setItem(n,s.accessToken),Q.setItem(i,(Date.now()+1e3*s.expiresIn).toString()),s.accessToken}return(await V.getXPayTokenInfo()).accessToken},Q=(0,M.$o)(),Y=async(e,t,n,i)=>{if(i)i(e,n?null:t);else if(Q.supported){let i;if((0,x.hC)()&&(i=(0,o.z_)(),!i)){const e=await V.fetchMe(!1);i=e.id}const s=(0,o.xp)(i,e),r=(0,o.nM)(i);if(n){Q.removeItem(s);const t=Q.getItem(r);let n=t?t.split(","):[];n=n.filter((t=>t!=e)),n.length&&Q.setItem(r,n.join(","))}else if(t){const n=Q.getItem(r);let a=n?n.split(","):[];a.length>200&&(a=a.filter(((e,t)=>!(t<100)||(Q.removeItem((0,o.xp)(i,e)),!1)))),a.includes(e)||a.push(e),Q.setItem(s,t),Q.setItem(r,a.join(","))}}};!async function(){if(Q.supported){const e=Q.getItem(o.JY);if(e){let t;if((0,x.hC)()){const e=await V.fetchMe(!1);t=e.id}e.split(",").forEach((e=>{const n=Q.getItem(`${o.oQ}${e}`);n&&(Q.removeItem(`${o.oQ}${e}`),Q.setItem((0,o.xp)(t,e),n))})),Q.removeItem(o.JY),Q.setItem((0,o.nM)(t),e)}}}(),(0,L.zp)().toLowerCase().indexOf(F.k.selectPpeParameter)>-1&&V.setDomain(F.k.externalUrls.ppeApi,F.k.externalUrls.msphPpeApi),A.jG.IsChinaCompliance&&V.setDomain(F.k.externalUrls.cnApi,F.k.externalUrls.msphCnApi)},98137:function(e,t,n){n.d(t,{JY:function(){return u},nM:function(){return m},oQ:function(){return p},xp:function(){return h},yp:function(){return c},z_:function(){return d}});var i=n(15598),o=n(57663),s=n(17395);const r=(0,i.$o)(),a="community_latest_me_id";function c(e){e?r.setItem(a,e):e||l()}function d(){return r.getItem(a)}function l(){r.getItem(a)&&r.removeItem(a)}(0,s.hC)()||l();const u="myReactionIds",p="myReaction",m=e=>`myReactionIds_${e||o.jG.UserId}`,h=(e,t)=>`myReaction_${e||o.jG.UserId}_${t}`},20938:function(e,t,n){n.d(t,{X:function(){return o},n:function(){return s}});var i=n(21215);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(e){if(!(0,i.N)())return null;const t=window.location.hash.substring(1).split("&");for(let n=0;n<t.length;n++){const i=t[n].split("=");if(i[0].toLowerCase()==e.toLowerCase())return decodeURIComponent(i[1])}return null}(e)||function(e){if(!(0,i.N)())return null;const t=window.location.search.substring(1).split("&");for(let n=0;n<t.length;n++){const i=t[n].split("=");if(i[0].toLowerCase()==e.toLowerCase())return decodeURIComponent(i[1])}return null}(e)||t}function s(e){return e&&Object.keys(e).length>0?"?"+Object.keys(e).map((function(t){return`${t}=${encodeURIComponent(e[t])}`})).join("&"):""}},18906:function(e,t,n){var i,o;n.d(t,{$:function(){return i}}),function(e){e[e.None=0]="None",e[e.Draft=1]="Draft",e[e.UnderReview=2]="UnderReview",e[e.Published=3]="Published",e[e.Rejected=4]="Rejected",e[e.Unpublished=5]="Unpublished"}(i||(i={})),function(e){e[e.None=0]="None",e[e.Appealing=1]="Appealing",e[e.AppealFailed=2]="AppealFailed",e[e.AppealRejected=3]="AppealRejected"}(o||(o={}))},79236:function(e,t,n){n.d(t,{T:function(){return o},b:function(){return s}});var i=n(42122);const o={updateIdpCommentCount:"BingCommunity:UpdateIdpCommentCount",update1sToken:"BingCommunity:Update1sToken",updateUser:"BingProfile:UpdateUser",updateIdpCommentStatus:"BingCommunity:UpdateIdpCommentStatus"};class s{static dispatchBingEvent(e){const t=window.sj_evt;if(t&&t.fire){for(var n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];t.fire(e,...o)}else i.k.logError("sj_evt.fire is not available")}static bindBingEvent(e,t,n,o,s){const r=window.sj_evt;r&&r.bind?r.bind(e,t,n,o,s):i.k.logError("sj_evt.bind is not available")}static unbindBingEvent(e,t){const n=window.sj_evt;n&&n.unbind?n.unbind(e,t):i.k.logError("sj_evt.unbind is not available")}}},76753:function(e,t,n){n.d(t,{O:function(){return s},z:function(){return o}});var i=n(57663);function o(){return"sharedWidgets"===i.jG.AppType&&function(){if(i.jG.WidgetAttributes){const{propertyBag:e={}}=i.jG.WidgetAttributes,{hostSite:t}=e;return t&&"bing"===t.toLowerCase()}return!1}()}function s(){if(i.jG.WidgetAttributes){const{propertyBag:e={}}=i.jG.WidgetAttributes,{social:t}=e;return t}return null}},4418:function(e,t,n){n.d(t,{BZ:function(){return s},OQ:function(){return o},ac:function(){return a},tg:function(){return r}});var i=n(55465);function o(e,t){return`${e}_${t}`}function s(e){return"Poll"===(null==e?void 0:e.postType)}function r(e){return"string"==typeof e&&((null==e?void 0:e.length)>0&&"disabled"===e.toLowerCase()||"off"===e.toLowerCase())}function a(e){var t;return"Poll"===(null==e?void 0:e.postType)&&(null==e?void 0:e.pollQuestion)===i.k.staticPollStrings.question&&(null==e||null===(t=e.pollAnswers)||void 0===t?void 0:t.length)>0}},5539:function(e,t,n){n.d(t,{N:function(){return s},q:function(){return o}});var i=n(42122);function o(e,t){return`${e}_${t}`}function s(e,t,n){const s=o(t,n),r=e&&e[s];return r||(i.k.log("Content id doesn't exist, falling back to key `${cmsId}_${market}`"),s)}},55465:function(e,t,n){n.d(t,{k:function(){return r}});var i=n(57663),o=n(82530);let s=i.jG.NavTargetUrlWithLocale;void 0!==o.env.JEST_WORKER_ID&&(i.jG.CurrentMarket||(s=s.replace("undefined","en-ca")));const r={selectPpeParameter:"oneservice_enable_ppe",renderWithMockData:"render_with_mock_data",externalUrls:{api:`${(0,i.Yq)().AssetsUrl}/service/community/`,cnApi:`${(0,i.Yq)().AssetsUrl}/service/community/`,ppeApi:"https://ppe-api.msn.com/community/",msphApi:"https://api.msn.com/ugc",msphCnApi:"https://api.msn.cn/ugc",msphPpeApi:"https://sf-int.oneservice-test.msn.com/ugc",hubbleApi:"https://hubble.officeapps.live.com",hubblePpeApi:"https://hubble.officeapps.live-int.com",guidelinePage:`${s}/community/guideline`,guidelinePageEmbed:`${s}/community/embed/guidelinepage`,profilePage:`${s}/community/profile/`,bingProfilePage:"https://www.bing.com/profile/community",channelPage:`${s}/community/channel/`,privacySettings:`${s}/settings`,activityPage:`${s}/community/activity`,statusPage:`${s}/community/activity?profileStatus=true`,newPost:`${s}/community/post/new`,profileSettings:"https://account.microsoft.com/profile",feedbackForm:"https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR-V3gf69zQlBm1dJVuXA8mtURVI4UlFHMDRIR0VCWDFWNUQyQU5HVzJJQi4u",moderationEmail:"Appealsprocessor@microsoft.com",bingImageDetailPage:"https://www.bing.com/images/search"},userStateType:{existingUser:"existingUser",anonymous:"anonymous",newUser:"newUser"},userAccountType:{msa:"PersonalMicrosoftAccount",aad:"AzureActiveDirectory"},userNameStatusType:{normal:"Normal",notAllow:"NotAllow",inReview:"InReview",unknown:"Unknown"},userAvatarStatusType:{normal:"Normal",notAllow:"NotAllow",inReview:"InReview",unknown:"Unknown"},userStatusStorageKeys:{edgeLoginStatus:"CommunityUserEdgeLoginStatus"},accountModerationStatus:{normal:"Normal",warning:"Warning",firstStrike:"FirstStrike",secondStrike:"SecondStrike",permanentBan:"PermanentBan",ban:"Ban"},accountModerationStatusStringKeyMap:{restricted:"AccountStatusRestricted",atRisk:"AccountStatusAtRisk",warned:"AccountStatusWarned",FirstStrike:"AccountStatusActivitiesFirstStrike",SecondStrike:"AccountStatusActivitiesSecondStrike",Ban:"AccountStatusActivitiesThirdStrike",Warning:"AccountStatusActivitiesWarning"},activityModerationErrorTypeHeaderStringKeyMap:{Takedown:"ProfileActivityModerationErrorTakedownHeader",Ban:"ProfileActivityModerationErrorPermanentBanHeader",NotAllowName:"ProfileActivityModerationErrorNotAllowNameHeader",NotAllowPicture:"ProfileActivityModerationErrorNotAllowPictureHeader",ApproveUserAppeal:"ProfileActivityModerationErrorApproveUserAppealHeader",ApproveCommentAppeal:"ProfileActivityModerationErrorApproveCommentAppealHeader",ApproveProfilePicAppeal:"ProfileActivityModerationErrorApproveProfilePicAppealHeader",RejectUserAppeal:"ProfileActivityModerationErrorRejectUserAppealHeader",RejectCommentAppeal:"ProfileActivityModerationErrorRejectCommentAppealHeader",RejectProfilePicAppeal:"ProfileActivityModerationErrorRejectProfilePicAppealHeader",Warning:"ProfileActivityModerationErrorWarningHeader",FirstStrike:"ProfileActivityModerationErrorStrikeHeader",SecondStrike:"ProfileActivityModerationErrorStrikeHeader"},activityModerationErrorTypeExpiredHeaderStringKeyMap:{Warning:"ProfileActivityModerationErrorWarningExpiredHeader",FirstStrike:"ProfileActivityModerationErrorStrikeExpiredHeader",SecondStrike:"ProfileActivityModerationErrorStrikeExpiredHeader"},userAgeGroup:{under18:"Under18",above18:"Above18"},userSubType:{default:"Default",publisher:"Publisher",creator:"Creator",poster:"Poster"},activityType:{follow:"Follow",reply:"Reply",reaction:"Reaction",badge:"Achievement",moderation:"Moderation",commentDeleteAlert:"CommentDeleteAlert",profileBannedAlert:"ProfileBannedAlert",profileErrorAlert:"ProfileErrorAlert"},moderationErrorType:{takedown:"Takedown",ban:"Ban",notAllowName:"NotAllowName",notAllowPicture:"NotAllowPicture",approveUserAppeal:"ApproveUserAppeal",rejectUserAppeal:"RejectUserAppeal",approveProfilePicAppeal:"ApproveProfilePicAppeal",rejectProfilePicAppeal:"RejectProfilePicAppeal",approveCommentAppeal:"ApproveCommentAppeal",rejectCommentAppeal:"RejectCommentAppeal",warning:"Warning",firstStrike:"FirstStrike",secondStrike:"SecondStrike"},moderationTakedownReasonStringKeyMap:{"bullying-harassment":"ProfileActivityModerationTakedownReasonBullying",spam:"ProfileActivityModerationTakedownReasonSpam",violence:"ProfileActivityModerationTakedownReasonViolence",profanity:"ProfileActivityModerationTakedownReasonProfanity",abuse:"ProfileActivityModerationTakedownReasonAbuse","child-related":"ProfileActivityModerationTakedownReasonAbuse","misinformation-covid":"ProfileActivityModerationTakedownReasonMisinformation","misinformation-qanon":"ProfileActivityModerationTakedownReasonMisinformation",copyright:"ProfileActivityModerationTakedownReasonCopyright",danger:"ProfileActivityModerationTakedownReasonDanger","public-threats":"ProfileActivityModerationTakedownReasonPublicThreats",illegal:"ProfileActivityModerationTakedownReasonIllegal",terrorism:"ProfileActivityModerationTakedownReasonTerrorism",privacy:"ProfileActivityModerationTakedownReasonPrivacy",inappropriate:"ProfileActivityModerationTakedownReasonInappropriate","off-topic":"ProfileActivityModerationTakedownReasonOffTopic",impersonation:"ProfileActivityModerationTakedownReasonImpersonation","bullying-and-harassment":"ProfileActivityModerationTakedownReasonBullying","hate-speech":"ProfileActivityModerationTakedownReasonHateSpeech",suicide:"ProfileActivityModerationTakedownReasonSuicide","misinformation-us-2020":"ProfileActivityModerationTakedownReasonMisinformation","misinformation-brazil-election":"ProfileActivityModerationTakedownReasonMisinformation","misinformation-school-shooting":"ProfileActivityModerationTakedownReasonMisinformation","misinformation-russia-ukraine":"ProfileActivityModerationTakedownReasonMisinformation",trademark:"ProfileActivityModerationTakedownReasonTrademark"},moderationTakedownReasonGuidelinesListItems:{GuidelinesHarassmentPart:["GuidelinesPageGuidelinesTabAvoidPartText","GuidelinesPageGuidelinesTabAvoidPartHarassment","GuidelinesPageGuidelinesTabAvoidPartBullying"],GuidelinesRespectPart:["GuidelinesPageGuidelinesTabRespectPartText","GuidelinesPageGuidelinesTabRespectPartImpersonate","GuidelinesPageGuidelinesTabRespectPartRespectOthers","GuidelinesPageGuidelinesTabRespectPartNotShareContent"],GuidelinesAbusivePart:["GuidelinesPageGuidelinesTabReportPartText","GuidelinesPageGuidelinesTabReportPartViolent","GuidelinesPageGuidelinesTabReportPartIllegalAct","GuidelinesPageGuidelinesTabReportPartRiskTo","GuidelinesPageGuidelinesTabReportPartAbusiveText","GuidelinesPageGuidelinesTabReportPartHateSpeech"],GuidelinesDoNotPostPart:["GuidelinesPageGuidelinesTabFinalPartText","GuidelinesPageGuidelinesTabFinalPartCopywrited","GuidelinesPageGuidelinesTabFinalPartSpam"]},moderationTakedownReasonGuidelinesGroupings:{GuidelinesHarassmentPart:["ProfileActivityModerationTakedownReasonBullying"],GuidelinesRespectPart:["ProfileActivityModerationTakedownReasonMisinformation","ProfileActivityModerationTakedownReasonPrivacy","ProfileActivityModerationTakedownReasonImpersonation"],GuidelinesAbusivePart:["ProfileActivityModerationTakedownReasonViolence","ProfileActivityModerationTakedownReasonAbuse","ProfileActivityModerationTakedownReasonDanger","ProfileActivityModerationTakedownReasonPublicThreats","ProfileActivityModerationTakedownReasonChildRelated","ProfileActivityModerationTakedownReasonTerrorism","ProfileActivityModerationTakedownReasonHateSpeech","ProfileActivityModerationTakedownReasonSuicide","ProfileActivityModerationTakedownReasonIllegal","ProfileActivityModerationTakedownReasonProfanity"],GuidelinesDoNotPostPart:["ProfileActivityModerationTakedownReasonSpam","ProfileActivityModerationTakedownReasonCopyright","ProfileActivityModerationTakedownReasonTrademark"]},activityModerationErrorTypeStringKeyMap:{Takedown:"ProfileActivityModerationErrorTakedown",Ban:"ProfileActivityModerationErrorPermanentBan",NotAllowName:"ProfileActivityModerationErrorNotAllowName",NotAllowPicture:"ProfileActivityModerationErrorNotAllowPicture",ApproveUserAppeal:"ProfileActivityModerationErrorApproveUserAppeal",ApproveCommentAppeal:"ProfileActivityModerationErrorApproveCommentAppeal",ApproveProfilePicAppeal:"ProfileActivityModerationErrorApproveProfilePicAppeal",RejectUserAppeal:"ProfileActivityModerationErrorRejectUserAppeal",RejectCommentAppeal:"ProfileActivityModerationErrorRejectCommentAppeal",RejectProfilePicAppeal:"ProfileActivityModerationErrorRejectProfilePicAppeal",Warning:"ProfileActivityModerationErrorWarning",FirstStrike:"ProfileActivityModerationErrorFirstStrike",SecondStrike:"ProfileActivityModerationErrorSecondStrike"},visibleStatusType:{Normal:"Normal",DeletedByUser:"DeletedByUser",DeletedByAI:"DeletedByAI",DeletedByHI:"DeletedByHI",InReview:"InReview"},visibleStatusMap:{DeletedByUser:"VisibleStatusDeletedByUser",DeletedByAI:"VisibleStatusDeletedByAI",DeletedByHI:"VisibleStatusDeletedByHI",InReview:"VisibleStatusInReview",Default:"VisibleStatusOther"},reactionOrder:["like","love","surprised","thinking","sad","angry"],binaryReactionOrder:["upvote","downvote"],profileReportItemMap:{UserName:"ReportUserName",ProfilePicture:"ReportProfilePicture"},profilePageEmptyStates:{NoUser:"NoUser",NotSocialUser:"NotSocialUser"},reactionIconMap:{like:"EmojiLike",love:"EmojiHeart",thinking:"EmojiThinking",surprised:"EmojiSurprised",sad:"EmojiSad",angry:"EmojiAngry"},reactions:{like:"like",love:"love",thinking:"thinking",surprised:"surprised",sad:"sad",angry:"angry"},responsiveLevels:{L0:"cwtl-0",L1:"cwtl-1",L2:"cwtl-2",MobilePopup:"cwt-mobile-popup",articleOneBlock:"cwt-article-one-block"},newCommentErrorCodeMap:{400:"NewPostDeniedMsg",403:"NewPostSessionExpiredMsg",500:"NewPostWentWrongMsg",bodyTooLong:"NewPostTooLongMsg",other:"NewPostWentWrongMsg",0:"NewPostWentWrongMsg",1:"NewPostSessionExpiredMsg",4:"NewPostDeniedMsg",6:"NewPostWentWrongMsg",7:"NewPostWentWrongMsg",8:"NewPostWentWrongMsg",9:"NewPostWentWrongMsg",10:"NewPostWentWrongMsg",11:"NewPostWentWrongMsg",12:"NewPostTooManyCommentsMsg",20:"NewPostTooLongMsg",21:"NewPostMentionMsg",22:"NewPostWentWrongMsg",23:"NewPostWentWrongMsg",24:"NewPostDeniedMsg",25:"NewPostWentWrongMsg",26:"NewPostWentWrongMsg",27:"NewPostWentWrongMsg",28:"NewPostDeniedMsg",29:"NewPostDeniedMsg",30:"NewPostDeniedMsg",31:"NewPostDeniedMsg",32:{1:"NewPostDuplicatedMsg",2:"NewPostDeniedMsg",3:"NewPostDeniedMsg",4:"NewPostDeniedMsg",5:"NewPostDeniedMsg",6:"NewPostDeniedMsg",7:"NewPostDeniedMsg",8:"NewPostDeniedMsg",9:"NewPostDeniedMsg",10:"NewPostDeniedMsg",11:"NewPostDeniedMsg",12:"NewPostDeniedMsg",13:"NewPostDeniedMsg",14:"NewPostDeniedMsg",15:"NewPostDeniedMsg",16:"NewPostDeniedMsg",17:"NewPostLanguageErrorMsg",18:"NewPostURLMsg",19:"NewPostDeniedMsg",20:"NewPostDeniedMsg",21:"NewPostDeniedMsg",22:"NewPostDeniedMsg",23:"NewPostDeniedMsg",24:"NewPostDeniedMsg",25:"NewPostDuplicatedMsg",26:"NewPostDeniedMsg",27:"NewPostDeniedMsg",28:"NewPostDeniedMsg",29:"NewPostDeniedMsg",30:"NewPostDeniedMsg"}},newCommentErrorCodeMapDeletedByAiVersion1_1:{0:"NewCommentDeletedByAIReasonSpam",1:"NewCommentDeletedByAIReasonProfanity",2:"NewCommentDeletedByAIReasonAbuse",3:"NewCommentDeletedByAIReasonPrivacy",4:"",5:"",6:"",7:"NewCommentDeletedByAIReasonViolence",8:"",9:"NewCommentDeletedByAIReasonIllegal",10:"NewCommentDeletedByAIReasonTerrorismOrViolentExtremism",11:"NewCommentDeletedByAIReasonTerrorismOrViolentExtremism",12:"NewCommentDeletedByAIReasonCopyright",13:"",14:"",15:"",16:"NewCommentDeletedByAIReasonTrademark",17:"",18:"",19:"",20:"",21:"",22:"",23:"",24:"",25:"NewCommentDeletedByAIReasonMisinformation",26:"NewCommentDeletedByAIReasonHateSpeech",27:"NewCommentDeletedByAIReasonBullyingAndHarassment",28:"NewCommentDeletedByAIReasonSuicideAndSelfHarm",29:"",30:"",31:"",32:"NewCommentDeletedByAIReasonMisinformation",33:"",34:"",35:"NewCommentDeletedByAIReasonImpersonation"},commentsStatusType:{zero:0,minimal:1,expanded:2,notDetermined:3},theme:{default:{name:"default",disabledComponents:[]},superappBase:{name:"superapp",disabledComponents:[]},windowsBase:{name:"windows",disabledComponents:[]},superappEmbed:{name:"superapp-embed",modalComponents:["reactionbreakdowncomment","reactionbreakdowncontent","onboardingpage","onboardingthirdpartypage","onboardingunderagepage","reportmenu","profilereportmenu","copyrightform","trademarkform"],disabledComponents:["profilepage","guidelinepage","articlepage","multiloginpage","reactionbreakdowncomment","reactionbreakdowncontent","onboardingpage","onboardingthirdpartypage","onboardingunderagepage","reportmenu","profilereportmenu","copyrightform","trademarkform"]},superappFullpage:{name:"superapp-fullpage",modalComponents:["reactionbreakdowncomment","reactionbreakdowncontent","onboardingpage","onboardingthirdpartypage","onboardingunderagepage","reportmenu","profilereportmenu","copyrightform","trademarkform"],disabledComponents:["profilepage","guidelinepage","articlepage","multiloginpage","onboardingthirdpartypage"]},genericPopup:{name:"feed-popup",disabledComponents:[]}},profileVisitedLocalStorageKey:"self-profile-visited",profileMaskNameCoachMarkLocalStorageKey:"profile-mask-name-coach-mark",entryPointInfo:{article:"article",articleHeader:"articleHeader",articleRightRail:"articleRightRail",publisherProfile:"publisherProfile"},supportSourceForTelemetryInfo:{tipPromotionInArticle:"SocialTipPromotionInArticle",tipPromotion:"SocialTipPromotion",tipSelection:"SocialTipSelection"},moderationSourceOverrideVerticals:["finance","sports","weather"],staticPollStrings:{question:"Static_Poll_Question",answerInformative:"Static_Poll_Answer_Informative",answerInspiring:"Static_Poll_Answer_Inspiring",answerHelpful:"Static_Poll_Answer_Helpful",answerEntertaining:"Static_Poll_Answer_Entertaining"},entrypointContentType:{poll:"poll",commentPeek:"commentPeek",sentimentPicker:"sentimentPicker",post:"post"}}},76090:function(e,t,n){n.d(t,{PI:function(){return I},Dm:function(){return T},uh:function(){return U},U3:function(){return k}});var i=n(32425),o=n(85856),s=n(68052),r=n(28123),a=n(57663),c=n(13432),d=n(42122),l=n(7677),u=n(5302),p=n(34587),m=n(33928),h=n(11734),g=n(23968),y=n(6730),f=n(60831),v=n(71172);const C="community-loader",S="community-loader-overlay";function P(e){"wheel"==e.type&&e.cancelable&&e.preventDefault()}function w(e){40!=e.keyCode&&38!=e.keyCode||e.cancelable&&e.preventDefault()}function b(e){e.body.removeEventListener("wheel",P,!0),e.body.removeEventListener("keydown",w,!0),e.body.style.overflowY="scroll"}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"appear";const n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?window.top.document:document;if(!n.getElementById(C)){const e=n.createElement("div"),t=n.createElement("div");e.id=C,t.id=S,function(e){e.body.addEventListener("wheel",P,!0),e.body.addEventListener("keydown",w,!0),e.body.style.overflowY="hidden"}(n);const i=n.createElement("style");i.innerHTML=`\n            #${S} {\n                background-color: rgba(0, 0, 0, 0.4);\n                z-index: 9999999999;\n                height: 100%;\n                width: 100%;\n                position: fixed;\n                top: 0;\n            }\n            #${C},\n            #${C}:after {\n                border-radius: 50%;\n                width: 10em;\n                height: 10em;\n            }\n            #${C} {\n                font-size: 6px;\n                border-top: 1.1em solid rgb(0 0 0 / 10%);\n                border-right: 1.1em solid rgb(0 0 0 / 10%);\n                border-bottom: 1.1em solid rgb(0 0 0 / 10%);\n                border-left: 1.1em solid #0087fb;\n                -webkit-transform: translateZ(0);\n                -ms-transform: translateZ(0);\n                transform: translateZ(0);\n                -webkit-animation: load8 1.1s infinite linear;\n                animation: load8 1.1s infinite linear;\n                position: fixed;\n                transform: translate(calc(50vw - 50%), calc(50vh - 50%));\n                left: 50%;\n                top: 50%;\n                margin-top: -50px;\n                margin-left: -50px;\n            }\n            @-webkit-keyframes load8 {\n                0% {\n                    -webkit-transform: rotate(0deg);\n                    transform: rotate(0deg);\n                }\n                100% {\n                    -webkit-transform: rotate(360deg);\n                    transform: rotate(360deg);\n                }\n            }\n            @keyframes load8 {\n                0% {\n                    -webkit-transform: rotate(0deg);\n                    transform: rotate(0deg);\n                }\n                100% {\n                    -webkit-transform: rotate(360deg);\n                    transform: rotate(360deg);\n                }\n            }\n        `,n.body.appendChild(t),t.appendChild(e),n.body.appendChild(i)}return function i(){setTimeout((function(){const o=n.getElementById(S),s="appear"==t?e=>e:e=>!e;for(let t=0;t<e.length;t++){const i=e[t];var r,a;if("support-result-overlay"==i)if(s(null===(r=n.getElementsByTagName("social-support-result")[0])||void 0===r||null===(a=r.shadowRoot)||void 0===a?void 0:a.children[0]))return o&&o.remove(),void b(n);if(s(n.getElementsByClassName(i)[0]))return o&&o.remove(),void b(n)}i()}),100)}(),()=>{const e=n.getElementById(S);e&&e.remove(),b(n)}}async function k(e,t){let n;t||(n=A(["cwt-loginloadingspinner-marker"],"disappear",!1));const i=await async function(e){const{loginHint:t,forceLoginPrompt:n,updateCurrentAccount:i=!0,tenantOptions:o}=e||{},s=await(0,p.Yu)(o);if(s)try{const e=await s.loginPopup({...(0,p.qW)(),prompt:t||n?"login":"select_account",loginHint:t||""});if(e)(0,m.Ov)(c.g4.loginPopup,"Success");else{const e="authResult is empty";d.k.logError(`dual-auth: loginPopup failed: ${e}`),(0,m.Ov)(c.g4.loginPopup,e)}if(i){await(0,v.vW)(e);const t=await(0,y.zj)(e),n=(0,f.Jz)(t);(0,h.OE)(n)}return e}catch(e){const t=(0,l.n)(e);d.k.logError(`dual-auth: loginPopup failed: ${t}`),(0,m.Ov)(c.g4.loginPopup,t),(0,g.h)(u.D1F,t)}}({updateCurrentAccount:!0,tenantOptions:{tenantScope:"MSA"}});i||(n&&n(),e&&e())}function T(){const e=(0,i.AE)(o.sM,!0),t=e&&(0,s.d)(decodeURIComponent(e)),{login_hint:n}=t||{};return n&&t}function U(){return(0,r.P8)()&&"hybrid"!==a.jG.AppType}const R="CommunitySignInComplete";function I(e){const t=new CustomEvent(R,{detail:{user:e}});window.dispatchEvent(t)}},77262:function(e,t,n){n.d(t,{B_:function(){return c},SP:function(){return u},eL:function(){return l},zp:function(){return d}});var i=n(57663),o=n(55465),s=n(82530);function r(e){const t=window.location.search.substring(1).split("&"),n=[];for(let i=0;i<t.length;i++){const o=t[i].split("=");o[0].toLowerCase()==e.toLowerCase()&&n.push(o[1])}return n.length>0?n.map((e=>decodeURIComponent(e||""))).join(","):null}function a(e){return e&&Object.keys(e).length>0?"?"+Object.keys(e).map((function(t){return e[t].split(",").map((e=>e?`${t}=${encodeURIComponent(e)}`:t)).join("&")})).join("&"):""}function c(e,t,n){const i={};["fdhead","item","rt","theme","ocid","env","oneservice_enable_ppe"].map((e=>{const t=r(e);null!==t&&(i[e]=t)}));const o=a(i),c=void 0!==s.env.JEST_WORKER_ID?"/en-ca/":"/en-us/";t&&e.indexOf(c)>0&&(e=e.replace(c,`/${t}/`));const d=[e];return o&&-1!=e.indexOf("?")?d.push(`&${o.substring(1)}`):o&&d.push(o),d.push(n?`#comments&commentId=${n}`:""),d.join("")}function d(e,t){const n={};t&&(n.cid=t),n.tid="id_communitytab",n.FORM="000112",["features","setflight","item","rt","theme"].map((e=>{const t=r(e);null!==t&&(n[e]=t)}));const i=a(n),o=[e];return i&&-1!=e.indexOf("?")?o.push(`&${i.substring(1)}`):i&&o.push(i),o.join("")}function l(){return window.location.hash.includes("comments")}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.jG.CurrentMarket;return c(`${o.k.externalUrls.profilePage}me`,e)+"#subscriptions"}}}]);